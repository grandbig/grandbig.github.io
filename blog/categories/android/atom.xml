<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: android | Takahiro Octopress Blog]]></title>
  <link href="http://grandbig.github.io/blog/categories/android/atom.xml" rel="self"/>
  <link href="http://grandbig.github.io/"/>
  <updated>2016-01-16T00:02:21+09:00</updated>
  <id>http://grandbig.github.io/</id>
  <author>
    <name><![CDATA[Takahiro]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Kotlinを使ってみよう！(1)]]></title>
    <link href="http://grandbig.github.io/blog/2015/11/08/kotlin-android-2/"/>
    <updated>2015-11-08T23:54:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/11/08/kotlin-android-2</id>
    <content type="html"><![CDATA[<h3>Kotlinを勉強しよう</h3>

<p>さて、本日はKotlinを勉強してみたいと思います。<br/>
勉強の題材としては、<a href="http://grandbig.github.io/blog/2015/11/08/google-sign-in-android/">Google Sign-In SDK for Androidを使ってみよう！</a>で取り上げた <strong>Google Sign-In SDKによるOAuth2.0認証</strong> にしたいと思います。<br/>
その中で筆者が抑えておくべきと思ったところを基礎からメモっていきます。</p>

<p>(KotlinをAndroid Studioに導入する方法は以前書いた<a href="http://grandbig.github.io/blog/2015/10/25/kotlin-android/">Android StudioにKotlinを導入しよう！</a>を参照ください。)</p>

<p>では、早速、見ていきましょう。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>Kotlinで変数/定数の書き方</h4>

<p>最も基本的なことですが、変数/定数の書き方から異なります。</p>

<p>Javaの場合</p>

<p><code>java
private final String TAG = "MainActivity";  // 定数
private GoogleApiClient mGoogleApiClient;   // 変数
</code></p>

<p>Kotlinの場合</p>

<p><code>java
private val TAG:Int = "MainActivity"                    // 定数
private var mGoogleApiClient:GoogleApiClient? = null    // 変数
</code></p>

<p>ポイントは下記です。</p>

<ul>
<li>定数は<code>val</code>で変数は<code>var</code>を使う</li>
<li>定数は、val 定数名:型名 = 値</li>
<li>変数は、var 変数名:型名 = 値</li>
<li>初期値未定の変数は型名の後ろに<code>?</code>をつけて、<code>null</code>を代入<br/>
これをしないと『Property must be initialized or be abstract』エラーが発生する</li>
</ul>


<h4>Kotlinでのstatic定数の書き方</h4>

<p>Kotlinでは<code>static</code>は使いません。</p>

<p>Javaの場合</p>

<p><code>java
private static final String TAG = "MainActivity";
private static final int RC_SIGN_IN = 9001;
</code></p>

<p>Kotlinの場合</p>

<p>```java
companion object {</p>

<pre><code>val TAG = "MainActivity"
val RC_SIGN_IN = 9001
</code></pre>

<p>}
```</p>

<h4>Kotlinでimplementの書き方</h4>

<p>Google Sign-In SDKでOAuth2.0認証をする際に、<code>GoogleApiClient.OnConnectionFailedListener</code>と<code>View.OnClickListener</code>のインターフェースを継承していました。</p>

<p>Javaの場合</p>

<p>```java
public class MainActivity extends AppCompatActivity implements GoogleApiClient.OnConnectionFailedListener, View.OnClickListener {</p>

<pre><code>...
</code></pre>

<p>}
```</p>

<p>Kotlinの場合</p>

<p>```java
class MainActivity : AppCompatActivity(), GoogleApiClient.OnConnectionFailedListener, View.OnClickListener {</p>

<pre><code>...
</code></pre>

<p>}
```</p>

<p>Kotlionでは<code>implements</code>ワードは書かずに<code>extends</code>したクラスの後ろに<code>,</code>区切りで書きます。</p>

<h4>Kotlinでキャストの書き方</h4>

<p>Google Sign-Inを実行するために置いていたボタンをソース上で取り出すときに<code>SignInButton</code>でキャストしていました。</p>

<p>Javaの場合</p>

<p><code>java
SignInButton signInButton = (SignInButton) findViewById(R.id.button_sign_in);
</code></p>

<p>Kotlinの場合</p>

<p><code>java
var signInButton:SignInButton = findViewById(R.id.button_sign_in) as SignInButton
</code></p>

<p>Kotlinでは<code>as</code>を使ってキャストします。</p>

<h4>KotlinでOverrideの書き方</h4>

<p>Javaの場合</p>

<p>```java
@Override
protected void onCreate(Bundle savedInstanceState) {</p>

<pre><code>...
</code></pre>

<p>}
```</p>

<p>Kotlinの場合</p>

<p>```java
override fun onCreate(savedInstanceState: Bundle?) {</p>

<pre><code>...
</code></pre>

<p>}
```</p>

<p>Kotlinでは、<code>@</code>は不要で<code>fun</code>の前に書きます。<br/>
(Swiftと違って、<code>func</code>とは書かないんです。)</p>

<h4>Kotlinでメソッドの戻り値の書き方</h4>

<p>Javaの場合</p>

<p>```java
@Override
public boolean onCreateOptionsMenu(Menu menu) {</p>

<pre><code>...
</code></pre>

<p>}
```</p>

<p>Kotlinの場合</p>

<p>```java
override fun onCreateOptionsMenu(menu: Menu): Boolean {</p>

<pre><code>...
</code></pre>

<p>}
```</p>

<p>『fun メソッド名(引数名: 引数の型): 戻り値の型』 と書きます。</p>

<h4>Kotlinでswitch文の書き方</h4>

<p>```java
@Override
public void onClick(View v) {</p>

<pre><code>switch (v.getId()) {
    case R.id.button_sign_in:
        signIn();
        break;
}
</code></pre>

<p>}
```</p>

<p>Kotlinの場合</p>

<p>```java
override fun onClick(view:View) {</p>

<pre><code>when(view.id) {
    R.id.button_sign_in -&gt; {
        signIn()
    }
}
</code></pre>

<p>}
```</p>

<p>Kotlinでは<code>switch</code>ワードを使いません。<code>when</code>を使います。<br/>
<code>case 条件:</code>という書き方が<code>条件 -&gt;</code>になります。</p>

<p>さて、今回気になったのはこんなところです。<br/>
これからもどんどんKotlinでの書き方に慣れていきたいと思います。</p>

<p>因みに、今回のソースは、<a href="https://github.com/grandbig/KotlinGoogleSignInSample">GitHub</a>に上げてあります。<br/>
ご自由にお使いください。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google Sign-In SDK for Androidを使ってみよう！]]></title>
    <link href="http://grandbig.github.io/blog/2015/11/08/google-sign-in-android/"/>
    <updated>2015-11-08T12:20:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/11/08/google-sign-in-android</id>
    <content type="html"><![CDATA[<h4>Google Sign-in SDKを使ったOAuth認証をやってみよう！</h4>

<p>さて、本日はGoogle Sign-in SDKのAndroidでの使い方について見ていきたいと思います。<br/>
Androidの場合、Google製のため、親和性は元々高いのですが、推奨されているGoogle Sign-in SDKを使うことでより快適なコーディングやUXを提供できるのではと期待しています。</p>

<p>因みに、本書執筆時の環境は下記です。<br/>
* 端末: Nexus6<br/>
* OS: Android6.0<br/>
* IDE: Android Studio 1.5 preview2</p>

<p>では、早速、使い方を見ていきましょう。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>Google Developers ConsoleでOAuth認証に必要な項目を登録しよう！</h4>

<p>さて、実際にGoogle Sign-Inを始める前に、やらなければならないことがあります。<br/>
それは<a href="https://console.developers.google.com">Google Developers Console</a>での登録作業です。(iOSと同じです。)</p>

<p>まず、OAuth2.0の同意画面を作成しましょう。<br/>
因みに、筆者は既に登録済みのOAuth2.0クライアントIDがあったため、下図のように表示されます。<br/>
<strong>OAuth同意画面</strong> というボタンをクリックして、OAuth同意画面の作成ページに移りましょう。<br/>
<img src="/images/google-sign-in-android-0.png" alt="認証情報の確認ページ" /></p>

<p>OAuth同意画面では <strong>メールアドレス</strong> と <strong>サービス名</strong> を入力しましょう。(他は必要に応じて入力してください。)<br/>
<img src="/images/google-sign-in-android-1.png" alt="OAuth2.0の同意画面を作成" /></p>

<p>OAuth同意画面が作成できたら、認証情報を追加しましょう。<br/>
下図のように <strong>OAuth2.0クライアントID</strong> を選択してください。<br/>
<img src="/images/google-sign-in-android-2.png" alt="OAuth2.0クライアントIDを作成" /></p>

<p>今回はAndroid用なので、下図の手順でクライアントIDを作成しましょう。<br/>
<img src="/images/google-sign-in-android-3.png" alt="OAuth2.0クライアントISを作成2" /></p>

<p>これでクライアントIDが作成されたと思います。<br/>
作成したクライアントIDを選択すれば、下図のような情報が得られるはずです。<br/>
 <img src="/images/google-sign-in-android-6.png" alt="Google Developer ConsoleのOAuth2.0 for iOS" /></p>

<h4>Google Sign-in SDK for Androidを実装しよう</h4>

<p><a href="https://developers.google.com/identity/sign-in/android/?hl=ja">Googleの公式サイト</a>に書かれていますが、英語が苦手な方向け(+自分のメモ書き)として説明していきたいと思います。</p>

<p>まずは、<a href="https://developers.google.com/identity/sign-in/android/start?hl=ja">Google Sign-In for Androidのガイドページ</a>にアクセスしましょう。<br/>
そうすると、順番に説明されていることがわかります。<br/>
①はテストコードを手に入れるだけなので、自分のプロジェクトに組み込むなら②からはじめましょう。<br/>
<img src="/images/google-sign-in-android-4.png" alt="GET A CONFIGURATION FILE" /></p>

<p>そうすると、下図のようなページに遷移します。<br/>
<img src="/images/google-sign-in-android-5.png" alt="Enable Google services for your app" /></p>

<p>ここで、 <strong>App name</strong> にGoogle Developers Consoleのプロジェクト名を <strong>『選択』</strong> します。<br/>
注意点として、App nameに記載されているデフォルト名を削除すると、選択可能なプロジェクト名が表示されます。<br/>
App nameが入力した後に、 <strong>Android package name</strong> を入力しましょう。</p>

<p>必要項目の入力が終わったら、Choose and configure servicesボタンを押しましょう。<br/>
<img src="/images/google-sign-in-android-7.png" alt="Choose and configure servicesボタンを押す" /></p>

<p>結果、画面が遷移します。<br/>
<img src="/images/google-sign-in-android-8.png" alt="Configuration Fileを作成しよう" /></p>

<p>画面下の方に <strong>SHA1</strong> を入力する項目があるので、これを入力して、 <strong>ENABLE GOOGLE SIGN-IN</strong> ボタンを選択しましょう。<br/>
<img src="/images/google-sign-in-android-9.png" alt="Configuration Fileを作成しよう" /></p>

<p>因みにSHA1の調べ方は下記の通りです。</p>

<ol>
<li>ターミナルで/Users/{ユーザ名}/.androidの階層に移動</li>
<li><code>keytool -list -v -keystore "/Users/{ユーザ名}/.android/debug.keystore" -alias androiddebugkey -storepass android -keypass android</code>コマンドを入力</li>
<li>出力結果の証明書のフィンガプリント > SHA1の値を取得</li>
</ol>


<p>画面下の <strong>Generate configuration files</strong> ボタンが押せるようになるので、押しましょう。<br/>
<img src="/images/google-sign-in-android-10.png" alt="Configuration Fileを作成しよう" /></p>

<p>jsonファイルのダウンロード画面が表示されるので、ダウンロードしましょう。<br/>
<img src="/images/google-sign-in-android-11.png" alt="jsonファイルをダウンロード" /></p>

<p>必要なファイルが揃ったので、自身のプロジェクトのappフォルダ配下にダウンロードした<code>google-services.json</code>を配置しましょう。</p>

<p>続いて、<code>build.gradle</code>ファイルの設定にGoogle Play Services Pluginを追加しましょう。<br/>
まずは、<code>build.gradle(Project)</code>の<code>dependencies</code>内に<code>classpath 'com.google.gms:google-services:1.5.0-beta2'</code>を追加<br/>
次に、<code>build.gradle(app)</code>の最上部に<code>apply plugin: 'com.google.gms.google-services'</code>を追加<br/>
そして、<code>build.gradle(app)</code>の<code>dependencies</code>内に<code>compile 'com.google.android.gms:play-services-auth:8.3.0'</code>を追加</p>

<p>これで用意が整いましたので、ソースを書いていきます。</p>

<p>```java
// MainActivity.java
package &hellip;
import android.content.Intent;
import android.os.Bundle;
import android.support.design.widget.FloatingActionButton;
import android.support.design.widget.Snackbar;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.Toolbar;
import android.util.Log;
import android.view.View;
import android.view.Menu;
import android.view.MenuItem;</p>

<p>import com.google.android.gms.auth.api.Auth;
import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
import com.google.android.gms.auth.api.signin.GoogleSignInOptions;
import com.google.android.gms.auth.api.signin.GoogleSignInResult;
import com.google.android.gms.common.ConnectionResult;
import com.google.android.gms.common.SignInButton;
import com.google.android.gms.common.api.GoogleApiClient;</p>

<p>public class MainActivity extends AppCompatActivity implements</p>

<pre><code>    GoogleApiClient.OnConnectionFailedListener, View.OnClickListener {

private static final String TAG = "MainActivity";
private static final int RC_SIGN_IN = 9001;
private GoogleApiClient mGoogleApiClient;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    &lt;省略&gt;

    // Button listenersの設定
    findViewById(R.id.button_sign_in).setOnClickListener(this);

    // Google Sign-Inの設定
    GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN).requestEmail().build();
    mGoogleApiClient = new GoogleApiClient.Builder(this)
            .enableAutoManage(this /* FragmentActivity */, this /* OnConnectionFailedListener */)
            .addApi(Auth.GOOGLE_SIGN_IN_API, gso)
            .build();

    // Google Sign-Inボタンの設定
    SignInButton signInButton = (SignInButton) findViewById(R.id.button_sign_in);
    signInButton.setSize(SignInButton.SIZE_STANDARD);
    signInButton.setScopes(gso.getScopeArray());
}

&lt;省略&gt;

// Sign-Inした結果を受け取る処理
@Override
public void onActivityResult(int requestCode, int resultCode, Intent data) {
    super.onActivityResult(requestCode, resultCode, data);

    // Result returned from launching the Intent from GoogleSignInApi.getSignInIntent(...);
    if (requestCode == RC_SIGN_IN) {
        GoogleSignInResult result = Auth.GoogleSignInApi.getSignInResultFromIntent(data);
        handleSignInResult(result);
    }
}

// Sign-Inした結果を扱う処理
private void handleSignInResult(GoogleSignInResult result) {
    Log.d(TAG, "handleSignInResult:" + result.isSuccess());
    if (result.isSuccess()) {
        // Signed in successfully, show authenticated UI.
        GoogleSignInAccount acct = result.getSignInAccount();
    } else {
        // Signed out, show unauthenticated UI.
    }
}

// Sign-In処理
private void signIn() {
    Intent signInIntent = Auth.GoogleSignInApi.getSignInIntent(mGoogleApiClient);
    startActivityForResult(signInIntent, RC_SIGN_IN);
}

@Override
public void onClick(View v) {
    switch (v.getId()) {
        case R.id.button_sign_in:
            signIn();
            break;
    }
}
</code></pre>

<p>}
```</p>

<p>続いてレイアウトの作成</p>

<p>```java
// content_main.xml
&lt;com.google.android.gms.common.SignInButton</p>

<pre><code>android:id="@+id/button_sign_in"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:layout_below="@+id/textView"
android:layout_alignParentStart="true"
android:layout_marginTop="100dp" /&gt;
</code></pre>

<p>```</p>

<p>これを実装すると下記のような画面遷移ができます。</p>

<p><img src="/images/google-sign-in-android-12.png" alt="アプリ起動後の画面" /><br/>
<img src="/images/google-sign-in-android-13.png" alt="アカウントの選択" /></p>

<p>Google Sign-In SDK for Androidを使うことで、UI/UXをiOS側と合わせることもできるので、非常に良いと思います。<br/>
ぜひ使ってみてはいかがでしょうか。</p>

<p>といったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android StudioにKotlinを導入しよう！]]></title>
    <link href="http://grandbig.github.io/blog/2015/10/25/kotlin-android/"/>
    <updated>2015-10-25T19:12:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/10/25/kotlin-android</id>
    <content type="html"><![CDATA[<h4>AndroidアプリはKotlinで書く時代！？</h4>

<p>さて、本日は久々にAndroidについて書きたいと思います。<br/>
<strong>Kotlin</strong> はどの程度、世に普及しているのでしょうか？ほとんどのAndroidアプリ開発者はJavaで開発していると思うのですが、今後はiOSのObjective-C/Swiftのように開発言語としてJava/Kotlinを選択することになるかもしれません。</p>

<p>KotlinはAndroid StudioのベースとなっているIntelliJを開発しているJetBrains社が開発したJVM言語であるため、Android Studioへの導入も簡単で親和性も高いらしいです。<br/>
また、iOSアプリをSwiftで開発していた開発者は書き方が似ているKotlinの方が開発が幾分か楽かもしれません。<br/>
コード補完や参照ジャンプなどの基本的なIDEサポートもあるのでAndroid Studioでも問題なくKotlinを使えるのではないでしょうか。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>Kotlinの導入方法</h4>

<p>Kotlinの導入方法を書いていきます。と言ってもほとんどないです笑。</p>

<p>【導入手順】</p>

<p>1．Android Stuioを起動<br/>
2．Android Studio > Preferences > Plugins > Install JetBrains plugin&hellip;を選択<br/>
3．リストからKotlinを選択して、Install pluginを選択
<img src="/images/kotlin_install_1.png" alt="Kotlinのインストール" /></p>

<p>4．インストール完了後, Android Studioを再起動<br/>
<img src="/images/kotlin_install_2.png" alt="Android Studioの再起動" /></p>

<p>5．javaパッケージをkotlinパッケージにリネーム<br/>
javaパッケージを右クリック > Refactor > Rename を選択<br/>
最終的に下図のようになればOKです。<br/>
<img src="/images/kotlin_install_3.png" alt="ペッケージ名の変更" /></p>

<p>6．javaファイルをkotlinファイルに変換<br/>
javaファイルを選択して、Code > Convert Java File to Kotlin File を選択<br/>
MainActivity(メインファイル)だけでなくApplicationTestも変換しておきましょう。<br/>
<img src="/images/kotlin_install_4.png" alt="kotlinファイルに変換" /></p>

<p>7．build.gradle(app)をkotlin用に修正
Tools > Kotlin > Configure Kotlin in Project を選択すると、build.gradle(app)ファイルにKotlin対応用の記述が自動で追加されます。<br/>
筆者の場合は下記のような感じになりました。</p>

<p>```java
apply plugin: &lsquo;com.android.application&rsquo;
apply plugin: &lsquo;kotlin-android&rsquo;</p>

<p>android {</p>

<pre><code>compileSdkVersion 21
buildToolsVersion "22.0.1"

defaultConfig {
    applicationId "com.example.kato_takahiro.kotlinsample"
    minSdkVersion 21
    targetSdkVersion 21
    versionCode 1
    versionName "1.0"
}
buildTypes {
    release {
        minifyEnabled false
        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
}
sourceSets {
    main.java.srcDirs += 'src/main/kotlin'
}
</code></pre>

<p>}</p>

<p>dependencies {</p>

<pre><code>compile fileTree(dir: 'libs', include: ['*.jar'])
testCompile 'junit:junit:4.12'
compile 'com.android.support:appcompat-v7:21.0.3'
compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
</code></pre>

<p>}
buildscript {</p>

<pre><code>ext.kotlin_version = '1.0.0-beta-1038'
repositories {
    mavenCentral()
}
dependencies {
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
}
</code></pre>

<p>}
repositories {</p>

<pre><code>mavenCentral()
</code></pre>

<p>}
```</p>

<p>8．ビルドしてデバッグ<br/>
ここまでくれば設定は完了したはずなので、Build > Clean Projectしてエラーが発生しないかチェック<br/>
問題なければ、実機を繋いでデバッグしちゃいましょう！</p>

<h4>Kotlinでコードを書いてみよう！</h4>

<p>さて、使えることにしただけでは何なので、以前書いた<a href="http://grandbig.github.io/blog/2015/05/16/altbeacon/">AltBeaconを使ってAndroidでiBeaconを検知しよう</a>をKotlinで書き直してみました。</p>

<p>```java
&lt;省略></p>

<p>// AltBeacon関連のライブラリをimport
import org.altbeacon.beacon.BeaconConsumer;
import org.altbeacon.beacon.BeaconManager;
import org.altbeacon.beacon.BeaconParser;
import org.altbeacon.beacon.Identifier;
import org.altbeacon.beacon.MonitorNotifier;
import org.altbeacon.beacon.Region;</p>

<p>class MainActivity : ActionBarActivity(), BeaconConsumer {</p>

<pre><code>private val TAG = "AltBeacon Sample"

// BeaconManagerクラスの変数を定義
private var beaconManager: BeaconManager? = null

public val IBEACON_FORMAT = "m:2-3=0215,i:4-19,i:20-21,i:22-23,p:24-24"

override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_main)

    // staticメソッドでBeaconManagerクラスのインスタンスを取得
    beaconManager = BeaconManager.getInstanceForApplication(this)
    // BeaconParseをBeaconManagerに設定
    beaconManager!!.beaconParsers.add(BeaconParser().setBeaconLayout(IBEACON_FORMAT))
}

override fun onCreateOptionsMenu(menu: Menu): Boolean {
    // Inflate the menu; this adds items to the action bar if it is present.
    menuInflater.inflate(R.menu.menu_main, menu)
    return true
}

override fun onOptionsItemSelected(item: MenuItem): Boolean {
    // Handle action bar item clicks here. The action bar will
    // automatically handle clicks on the Home/Up button, so long
    // as you specify a parent activity in AndroidManifest.xml.
    val id = item.itemId

    //noinspection SimplifiableIfStatement
    if (id == R.id.action_settings) {
        return true
    }

    return super.onOptionsItemSelected(item)
}

override fun onBeaconServiceConnect() {
    // BeaconManagerクラスのモニタリング通知受取り処理
    beaconManager!!.setMonitorNotifier(object : MonitorNotifier {
        override fun didEnterRegion(region: Region) {
            // 領域進入時に実行
            Log.d(TAG, "didEnterRegion")
        }

        override fun didExitRegion(region: Region) {
            // 領域退出時に実行
            Log.d(TAG, "didExitRegion")
        }

        override fun didDetermineStateForRegion(i: Int, region: Region) {
            // 領域への侵入/退出のステータスが変化したときに実行
            Log.d(TAG, "didDetermineStateForRegion")
        }
    })

    try {
        // UUIDの作成
        val identifier = Identifier.parse("434B4666-E4B2-4B78-8C13-901AFEE3DBB6")
        // モニタリングの開始
        beaconManager!!.startMonitoringBeaconsInRegion(Region("unique-id-001", identifier, null, null))
    } catch (e: RemoteException) {
        // 例外が発生した場合の処理
        e.printStackTrace()
    }
}

override fun onPause() {
    super.onPause()
    beaconManager!!.unbind(this)
}

override fun onResume() {
    super.onPause()
    beaconManager!!.bind(this)
}
</code></pre>

<p>}
```</p>

<p>こう書いてみると、確かにSwiftに似ていますね。<br/>
気になったのは下記の通りです。</p>

<ul>
<li>Swiftで言うところの<code>let</code>がKotlinでは<code>val</code>と書くこと</li>
<li>Swiftで言うところの<code>delegate</code>の設定の仕方とKotlinで言うところの<code>implements</code>が同じ</li>
<li>Kotlinで変数が<code>null</code>のときにメソッドを実行しないよう <strong>!!</strong> が必要</li>
</ul>


<p>これからはJavaだけでなく、Kotlinでも書けるように力を蓄えていきたいと思います。<br/>
と言ったところで本日はここまで。</p>

<p>参考:</p>

<ul>
<li><a href="http://qiita.com/shoma2da/items/31edef012f224f99323c">SwiftでAndroidアプリを作る!?</a></li>
</ul>


<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android5.0から5.1にアップデートして文鎮化した事件簿]]></title>
    <link href="http://grandbig.github.io/blog/2015/10/05/android-update-crash/"/>
    <updated>2015-10-05T22:38:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/10/05/android-update-crash</id>
    <content type="html"><![CDATA[<h4>Android OSのアップデートは恐ろしい</h4>

<p>さて、本日はAndroid OSのアップデートに関するお話です。<br/>
筆者は最近、Nexus6をAndroid5.0から5.1にアップデートしようとしたのですが、途中で失敗して端末が文鎮化するという悲劇が発生してしまったので、備忘録です。</p>

<h5>文鎮化までの軌跡</h5>

<p>まずは、如何にしてNexus6が文鎮化したかまで説明します。</p>

<ol>
<li>端末の通知センターからバージョンアップのためのデータをダウンロード</li>
<li>端末を再起動して、インストールしますか？と聞かれるのでYESを選択</li>
<li>アップデートに失敗しました。という文言と共に下図が&hellip;</li>
</ol>


<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p><img src="/images/android-update.png" alt="エラー発生" /></p>

<ol>
<li>嘘だろ&hellip;と思って端末の電源長押しで再起動
永久、再起動ループに&hellip;</li>
<li>電源 + 音量Downボタンを長押しでReboot起動
すると下図のような感じで起動します。<br/>
START, Recovery, Factory&hellip;などのメニューから仕掛けたい動作を選択できます。<br/>
<img src="/images/android-update2.png" alt="Reboot起動" /></li>
<li>順番に全部やっているけど、どれも無限ループに&hellip;</li>
</ol>


<p>はい！文鎮化しましたね。</p>

<h4>文鎮化Nexus6を復旧するまでの軌跡</h4>

<p>まさか文鎮化したNexus6を放っておくわけにはいきません。<br/>
復旧させましょう！</p>

<ol>
<li>LOCKを外す
<code>fastboot oem unlock</code>を実行して、端末のLOCKを解除しましょう。</li>
<li><a href="https://developers.google.com/android/nexus/images?hl=ja">Google Developerサイト</a>からFactory Imageをダウンロード
筆者は5.0.1 (LRX22C)を落としました。</li>
<li>ダウンロードしたフォルダ内にzipファイルがあるので、解凍する</li>
<li>下記のコマンドを実行</li>
</ol>


<p><code>
fastboot flash bootloader bootloader-shamu-moto-apq8084-71.05.img
fastboot reboot-bootloader
sleep 5
fastboot flash radio radio-shamu-d4.0-9625-02.55.04.img
fastboot reboot-bootloader
sleep 5
cd "zipを解凍したフォルダ"
fastboot flash boot boot.img
fastboot flash cache cache.img
fastboot flash recovery recovery.img
fastboot flash system system.img
fastboot flash userdata userdata.img
flashboot reboot
</code></p>

<ol>
<li>再起動したAndroidで初期設定</li>
</ol>


<p>これで復旧させることができました。やったね!!</p>

<p>と言ったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AndroidでRealmで保存した値を確認しよう！]]></title>
    <link href="http://grandbig.github.io/blog/2015/06/22/android-realmbrowser/"/>
    <updated>2015-06-22T00:23:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/06/22/android-realmbrowser</id>
    <content type="html"><![CDATA[<h4>Android Realm Browserを使おう</h4>

<p>さて、<a href="http://grandbig.github.io/blog/2015/06/20/android-realm/">前回の記事</a>で実装したRealmですが、値を確かめたいことがあると思います。<br/>
その方法について見て行きましょう。</p>

<p><a href="https://github.com/dmytrodanylyk/realm-browser">Android Realm Browser</a>を利用することでアプリ上で直接、値を確認することが可能です。</p>

<p>実装手順</p>

<p>１. GradleScripts > build.gradle(Module: app) のdependenciesを修正
<code>compile 'com.github.dmytrodanylyk.realm-browser:library:0.0.2'</code>を<code>dependencies { ... }</code>に追加します。<br/>
２. <code>RealmFilesActivity</code>を起動する処理を追加</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>```java
// MainActivity.java
public class MainActivity extends Activity {</p>

<pre><code>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    ...
    if(result.size() &gt; 0) {
        ...
        // Realmデータ閲覧用のActivityを起動
        RealmBrowser.getInstance().addRealmModel(Engineer.class);
        RealmFilesActivity.start(this);
    } else {
        ...
    }
}
...
</code></pre>

<p>}
```</p>

<p>さて、これでアプリを実行してみましょう。<br/>
下記のような画面を見ることができるはずです。</p>

<p><img src="/images/android-realmbrowser.png" alt="Realmデータ確認画面" /></p>

<h4>ADBで確認する方法</h4>

<p>他にも確認する方法があります。<br/>
Android StudioをPC上で使えるように設定するにあたって、意識せずにADBというツールがインストールされています。<br/>
このADBコマンドを利用することでデバイスの中身を直接見ることが可能となります。</p>

<p>ADB設定手順</p>

<p>１. <code>.bashrc</code>ファイルにADBツールのパスを設定
<code>.bashrc</code>ファイルに<code>export PATH=$PATH:/Users/&lt;ユーザ名&gt;/Library/Android/sdk/platform-tools</code>とパスを設定しましょう。<br/>
２. <code>.bashrc</code>ファイルの変更を反映
<code>source ~/.bashrc</code>を実行</p>

<p>これでADBコマンドを利用可能になりました。<br/>
続いて下記手順で、Realmデータの中身を見て行きましょう。</p>

<p><code>java
$ adb shell
$ run-as com.example.takahiro.realmsample
$ cd files/
$ cat default.realm
</code></p>

<p>日本語を保存している場合は文字化けして見えますが、保存されていることは確認できます。<br/>
本当は<code>adb pull</code>コマンドを使ってPCに<code>default.realm</code>を持ってきて、Realm Browserアプリで中身を見たいのですが、<br/>
今のところうまくコピーできず見れていません&hellip;。<br/>
(因みに端末はNexus6を利用しています。)</p>

<p>とりあえず、<code>Android Realm Browser</code>で見るしかないかな〜といったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
</feed>
