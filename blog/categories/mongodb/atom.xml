<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: mongodb | Takahiro Octopress Blog]]></title>
  <link href="http://grandbig.github.io/blog/categories/mongodb/atom.xml" rel="self"/>
  <link href="http://grandbig.github.io/"/>
  <updated>2018-11-25T01:58:49+09:00</updated>
  <id>http://grandbig.github.io/</id>
  <author>
    <name><![CDATA[Takahiro]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Server Side Swiftã§MongoDBã¨éŠã‚“ã§ã¿ã‚‹]]></title>
    <link href="http://grandbig.github.io/blog/2016/12/05/swift-perfect-mongo/"/>
    <updated>2016-12-05T00:00:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/12/05/swift-perfect-mongo</id>
    <content type="html"><![CDATA[<h3>ã¯ã˜ã‚ã«</h3>

<p>ã“ã¡ã‚‰ã¯<a href="http://qiita.com/advent-calendar/2016/swift2">Swift ãã®2 Advent Calendar 2016</a> 5æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚<br/>
ä»Šå¹´ã¯ç­†è€…ãŒèˆˆå‘³ã‚’æŒã£ã¦ã„ã‚‹ <strong>Server Side Swift</strong> ã«ã¤ã„ã¦æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚
Swiftã‚µãƒ¼ãƒã‚’ç«‹ã¦ã‚‹ãŸã‚ã«ã€<a href="http://grandbig.github.io/blog/2016/10/30/swift-perfect/">ä»¥å‰ã®è¨˜äº‹</a>ã§ã‚‚åˆ©ç”¨ã—ãŸ<a href="https://github.com/PerfectlySoft/Perfect">Perfect</a>ã‚’ä½¿ã„ã¾ã™ã€‚</p>

<p>ãŸã å˜ã«Swiftã‚µãƒ¼ãƒã‚’ç«‹ã¦ã¦ã‚‚é¢ç™½ããªã„ã®ã§ã€æä¾›ã•ã‚Œã¦ã„ã‚‹MongoDBæ¥ç¶šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦éŠã‚“ã§ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h3>Swiftã«ã‚ˆã‚‹APãƒ»DBã‚µãƒ¼ãƒã®æ§‹ç¯‰</h3>

<p>æ—©é€Ÿã€Perfectã‚’ç”¨ã„ã¦Swiftã«ã‚ˆã‚‹APãƒ»DBã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚<br/>
åŸºæœ¬çš„ã«ã¯<a href="https://github.com/PerfectlySoft/Perfect-MongoDB">ReadMe</a>ã«å¾“ãˆã°è‰¯ã„ã®ã§ã™ãŒã€ä¸å¯§ã«ï¼‘ã¤ãšã¤è¦‹ã¦ã„ãã¾ã™ã€‚</p>

<h4>å¿…è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h4>

<p>æµçŸ³ã« <strong>Homebrew</strong> ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹æ–¹ãŒå¤šã„ã¨æ€ã„ã¾ã™ãŒã€å…¥ã‚Œã¦ã„ãªã„æ–¹ã¯ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚</p>

<p><code>
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
</code></p>

<p>ã¾ãŸä»Šå›ã¯ <strong>MongoDB</strong> ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã€ <strong>mongodb</strong> ãŠã‚ˆã³ <strong>mongo-c</strong> ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br/>
mongodbã«é–¢ã—ã¦ã¯ã€</p>

<p><code>
brew install mongodb
</code></p>

<p>ã§OKã§ã™ã€‚(è‡ªå‹•èµ·å‹•ãªã©ã«é–¢ã—ã¦ã¯<a href="http://grandbig.github.io/blog/2016/11/20/brew-install-db/">ã“ã¡ã‚‰</a>ã‚’å‚ç…§ãã ã•ã„ã€‚)<br/>
ç¶šã„ã¦ã€mongo-cã¯</p>

<p><code>
brew install mongo-c
</code></p>

<p>ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã§ãã‚‹ã¯ãšã§ã™ã€‚</p>

<h4>xcodeprojã‚’ä½œæˆ</h4>

<h5>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h5>

<p>0ã‹ã‚‰Perfectã‚’ç”¨ã„ã¦ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒã€Perfectã§ã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚<br/>
ã›ã£ã‹ããªã®ã§ <code>git clone</code> ã—ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚</p>

<p><code>
git clone https://github.com/PerfectlySoft/PerfectTemplate.git
cd PerfectTemplate
</code></p>

<h5>MongoDBãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ç·¨é›†</h5>

<p><strong>Perfect-MongoDB</strong> ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€<code>Package.swift</code>ã‚’ç·¨é›†ã—ã¾ã—ã‚‡ã†ã€‚</p>

<p>```objective-c
import PackageDescription</p>

<p>let package = Package(</p>

<pre><code>name: "PerfectTemplate",
targets: [],
dependencies: [
    .Package(url: "https://github.com/PerfectlySoft/Perfect-HTTPServer.git", majorVersion: 2, minor: 0),
    .Package(url:"https://github.com/PerfectlySoft/PerfectLib.git", majorVersion: 2, minor: 0),
    .Package(url:"https://github.com/PerfectlySoft/Perfect-MongoDB.git", majorVersion: 2, minor: 0)
]
</code></pre>

<p>)
```</p>

<p>ReadMeã§ã¯ <strong>Perfect-HTTPServer</strong> ã¯æ›¸ã‹ã‚Œã¦ã„ãªã„ã®ã§ã™ãŒã€ã“ã‚Œã‚’ä½¿ã£ãŸæ–¹ãŒä¾¿åˆ©ãªã®ã§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ®‹ã—ãŸã¾ã¾é€²ã‚ã¾ã™ã€‚</p>

<h5>Packageã‹ã‚‰xcodeprojã‚’ä½œæˆ</h5>

<p><code>Package.swift</code>ã®ç·¨é›†ãŒçµ‚ã‚ã£ãŸã‚‰ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦<code>xcodeproj</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚</p>

<p><code>
swift package generate-xcodeproj
</code></p>

<p>ãã†ã™ã‚Œã°ä¸‹å›³ã®ã‚ˆã†ãªçµæœãŒå¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚</p>

<p><img src="/images/perfect-mongo_1.png" alt="ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ" /></p>

<h4>MongoDBã«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</h4>

<p>ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒãªãã‚ƒè©±ã«ãªã‚Šã¾ã›ã‚“ã‚ˆã­ï¼Ÿ<br/>
ã¨ã„ã†ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚</p>

<p>```
// MongoDBã«ã‚¢ã‚¯ã‚»ã‚¹
$ mongo</p>

<p>// DBã¨Collectionã®ä½œæˆ</p>

<blockquote><p>use test;
db.createCollection(&lsquo;testCollection&rsquo;);
{ &ldquo;ok&rdquo; : 1 }</p></blockquote>

<p>// DBã®ç¢ºèª</p>

<blockquote><p>show dbs;
local  0.000GB
test   0.000GB</p></blockquote>

<p>// Collectionã®ç¢ºèª</p>

<blockquote><p>show collections
testCollection</p></blockquote>

<p>// ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ã‚µãƒ¼ãƒˆ</p>

<blockquote><p>db.testCollection.insert({name: &lsquo;takahiro&rsquo;, age: 30, hobby: &lsquo;blog&rsquo;});
WriteResult({ &ldquo;nInserted&rdquo; : 1 })
db.testCollection.insert({name: &lsquo;ichiro&rsquo;, age: 43, hobby: &lsquo;baseball&rsquo;});
WriteResult({ &ldquo;nInserted&rdquo; : 1 })</p></blockquote>

<p>// ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª</p>

<blockquote><p>db.testCollection.find()
{ &ldquo;<em>id&rdquo; : ObjectId(&ldquo;58391469a8589d99c931303c&rdquo;), &ldquo;name&rdquo; : &ldquo;takahiro&rdquo;, &ldquo;age&rdquo; : 30, &ldquo;hobby&rdquo; : &ldquo;blog&rdquo; }
{ &ldquo;</em>id&rdquo; : ObjectId(&ldquo;58392222a8589d99c931303d&rdquo;), &ldquo;name&rdquo; : &ldquo;ichiro&rdquo;, &ldquo;age&rdquo; : 43, &ldquo;hobby&rdquo; : &ldquo;baseball&rdquo; }
```</p></blockquote>

<h4>MongoDBã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—</h4>

<p>ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã‚‚å®Œäº†ã—ãŸã®ã§ã€å®Ÿéš›ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§MongoDBã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å‡¦ç†ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br/>
(ReadMeã§ã¯Perfect-HTTPServerã‚’åˆ©ç”¨ã—ãªã„æ–¹æ³•ã§æ›¸ã‹ã‚Œã¦ã„ãŸãŸã‚æœ¬è¨˜äº‹ã¨ã¯è‹¥å¹²ç•°ãªã‚Šã¾ã™ã€‚)</p>

<h5>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª</h5>

<p>ã¾ãšã¯ã€åˆã‚ã‹ã‚‰ä½œæˆã•ã‚Œã¦ã„ã‚‹å‡¦ç†å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚<br/>
èª¬æ˜ã¯ä¸‹è¨˜ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ãŸã®ã§å‚ç…§ãã ã•ã„ã€‚</p>

<p>```objective-c
// main.swift
import PerfectLib
import PerfectHTTP
import PerfectHTTPServer</p>

<p>// HTTPã‚µãƒ¼ãƒã®ç”Ÿæˆ
let server = HTTPServer()</p>

<p>// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã™ã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®š
var routes = Routes()
routes.add(method: .get, uri: &ldquo;/&rdquo;, handler: {</p>

<pre><code>request, response in
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
response.setHeader(.contentType, value: "text/html")
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®è¨­å®š
response.appendBody(string: "&lt;html&gt;&lt;title&gt;Hello, world!&lt;/title&gt;&lt;body&gt;Hello, world!&lt;/body&gt;&lt;/html&gt;")
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å®Œäº†å‡¦ç†
response.completed()
}
</code></pre>

<p>)</p>

<p>// ã‚µãƒ¼ãƒã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã‚’é©ç”¨
server.addRoutes(routes)</p>

<p>// ãƒãƒ¼ãƒˆã‚’è¨­å®š
server.serverPort = 8181</p>

<p>// ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã®ãƒ‘ã‚¹ã‚’è¨­å®š
server.documentRoot = &ldquo;./webroot&rdquo;</p>

<p>// arguments.swiftã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
// æ›´ãªã‚‹ã‚µãƒ¼ãƒå®šç¾©ãŒå¿…è¦ãªå ´åˆã¯ã“ã“ã‚’è¦‹ã¾ã—ã‚‡ã†(SSLãªã©)
configureServer(server)</p>

<p>do {</p>

<pre><code>// HTTPã‚µãƒ¼ãƒã®èµ·å‹•
try server.start()
</code></pre>

<p>} catch PerfectError.networkError(let err, let msg) {</p>

<pre><code>print("Network error thrown: \(err) \(msg)")
</code></pre>

<p>}
```</p>

<p>ä¸Šè¨˜ã‚’Xcodeã‚’ã‹ã‚‰Runã•ã›ãŸçŠ¶æ…‹ã§ <code>http://localhost:8181</code> ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br/>
Hello Worldã®çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚</p>

<p><img src="/images/perfect-mongo_2.png" alt="Hello World" /></p>

<h5>MongoDBé–¢é€£å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ</h5>

<p>ç¶šã„ã¦ã€MongoDBã¸ã®æ¥ç¶šãƒ»åˆ‡æ–­ã‚„ãƒ‡ãƒ¼ã‚¿å–å¾—ãªã©ã®å‡¦ç†ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚<br/>
ã“ã‚Œã¯åˆ¥ã‚¯ãƒ©ã‚¹ã®ä¸­ã«æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>

<p>ä»Šå›ã¯MongoDBé–¢é€£ã®å‡¦ç†ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã¨ã„ã†ã“ã¨ã§<code>mongoHandler.swift</code>ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚<br/>
å› ã¿ã«ãŸã ä½œæˆã—ãŸã ã‘ã§ã¯ã€XcodeãŒCompileå¯¾è±¡ã¨ã—ã¦æ­£ã—ãèªè­˜ã—ã¦ãã‚Œãªã„ã®ã§ã€è‡ªèº«ã§è¨­å®šã‚’å¤‰ãˆã¾ã—ã‚‡ã†ã€‚<br/>
ä¸‹å›³ã®ã‚ˆã†ã«TARGETSã‹ã‚‰å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã€Compile Sourcesã¨ã—ã¦<code>mongoHandler.swift</code>ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>

<p><img src="/images/perfect-mongo_3.png" alt="Compile Sourcesã«è¿½åŠ " /></p>

<p>ã§ã¯å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>

<p>```objective-c
// mongoHandler.swift</p>

<p>import PerfectLib
import PerfectHTTP
import MongoDB</p>

<p>class MongoHandler {</p>

<p>  var client: MongoClient?
  var database: MongoDatabase?
  var collection: MongoCollection?</p>

<p>  // MongoDBã¸ã®æ¥ç¶šå‡¦ç†
  fileprivate func connect() {</p>

<pre><code>// ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ç¢ºç«‹
client = try! MongoClient(uri: "mongodb://localhost")

// testãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ¥ç¶š
database = client?.getDatabase(name: "test")

// testCollectionã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®æ¥ç¶š
self.collection = database?.getCollection(name: "testCollection")
</code></pre>

<p>  }</p>

<p>  // MongoDBã‹ã‚‰ã®åˆ‡æ–­å‡¦ç†
  fileprivate func close() {</p>

<pre><code>collection?.close()
database?.close()
client?.close()
</code></pre>

<p>  }</p>

<p>  func searchAll(request: HTTPRequest, _ response: HTTPResponse) {</p>

<pre><code>// MongoDBã¸ã®æ¥ç¶š
connect()
// æŒ‡å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å‡¦ç†çµ‚äº†
guard let collection = self.collection else {
  return
}

// ãƒ‡ãƒ¼ã‚¿å…¨ä»¶å–å¾—ã®ãŸã‚BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ã‚¯ã‚¨ãƒªã¨ã—ã¦è¨­å®š
let fnd = collection.find(query: BSON())

// ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨ã«é…åˆ—ã‚’å®šç¾©
var arr = [String]()

// å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—ã«æ ¼ç´ã™ã‚‹
// fndã¯MongoCursorå‹ã§ã‚ã‚Šã€foræ–‡ã§ã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãŒå¯èƒ½
for x in fnd! {
    arr.append(x.asString)
}

// JSONStringã«å¤‰æ›
let returning = "{\"data\":[\(arr.joined(separator: ","))]}"

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¨­å®š
response.appendBody(string: returning)
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†å®Œäº†
response.completed()

// MongoDBã‹ã‚‰åˆ‡æ–­
close()
</code></pre>

<p>  }
}
```</p>

<p>MongoDBã¸ã®æ¥ç¶šãƒ»åˆ‡æ–­å‡¦ç†ã¯å…±é€šå‡¦ç†ã¨ãªã‚‹ã“ã¨ã¯å®¹æ˜“ã«æƒ³åƒã§ãã‚‹ãŸã‚ã€åˆ‡ã‚Šå‡ºã—ã¾ã—ãŸã€‚</p>

<h5>main.swiftã‹ã‚‰mongoHandler.swiftã‚’å‘¼ã³å‡ºã™</h5>

<p>ã•ã¦ã€<code>main.swift</code>ã‹ã‚‰<code>mongoHandler.swift</code>ã‚’å‘¼ã³å‡ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<p>```objective-c
// main.swift
// MongoHandlerã®åˆæœŸåŒ–
let mongoHandler = MongoHandler()</p>

<p>// GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§MongoDBã®ãƒ‡ãƒ¼ã‚¿å…¨å–å¾—
routes.add(method: .get, uri: &ldquo;/mongo&rdquo;, handler: {</p>

<pre><code>request, response in
mongoHandler.searchAll(request: request, response)
</code></pre>

<p>})
```</p>

<p>ã“ã‚Œã§<code>http://localhost:8181</code>ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚Œã°ä¸‹å›³ã®ã‚ˆã†ãªçµæœãŒå¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚</p>

<p><img src="/images/perfect-mongo_4.png" alt="ãƒ‡ãƒ¼ã‚¿å…¨ä»¶å–å¾—çµæœ" /></p>

<h4>MongoDBã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦æŒ‡å®šã®ã‚¯ã‚¨ãƒªã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—</h4>

<p>å…¨ä»¶å–å¾—ã®æ–¹æ³•ã¯ã‚ã‹ã£ãŸã®ã§ã€ç¶šã„ã¦ã‚¯ã‚¨ãƒªã‚ã‚Šã®æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br/>
å…ˆç¨‹è¿°ã¹ãŸé€šã‚Šã€ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<p>```
// ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª</p>

<blockquote><p>db.testCollection.find()
{ &ldquo;<em>id&rdquo; : ObjectId(&ldquo;58391469a8589d99c931303c&rdquo;), &ldquo;name&rdquo; : &ldquo;takahiro&rdquo;, &ldquo;age&rdquo; : 30, &ldquo;hobby&rdquo; : &ldquo;blog&rdquo; }
{ &ldquo;</em>id&rdquo; : ObjectId(&ldquo;58392222a8589d99c931303d&rdquo;), &ldquo;name&rdquo; : &ldquo;ichiro&rdquo;, &ldquo;age&rdquo; : 43, &ldquo;hobby&rdquo; : &ldquo;baseball&rdquo; }
```</p></blockquote>

<p><code>name</code>ã€<code>age</code>ã€<code>hobby</code>ã‚’æŒ‡å®šã—ã¦æ¤œç´¢ã™ã‚‹ã®ã¯ãã‚“ãªã«é›£ã—ããªã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h5>nameã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—</h5>

<p>ã‚ã‹ã‚Šã‚„ã™ã„ã¨ã“ã‚ã‹ã‚‰ã¨è¨€ã†ã“ã¨ã§<code>name</code>ã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã¿ã¾ã™ã€‚<br/>
ã¾ãšã¯<code>mongoHandler.swift</code>ã«ã‚¯ã‚¨ãƒªæŒ‡å®šã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚</p>

<p>```objective-c
// mongoHandler.swift
import PerfectLib
import PerfectHTTP
import MongoDB</p>

<p>class MongoHandler {</p>

<pre><code>var client: MongoClient?
var database: MongoDatabase?
var collection: MongoCollection?

    fileprivate func connect() {

    // open a connection
    client = try! MongoClient(uri: "mongodb://localhost")

    // set database, assuming "test" exists
    database = client?.getDatabase(name: "test")

    // define collection
    self.collection = database?.getCollection(name: "testCollection")
}

fileprivate func close() {
    collection?.close()
    database?.close()
    client?.close()
}

    // searchAllãƒ¡ã‚½ãƒƒãƒ‰ã¯çœç•¥

    // =====ã“ã“ã‹ã‚‰è¿½åŠ ========================================================
    func search(query: BSON, request: HTTPRequest, _ response: HTTPResponse) {
        // MongoDBã¸ã®æ¥ç¶š
        connect()

        // æŒ‡å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å‡¦ç†çµ‚äº†
  guard let collection = self.collection else {
      return
  }

  // ã‚¯ã‚¨ãƒªã‚’æŒ‡å®šã—ã¦æ¤œç´¢
  let fnd = collection.find(query: query)

  // ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨ã«é…åˆ—ã‚’å®šç¾©
  var arr = [String]()

        // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—ã«æ ¼ç´ã™ã‚‹
    // fndã¯MongoCursorå‹ã§ã‚ã‚Šã€foræ–‡ã§ã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãŒå¯èƒ½
  for x in fnd! {
      arr.append(x.asString)
  }

  // JSONStringã«å¤‰æ›
  let returning = "{\"data\":[\(arr.joined(separator: ","))]}"

  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¨­å®š
  response.appendBody(string: returning)
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†å®Œäº†
  response.completed()

        // MongoDBã‹ã‚‰åˆ‡æ–­
  close()
}
</code></pre>

<p>}
```</p>

<p><code>searchAll</code>ã¨ã®é•ã„ã¯å¼•æ•°ã«<code>BSON</code>å‹ã®<code>query</code>ã‚’è¿½åŠ ã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚</p>

<p>ç¶šã„ã¦ã€<code>main.swift</code>ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§<code>name</code>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒãƒã§ãã‚‹ã‚ˆã†ã«å‡¦ç†ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>

<p>```objective-c
// main.swift
import PerfectLib
import PerfectHTTP
import PerfectHTTPServer
import MongoDB                  // ã“ã“ã‚’è¿½åŠ </p>

<p>// çœç•¥</p>

<p>// nameãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã—ãŸGETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
routes.add(method: .get, uri: &ldquo;/mongo/name/{name}&rdquo;, handler: {
  request, response in</p>

<pre><code>// BSONå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–(ã‚¯ã‚¨ãƒªã¨ã—ã¦æ¸¡ã™)
</code></pre>

<p>  let bson = BSON()
  defer {</p>

<pre><code>    // å‡¦ç†å®Œäº†æ™‚ã«BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤
bson.close()
</code></pre>

<p>  }</p>

<pre><code>// ã‚¯ã‚¨ãƒªã¨ã—ã¦æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
</code></pre>

<p>  bson.append(key: &ldquo;name&rdquo;, string: request.urlVariables[&ldquo;name&rdquo;]!)</p>

<pre><code>// ã‚¯ã‚¨ãƒªã‚’æŒ‡å®šã—ã¦æ¤œç´¢
</code></pre>

<p>  mongoHandler.search(query: bson, request: request, response)
})
```</p>

<p>ã“ã‚Œã ã‘ã§æº–å‚™ä¸‡ç«¯ã§ã™ã€‚<br/>
<code>http://localhost:8181/name/takahiro</code>ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä¸‹è¨˜çµæœãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚</p>

<p><img src="/images/perfect-mongo_5.png" alt="nameãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã—ãŸGETãƒªã‚¯ã‚¨ã‚¹ãƒˆçµæœ" />_</p>

<h5>ObjectIdã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—</h5>

<p>ç¶šã„ã¦ã€å°‘ã—ã‚¯ã‚¨ãƒªã®æ›¸ãæ–¹ã«è¿·ã†ã‹ã‚‚ã—ã‚Œãªã„<code>ObjectId</code>ã‚’æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿æ¤œç´¢ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br/>
<code>mongoHandler.swift</code>ã«ã¯ç‰¹ã«å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br/>
<code>main.swift</code>ã®ã¿å¤‰æ›´ã—ã¦ã„ãã¾ã™ã€‚</p>

<p>```objective-c
// main.swift
import PerfectLib
import PerfectHTTP
import PerfectHTTPServer
import MongoDB
import libmongoc                // ã“ã“ã‚’è¿½åŠ </p>

<p>// çœç•¥</p>

<p>// ObjectIdãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã—ãŸGETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
routes.add(method: .get, uri: &ldquo;/mongo/oid/{oid}&rdquo;, handler: {
  request, response in</p>

<pre><code>// BSONå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–(ã‚¯ã‚¨ãƒªã¨ã—ã¦æ¸¡ã™)
</code></pre>

<p>  let bson = BSON()
  defer {</p>

<pre><code>    // å‡¦ç†å®Œäº†æ™‚ã«BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤
bson.close()
</code></pre>

<p>  }</p>

<pre><code>// bson_oid_tå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–
</code></pre>

<p>  var oid: bson_oid_t = bson_oid_t()</p>

<pre><code>// Stringå‹ã‹ã‚‰bson_oid_tå‹ã«å¤‰æ›
</code></pre>

<p>  bson_oid_init_from_string(&amp;oid, request.urlVariables[&ldquo;oid&rdquo;])</p>

<pre><code>// ã‚¯ã‚¨ãƒªã¨ã—ã¦æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
</code></pre>

<p>  bson.append(key: &ldquo;_id&rdquo;, oid: oid)</p>

<pre><code>// ã‚¯ã‚¨ãƒªã‚’æŒ‡å®šã—ã¦æ¤œç´¢
</code></pre>

<p>  mongoHandler.search(query: bson, request: request, response)
})
```</p>

<p>è‚ãªã®ãŒã€<code>import libmongoc</code>ã‚’ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚<br/>
ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å„ç¨®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§Server Side Swiftã‹ã‚‰<code>ObjectId</code>ã‚’æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿æ¤œç´¢ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>

<p>å°‘ã—è©³ã—ãèª¬æ˜ã™ã‚‹ã¨ã€<br/>
ã‚¯ã‚¨ãƒªã¨ã—ã¦<code>ObjectId</code>ã‚’æ¸¡ã™ãŸã‚ã«ã¯<code>public func append(key k: String, oid: bson_oid_t) -&gt; Bool</code>ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br/>
ã—ã‹ã—ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®ç¬¬äºŒå¼•æ•°ã‚’ã‚ˆãè¦‹ã‚‹ã¨ã€<code>bson_oid_t</code>å‹ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p>

<p>GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ™‚ç‚¹ã§<code>bson_oid_t</code>å‹ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã‚ã‘ã«ã‚‚ã„ã‹ãªã„ã®ã§ã€  ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰å´ã§å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br/>
ãã®ãŸã‚ã«åˆ©ç”¨ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãŒ<code>void bson_oid_init_from_string (bson_oid_t *oid, const char *str);</code>ã§ã™ã€‚<br/>
ç­†è€…ã‚‚Swiftã§åˆã‚ã¦åˆ©ç”¨ã—ãŸã®ã§ã™ãŒã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯æˆ»ã‚Šå€¤ãŒ<code>void</code>å‹ã®ãŸã‚ä½•ã‚‚è¿”ã£ã¦ãã¾ã›ã‚“ã€‚<br/>
ãŒã€ç¬¬ä¸€å¼•æ•°ã«å‚ç…§æ¸¡ã—ã¨ã—ã¦<code>bson_oid_t</code>å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†çµæœãŒ<code>oid</code>ã«æ ¼ç´ã•ã‚Œã¾ã™ã€‚<br/>
ã“ã‚Œã§ã‚ã§ãŸãã‚¯ã‚¨ãƒªã¨ã—ã¦<code>ObjectId</code>ãŒè¨­å®šã§ãã‚‹ã‚ã‘ã§ã™ã€‚</p>

<p>ã§ã¯ã€<code>http://localhost:8181/oid/58392222a8589d99c931303d</code>ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<p><img src="/images/perfect-mongo_6.png" alt="ObjectIdãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã—ãŸGETãƒªã‚¯ã‚¨ã‚¹ãƒˆçµæœ" /></p>

<h4>MongoDBã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</h4>

<p>æ¤œç´¢ã«é–¢ã—ã¦ã¯ã–ã£ã¨è¦‹ã¦ããŸã®ã§ã€MongoDBã¸ã®ä¿å­˜å‡¦ç†ã‚‚è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>

<h5>insertãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</h5>

<p>ä¿å­˜ã«ã¯<code>MongoClient</code>ã®<code>insert</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚<br/>
(ä»–ã«ã‚‚<code>save</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ã‚ã‚Šã¾ã™ã€‚)</p>

<p>ã¾ãšã¯ <code>mongoHandler.swift</code> ã¸ã®ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã‹ã‚‰ã§ã™ã€‚</p>

<p>```objective-c
// mongoHandler.swift
func save(query: BSON, request: HTTPRequest, response: HTTPResponse) {</p>

<pre><code>// MongoDBã¸ã®æ¥ç¶š
connect()

// æŒ‡å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å‡¦ç†çµ‚äº†
</code></pre>

<p>  guard let collection = self.collection else {</p>

<pre><code>return
</code></pre>

<p>  }</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜å‡¦ç†
</code></pre>

<p>  let insert = collection.insert(document: query) as MongoResult</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿ä¿å­˜çµæœã«ã‚ˆã£ã¦è¿”å´å€¤ã‚’å¤‰æ›´
</code></pre>

<p>  var returning = &ldquo;Failed&rdquo;
  switch insert {
  case .success:</p>

<pre><code>returning = "Succeeded"
</code></pre>

<p>  default:</p>

<pre><code>returning = "Failed"
</code></pre>

<p>  }</p>

<pre><code>// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¨­å®š
</code></pre>

<p>  response.appendBody(string: returning)</p>

<pre><code>// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†å®Œäº†
</code></pre>

<p>  response.completed()</p>

<pre><code>// MongoDBã‹ã‚‰åˆ‡æ–­
</code></pre>

<p>  close()
}
```</p>

<p>æ¬¡ã«POSTã§å±Šã„ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒJSONStringãªã®ã§Dictionaryå‹ã«å¤‰æ›ã—ã¾ã™ã€‚<br/>
ãã®å‡¦ç†ã‚’ <code>decode.swift</code> ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°è¦ä½œæˆã—ã¦è¿½åŠ ã—ã¾ã™ã€‚</p>

<p>```objective-c
// decode.swift
import PerfectHTTPServer
import PerfectLib</p>

<p>func decode(postBody: String?) &ndash;> [String: Any]? {
  do {</p>

<pre><code>guard let decoded = try postBody?.jsonDecode() as? [String:Any] else {
  return [:]
}
print(decoded)
return decoded
} catch {
return [:]
}
</code></pre>

<p>}
```</p>

<p>ãã—ã¦ <code>main.swift</code> ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚</p>

<p>```objective-c
// main.swift
routes.add(method: .post, uri: &ldquo;/mongo/&rdquo;, handler: {</p>

<pre><code>request, response in
// BSONå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–(ã‚¯ã‚¨ãƒªã¨ã—ã¦æ¸¡ã™)
</code></pre>

<p>  let bson = BSON()
  defer {</p>

<pre><code>    // å‡¦ç†å®Œäº†æ™‚ã«BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤
bson.close()
</code></pre>

<p>  }</p>

<pre><code>// JSONStringå‹ã‚’Dictionaryå‹ã«å¤‰æ›
</code></pre>

<p>  let decodedParam = decode(postBody: request.postBodyString)</p>

<pre><code>// å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å˜ä½ã§BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ ¼ç´
</code></pre>

<p>  for (key, value) in decodedParam! {</p>

<pre><code>  switch key {
  case "name":
      bson.append(key: "name", string: value as! String)
  case "age":
      bson.append(key: "age", int32: Int32(value as! Int))
  case "hobby":
      bson.append(key: "hobby", string: value as! String)
  default:
      break
  }
</code></pre>

<p>  }</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿ä¿å­˜
</code></pre>

<p>  mongoHandler.save(query: bson, request: request, response: response)
})
```</p>

<p>ã“ã‚Œã§å‡¦ç†ã¯å®Œæˆã§ã™ã€‚<br/>
ã§ã¯POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<p><code>
$ curl http://localhost:8181/mongo -X POST -H "Content-Type: application/json" -d '{"name":"Hanako", "age": 24, "hobby": "game"}'
</code></p>

<p>å†åº¦ã€MongoDBã‚’æ¤œç´¢ã—ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªçµæœãŒå¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚</p>

<p>```
// ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª</p>

<blockquote><p>db.testCollection.find()
{ &ldquo;<em>id&rdquo; : ObjectId(&ldquo;58391469a8589d99c931303c&rdquo;), &ldquo;name&rdquo; : &ldquo;takahiro&rdquo;, &ldquo;age&rdquo; : 30, &ldquo;hobby&rdquo; : &ldquo;blog&rdquo; }
{ &ldquo;</em>id&rdquo; : ObjectId(&ldquo;58392222a8589d99c931303d&rdquo;), &ldquo;name&rdquo; : &ldquo;ichiro&rdquo;, &ldquo;age&rdquo; : 43, &ldquo;hobby&rdquo; : &ldquo;baseball&rdquo; }
{ &ldquo;_id&rdquo; : ObjectId(&ldquo;583afcaedcab265c1821fb51&rdquo;), &ldquo;name&rdquo; : &ldquo;Hanako&rdquo;, &ldquo;age&rdquo; : 24, &ldquo;hobby&rdquo; : &ldquo;game&rdquo; }
```</p></blockquote>

<p>å› ã¿ã«ã€<code>main.swift</code>ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å–å¾—ã—ãŸ<code>age</code>ã‚’ <strong>Int32</strong> å‹ã«å¤‰æ›ã—ã¦ã„ã‚‹ã®ã«ã¯ç†ç”±ãŒã‚ã‚Šã¾ã™ã€‚<br/>
ã“ã‚Œã‚’ä»®ã« <code>bson.append(key: "age", int: value as! Int)</code> ã¨ã—ãŸå ´åˆã€MongoDBã«ã¯ <code>NumberLong</code>ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ <br/>
ã“ã‚Œã¯32bitã‹64bitã‹ã®é•ã„ã§ã™ã­ã€‚</p>

<h5>insertãƒ¡ã‚½ãƒƒãƒ‰ã®MongoInsertFlagã«ã¤ã„ã¦</h5>

<p>å…ˆç¨‹ã€<code>insert</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã—ãŸãŒã€å®Ÿã¯ç¬¬ä¸€å¼•æ•°ã®ã¿æŒã£ã¦ã„ã‚‹ <code>insert</code> ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚<br/>
å®Ÿã¯ä»–ã«ã‚‚ <code>public func insert(document: BSON, flag: MongoInsertFlag = .none) -&gt; Result</code> ã¨ã„ã£ãŸç¬¬äºŒå¼•æ•°ã‚’æŒã¤ <code>insert</code> ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã™ã€‚</p>

<p>å°‘ã—æ°—ã«ãªã£ãŸã®ã§ã“ã® <code>MongoInsertFlag</code>ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚<br/>
<code>MongoInsertFlag</code>ã¯<code>MongoCollection.swift</code>å†…ã« <strong>enum</strong> ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<p>```objective-c
public enum MongoInsertFlag: Int {</p>

<pre><code>case none
case continueOnError
case noValidate

var mongoFlag: mongoc_insert_flags_t {
    switch self {
    case .none:
        return MONGOC_INSERT_NONE
    case .continueOnError:
        return MONGOC_INSERT_CONTINUE_ON_ERROR
    case .noValidate:
        return mongoc_insert_flags_t(rawValue: MONGOC_INSERT_NO_VALIDATE)
    }
}
</code></pre>

<p>}
```</p>

<p>ã“ã“ã§<code>MONGOC_INSERT_NONE</code>, <code>MONGOC_INSERT_CONTINUE_ON_ERROR</code>, <code>MONGOC_INSERT_NO_VALIDATE</code>ã®3ã¤ãŒãƒ•ãƒ©ã‚°ã¨ã—ã¦ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚<br/>
ã“ã‚Œã‚‰ã¯ãã‚Œãã‚Œæ¬¡ã®ã‚ˆã†ãªæ„å‘³ã¨ã®ã“ã¨ã§ã™ã€‚</p>

<ul>
<li><code>MONGOC_INSERT_NONE</code>

<ul>
<li>ç‰¹åˆ¥ä½•ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
</ul>
</li>
<li><code>MONGOC_INSERT_CONTINUE_ON_ERROR</code>

<ul>
<li>é€”ä¸­ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã¨ã—ã¦ã‚‚å¾Œç¶šã®<code>insert</code>å‡¦ç†ãŒã‚ã‚‹å ´åˆã¯ç¶šã‘ã‚‹</li>
</ul>
</li>
<li><code>MONGOC_INSERT_NO_VALIDATE</code>

<ul>
<li>ã‚¤ãƒ³ã‚µãƒ¼ãƒˆå‰ã«å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’ã—ãªã„

<ul>
<li>MongoDBã¸ã®ä¿å­˜å‡¦ç†å‰ã«APã‚µãƒ¼ãƒæ™‚ç‚¹ãªã©ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã¯ã—ãŸæ–¹ãŒè‰¯ã„</li>
</ul>
</li>
<li>ã“ã‚Œã‚’ã™ã‚‹ã“ã¨ã§å‡¦ç†æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã“ã¨ãŒã§ãã‚‹</li>
</ul>
</li>
</ul>


<h4>MongoDBã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°</h4>

<p>MongoDBã¸ã®æ›´æ–°å‡¦ç†ã‚‚è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>

<h5>updateãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</h5>

<p>ä¿å­˜ã«ã¯<code>MongoClient</code>ã®<code>update</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚</p>

<p><code>mongoHandler.swift</code>ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p>

<p>```objective-c
// mongoHandler.swift
func update(update: BSON, selector: BSON, request: HTTPRequest, response: HTTPResponse) {</p>

<pre><code>// MongoDBã¸ã®æ¥ç¶š
connect()

// æŒ‡å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å‡¦ç†çµ‚äº†
</code></pre>

<p>  guard let collection = self.collection else {</p>

<pre><code>return
</code></pre>

<p>  }</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
</code></pre>

<p>  let updated = collection.update(update: update, selector: query)</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿æ›´æ–°çµæœã«ã‚ˆã£ã¦è¿”å´å€¤ã‚’å¤‰æ›´
</code></pre>

<p>  var returning = &ldquo;Failed&rdquo;
  switch updated {
  case .success:</p>

<pre><code>returning = "Succeeded"
</code></pre>

<p>  default:</p>

<pre><code>returning = "Failed"
</code></pre>

<p>  }</p>

<pre><code>// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¨­å®š
</code></pre>

<p>  response.appendBody(string: returning)</p>

<pre><code>// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†å®Œäº†
</code></pre>

<p>  response.completed()</p>

<pre><code>// MongoDBã‹ã‚‰åˆ‡æ–­
</code></pre>

<p>  close()
}
```</p>

<p>ãã—ã¦ <code>main.swift</code> ã«PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚</p>

<p>```objective-c
// main.swift
routes.add(method: .post, uri: &ldquo;/mongo/&rdquo;, handler: {</p>

<pre><code>request, response in
// BSONå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–(æ›´æ–°å†…å®¹ã¨ã—ã¦æ¸¡ã™)
</code></pre>

<p>  let updateBson = BSON()</p>

<pre><code>// BSONå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–(ã‚¯ã‚¨ãƒªã¨ã—ã¦æ¸¡ã™)
let selectorBson = BSON()
</code></pre>

<p>  defer {</p>

<pre><code>    // å‡¦ç†å®Œäº†æ™‚ã«BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤
updateBson.close()
    selectorBson.close()
</code></pre>

<p>  }</p>

<pre><code>// JSONStringå‹ã‚’Dictionaryå‹ã«å¤‰æ›
</code></pre>

<p>  let decodedParam = decode(postBody: request.postBodyString)</p>

<pre><code>// å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å˜ä½ã§BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ ¼ç´
</code></pre>

<p>  for (key, value) in decodedParam! {</p>

<pre><code>  switch key {
  case "name":
      updateBson.append(key: "name", string: value as! String)
  case "age":
      updateBson.append(key: "age", int32: Int32(value as! Int))
  case "hobby":
      updateBson.append(key: "hobby", string: value as! String)
  default:
      break
  }
</code></pre>

<p>  }</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿æ›´æ–°
</code></pre>

<p>  mongoHandler.update(update: updateBson, query: selectorBson, request: request, response: response)
})
```</p>

<p>åŸºæœ¬çš„ã«ã¯POSTã¨åŒã˜æ„Ÿã˜ã§å‡¦ç†ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚<br/>
ã—ã‹ã—ãªãŒã‚‰æ°—ã‚’ã¤ã‘ãªãã¦ã¯ã„ã‘ãªã„ã®ãŒã€<strong>$setãŒåˆ©ç”¨ã§ããªã„</strong> ã¨ã„ã†ã“ã¨ã§ã™ã€‚<br/>
é€šå¸¸ã€MongoDBã§ã¯ã€ <strong>$setã‚’ä½¿ã‚ãªã„ã¨</strong> &hellip;</p>

<p>```
// ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª</p>

<blockquote><p>db.testCollection.find();
{ &ldquo;_id&rdquo; : ObjectId(&ldquo;583afcaedcab265c1821fb51&rdquo;), &ldquo;name&rdquo; : &ldquo;Hanako&rdquo;, &ldquo;age&rdquo; : 24, &ldquo;hobby&rdquo; : &ldquo;game&rdquo; }</p></blockquote>

<p>// ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°</p>

<blockquote><p>db.testCollection.update({_id: ObjectId(&ldquo;583afcaedcab265c1821fb51&rdquo;)}, {&ldquo;hobby&rdquo;: &ldquo;go shopping&rdquo;});</p></blockquote>

<p>// ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª</p>

<blockquote><p>db.testCollection.find();
{ &ldquo;_id&rdquo; : ObjectId(&ldquo;583afcaedcab265c1821fb51&rdquo;), &ldquo;hobby&rdquo; : &ldquo;go shopping&rdquo; }
```</p></blockquote>

<p>ã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚<br/>
ç¾çŠ¶ã€<code>Perfect-MongoDB</code>ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦‹ã‚‹ã¨<code>$set</code>ã¯ãªã„ã‚ˆã†ã§ã™ã€‚<br/>
ãã®ãŸã‚ã€ä»Šå›ã¯ã‚ãˆã¦POSTåŒæ§˜ã«å…¨ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‹ã‚‰ä¸‹è¨˜ã®ã‚ˆã†ã«æŠ•ã’ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p>

<p><code>
$ curl http://localhost:8181/mongo/583afcaedcab265c1821fb51 -X PUT -H "Content-Type: application/json" -d '{"name" : "Hanako", "age" : 24, "hobby": "game"}'
</code></p>

<h5>updateãƒ¡ã‚½ãƒƒãƒ‰ã®MongoUpdateFlagã«ã¤ã„ã¦</h5>

<p><code>update</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚‚å®Ÿã¯<code>MongoUpdateFlag</code>ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã™ã€‚<br/>
<code>MongoUpdateFlag</code>ã¯<code>MongoInsertFlag</code>ã¨åŒã˜ã <strong>enum</strong> ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<p>```objective-c
public enum MongoUpdateFlag: Int {</p>

<pre><code>case none
case upsert
case multiUpdate
case noValidate

var mongoFlag: mongoc_update_flags_t {
    switch self {
    case .none:
        return MONGOC_UPDATE_NONE
    case .upsert:
        return MONGOC_UPDATE_UPSERT
    case .multiUpdate:
        return MONGOC_UPDATE_MULTI_UPDATE
    case .noValidate:
        return mongoc_update_flags_t(rawValue: MONGOC_UPDATE_NO_VALIDATE)
    }
}
</code></pre>

<p>}
```</p>

<p>ãã‚Œãã‚Œã®ãƒ•ãƒ©ã‚°ã®æ„å‘³ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚</p>

<ul>
<li><code>MONGO_UPDATE_NONE</code>

<ul>
<li>ç‰¹åˆ¥ä½•ã‚‚ã—ã¾ã›ã‚“</li>
</ul>
</li>
<li><code>MONGOC_UPDATE_UPSERT</code>

<ul>
<li>æ¤œç´¢ã«å¼•ã£ã‹ã‹ã‚‰ãªã„å ´åˆã¯<code>insert</code>ã—ã¾ã™</li>
</ul>
</li>
<li><code>MONGOC_UPDATE_MULTI_UPDATE</code>

<ul>
<li>æ¤œç´¢ã«ãƒ’ãƒƒãƒˆã™ã‚‹ä»¶æ•°ãŒè¤‡æ•°ã®å ´åˆã¯å…¨ã¦æ›´æ–°ã—ã¾ã™</li>
</ul>
</li>
<li><code>MONGOC_UPDATE_NO_VALIDATE</code>

<ul>
<li>ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå‰ã«å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¾ã›ã‚“</li>
</ul>
</li>
</ul>


<h4>MongoDBã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</h4>

<p>MongoDBã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤å‡¦ç†ã‚‚è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>

<h5>removeãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</h5>

<p>ä¿å­˜ã«ã¯<code>MongoClient</code>ã®<code>remove</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚</p>

<p><code>mongoHandler.swift</code>ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p>

<p>```objective-c
// mongoHandler.swift
func delete(query: BSON, request: HTTPRequest, response: HTTPResponse) {</p>

<pre><code>// MongoDBã¸ã®æ¥ç¶š
connect()

// æŒ‡å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å‡¦ç†çµ‚äº†
</code></pre>

<p>  guard let collection = self.collection else {</p>

<pre><code>return
</code></pre>

<p>  }</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿å‰Šé™¤å‡¦ç†
</code></pre>

<p>  let removed = collection.remove(selector: query, flag: .none)</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿å‰Šé™¤çµæœã«ã‚ˆã£ã¦è¿”å´å€¤ã‚’å¤‰æ›´
</code></pre>

<p>  var returning = &ldquo;Failed&rdquo;    <br/>
  switch removed {
  case .success:</p>

<pre><code>returning = "Succeeded"
</code></pre>

<p>  default:</p>

<pre><code>returning = "Failed"
</code></pre>

<p>  }</p>

<pre><code>// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¨­å®š
</code></pre>

<p>  response.appendBody(string: returning)</p>

<pre><code>// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†å®Œäº†
</code></pre>

<p>  response.completed()</p>

<pre><code>// MongoDBã‹ã‚‰åˆ‡æ–­
</code></pre>

<p>  close()
}
```</p>

<p>ãã—ã¦ <code>main.swift</code> ã«DELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚</p>

<p>```objective-c
// main.swift
routes.add(method: .delete, uri: &ldquo;/mongo/{oid}&rdquo;, handler: {
  request, response in</p>

<pre><code>// BSONå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–(ã‚¯ã‚¨ãƒªã¨ã—ã¦æ¸¡ã™)
</code></pre>

<p>  let bson = BSON()
  defer {</p>

<pre><code>    // å‡¦ç†å®Œäº†æ™‚ã«BSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤
bson.close()
</code></pre>

<p>  }</p>

<p>  var oid: bson_oid_t = bson_oid_t()
  bson_oid_init_from_string(&amp;oid, request.urlVariables[&ldquo;oid&rdquo;])
  bson.append(key: &ldquo;_id&rdquo;, oid: oid)</p>

<pre><code>// ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
</code></pre>

<p>  mongoHandler.delete(query: bson, request: request, response: response)
})
```</p>

<p>ä¸‹è¨˜ã®ã‚ˆã†ãªDELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã¿ã‚Œã°ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã¯ãšã§ã™ã€‚</p>

<p><code>
$ curl http://localhost:8181/mongo/583afcaedcab265c1821fb51 -X DELETE -H "Content-Type: application/json"
</code></p>

<h5>removeãƒ¡ã‚½ãƒƒãƒ‰ã®MongoRemoveFlagã«ã¤ã„ã¦</h5>

<p><code>remove</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚‚å®Ÿã¯<code>MongoRemoveFlag</code>ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã™ã€‚<br/>
<code>MongoRemoveFlag</code>ã¯<code>MongoUpdateFlag</code>ã¨åŒã˜ã <strong>enum</strong> ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<p>```objective-c
public enum MongoRemoveFlag: Int {</p>

<pre><code>case none
case singleRemove

var mongoFlag: mongoc_remove_flags_t {
    switch self {
    case .none:
        return MONGOC_REMOVE_NONE
    case .singleRemove:
        return MONGOC_REMOVE_SINGLE_REMOVE
    }
}
</code></pre>

<p>}
```</p>

<p>ãƒ•ãƒ©ã‚°ã®æ„å‘³ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚</p>

<ul>
<li><code>MONGOC_REMOVE_NONE</code>

<ul>
<li>ç‰¹ã«ä½•ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã¤ã‘ã¾ã›ã‚“ã€‚</li>
<li>æ¤œç´¢ã«ãƒ’ãƒƒãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿ã¯å…¨ã¦å‰Šé™¤ã—ã¾ã™ã€‚</li>
</ul>
</li>
<li><code>MONGOC_REMOVE_SINGLE_REMOVE</code>

<ul>
<li>åˆã‚ã«è©²å½“ã—ãŸãƒ‡ãƒ¼ã‚¿1ä»¶ã®ã¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚</li>
</ul>
</li>
</ul>


<h3>ã¾ã¨ã‚</h3>

<p>ä»¥ä¸Šã§åŸºæœ¬çš„ãªCRUDã«å¯¾å¿œã—ãŸAPã‚µãƒ¼ãƒã¨DBã‚µãƒ¼ãƒã‚’Swiftã¨MongoDBã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚<br/>
ã“ã‚Œã‹ã‚‰ä½•ã‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚‚&hellip;ã¨æ€ã£ã¦ã„ãŸã‚‰æ™‚é–“åˆ‡ã‚Œ&hellip;<br/>
ä»Šå›ã¯ä¸€æ—¦ã“ã“ã¾ã§ã¨ã—ãŸã„ã¨æ€ã„ã¾ã™ãŒã€ä»Šå¾Œã®å±•æœ›ã¨ã—ã¦ã¯Swiftè£½iOSã‚¢ãƒ—ãƒªã¨é€£æºã•ã›ã¦iOSã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ã‹ã€ã‚‚ã—ãã¯React / Reduxã‚’ä½¿ã£ãŸWebã‚µãƒ¼ãƒ“ã‚¹ã¨é€£æºã•ã›ãŸã„ã¨ä¼ã‚“ã§ã„ã¾ã™ã€‚<br/>
å‡¦ç†é€Ÿåº¦ã¨ã‹ãƒªã‚½ãƒ¼ã‚¹ã®æ¶ˆè²»å…·åˆã¨ã‹ã¯å…¨ç„¶æ¯”è¼ƒã‚‚ã—ã¦ã„ãªã„ã®ã§ã‚ã‹ã‚‰ãªã„ã§ã™ãŒã€Swiftã«ã‚ˆã‚‹ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰æ§‹ç¯‰ã«ã‚ˆã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ä»Šå¾ŒAppleã•ã‚“ãŒï¼Ÿæ˜ã‚‰ã‹ã«ã—ã¦ãã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p>

<p>ä½•ã¨è¨€ã£ã¦ã‚‚æ–°ã—ã„æŠ€è¡“ã‚„å–ã‚Šçµ„ã¿ã¯æ¥½ã—ã„ã§ã™ã­ï¼ï¼<br/>
ã¨è¨€ã£ãŸã¨ã“ã‚ã§æœ¬æ—¥ã¯ã“ã“ã¾ã§ã€‚</p>

<h3>å‚è€ƒURL</h3>

<ul>
<li><a href="http://perfect.org/docs/MongoDB.html">Perfect MongoDB Documentation</a></li>
<li><a href="http://mongoc.org/libbson/1.3.5/bson_oid_init_from_string.html">Libbson API Reference: Bson Oid Init</a></li>
<li><a href="http://mongoc.org/libmongoc/1.4.0/updating-document.html">Libbson API Reference: Update Document</a></li>
<li><a href="http://mongoc.org/libmongoc/1.0.0/mongoc_insert_flags_t.html">MongoDB C Driver API Reference: Insert Flag</a></li>
<li><a href="http://mongoc.org/libmongoc/1.2.3/mongoc_update_flags_t.html">MongoDB C Driver API Reference: Update Flag</a></li>
<li><a href="http://mongoc.org/libmongoc/1.3.2/mongoc_remove_flags_t.html">MongoDB C Driver API Reference: Remove Flag</a></li>
</ul>


<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Homebrewã§MongoDBã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«]]></title>
    <link href="http://grandbig.github.io/blog/2016/11/20/brew-install-db/"/>
    <updated>2016-11-20T00:10:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/11/20/brew-install-db</id>
    <content type="html"><![CDATA[<h3>PCç§»è¡Œã—ãŸã“ã¨ã§ç™ºç”Ÿã—ãŸHomebrewå¯¾å¿œã—ç›´ã—</h3>

<p>ã•ã¦ã€æœ¬æ—¥ã¯Macbook Proã‚’è³¼å…¥ã—ãŸã“ã¨ã§ãƒ–ãƒ­ã‚°ä½œæˆç’°å¢ƒã‚’ç§»è¡Œã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ã€ãã®éš›ã«æ°—ã¥ã„ãŸã“ã¨ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚</p>

<p>ã“ã‚Œã¾ã§ã¯MongoDBã‚„MySQLãªã©ã®DBç³»ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå¾Œã«ã€æ¬¡å›ã€PCãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è‡ªå‹•èµ·å‹•ã•ã›ã‚‹ãŸã‚ã«æ‰‹å‹•ã§ãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹•è¨­å®šã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚<br/>
ã—ã‹ã—ã€ä»Šå›ã€ç­†è€…ãŒ <strong>Homebrew</strong> ã§ä¸Šè¨˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã¿ãŸã¨ã“ã‚ã€æ–°ãŸãªè¨˜è¿°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!--more-->


<p>```
// MongoDBã®ä¾‹
$ brew install mongodb
==> Downloading <a href="https://homebrew.bintray.com/bottles/mongodb-3.2.11.sierra.bottle.tar.gz">https://homebrew.bintray.com/bottles/mongodb-3.2.11.sierra.bottle.tar.gz</a></p>

<h6>################################################################## 100.0%</h6>

<p>==> Pouring mongodb-3.2.11.sierra.bottle.tar.gz
==> Caveats
To have launchd start mongodb now and restart at login:
  brew services start mongodb
Or, if you don&rsquo;t want/need a background service you can just run:
  mongod &mdash;config /usr/local/etc/mongod.conf
==> Summary
ğŸº  /usr/local/Cellar/mongodb/3.2.11: 18 files, 245.4M
```</p>

<p>ä¸Šè¨˜ãŒå®Ÿéš›ã«å‡ºåŠ›ã•ã‚ŒãŸè¨˜è¿°ã«ãªã‚Šã¾ã™ã€‚<br/>
ç­†è€…ãŒæ³¨ç›®ã—ãŸã®ã¯ã€ <strong>brew services start mongodb</strong> ã®éƒ¨åˆ†ã§ã™ã€‚<br/>
ã“ã‚Œã‚’å©ã‘ã°ã€ãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹•è¨­å®šãŒã•ã‚Œã‚‹ã®ã§ã¯ï¼ï¼Ÿã¨æ€ã£ãŸæ¬¡ç¬¬ã§ã™ã€‚</p>

<p>ã§ã¯å®Ÿéš›ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<p><code>
$ brew services start mongodb
==&gt; Tapping homebrew/services
Cloning into '/usr/local/Homebrew/Library/Taps/homebrew/homebrew-services'...
remote: Counting objects: 10, done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 10 (delta 0), reused 6 (delta 0), pack-reused 0
Unpacking objects: 100% (10/10), done.
Tapped 0 formulae (37 files, 46.8K)
==&gt; Successfully started `mongodb` (label: homebrew.mxcl.mongodb)
</code></p>

<p>èµ·å‹•ã—ã¦ã„ã‚‹ã‹ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚</p>

<p><code>
$ ps aux | grep mongo
takahiro      5468   0.2  0.2  2584528  25672   ??  S    11:24PM   0:00.22 /usr/local/opt/mongodb/bin/mongod --config /usr/local/etc/mongod.conf
takahiro      5472   0.0  0.0  2432804   1924 s000  S+   11:24PM   0:00.00 grep mongo
</code></p>

<p>ã“ã‚Œã§æ—¢ã«èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚<br/>
ã™ã”ãä¾¿åˆ©ã«ãªã‚Šã¾ã—ãŸã­ï¼</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
</feed>
