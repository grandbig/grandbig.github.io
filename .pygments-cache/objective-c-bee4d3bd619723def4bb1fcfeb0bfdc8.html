<div class="highlight"><pre><span class="c1">// mongoHandler.swift</span>
<span class="n">func</span> <span class="nf">update</span><span class="p">(</span><span class="nl">query:</span> <span class="n">BSON</span><span class="p">,</span> <span class="nl">update:</span> <span class="n">BSON</span><span class="p">,</span> <span class="nl">request:</span> <span class="n">HTTPRequest</span><span class="p">,</span> <span class="nl">response:</span> <span class="n">HTTPResponse</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// MongoDBへの接続</span>
	<span class="n">connect</span><span class="p">()</span>

	<span class="c1">// 指定コレクションが見つからない場合は処理終了</span>
  <span class="n">guard</span> <span class="n">let</span> <span class="n">collection</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">collection</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span>
  <span class="p">}</span>

	<span class="c1">// データの更新</span>
  <span class="n">let</span> <span class="n">updated</span> <span class="o">=</span> <span class="n">collection</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="nl">update:</span> <span class="n">update</span><span class="p">,</span> <span class="nl">selector:</span> <span class="n">query</span><span class="p">)</span>
	<span class="c1">// データ更新結果によって返却値を変更</span>
  <span class="n">var</span> <span class="n">returning</span> <span class="o">=</span> <span class="s">&quot;Failed&quot;</span>
  <span class="k">switch</span> <span class="n">updated</span> <span class="p">{</span>
  <span class="k">case</span> <span class="p">.</span><span class="nl">success:</span>
    <span class="n">returning</span> <span class="o">=</span> <span class="s">&quot;Succeeded&quot;</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="n">returning</span> <span class="o">=</span> <span class="s">&quot;Failed&quot;</span>
  <span class="p">}</span>

	<span class="c1">// レスポンスデータとして設定</span>
  <span class="n">response</span><span class="p">.</span><span class="n">appendBody</span><span class="p">(</span><span class="nl">string:</span> <span class="n">returning</span><span class="p">)</span>
	<span class="c1">// レスポンス処理完了</span>
  <span class="n">response</span><span class="p">.</span><span class="n">completed</span><span class="p">()</span>

	<span class="c1">// MongoDBから切断</span>
  <span class="n">close</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>