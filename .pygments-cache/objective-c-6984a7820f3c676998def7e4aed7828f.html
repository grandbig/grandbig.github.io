<div class="highlight"><pre><span class="c1">// ViewController.m</span>
<span class="cp">#import &quot;ViewController.h&quot;</span>
<span class="cp">#import &quot;AFNetworking.h&quot;</span>

<span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ViewController</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>

	<span class="c1">// AFHTTPSessionManagerをインスタンス化</span>
	<span class="n">AFHTTPSessionManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPSessionManager</span> <span class="n">manager</span><span class="p">];</span>

	<span class="c1">// APIキーをセット</span>
	<span class="n">NSString</span> <span class="o">*</span><span class="n">apiKey</span> <span class="o">=</span> <span class="s">@&quot;&lt;メールで届いたAPIキー&gt;&quot;</span><span class="p">;</span>
	<span class="p">[</span><span class="n">manager</span><span class="p">.</span><span class="n">requestSerializer</span> <span class="nl">setAuthorizationHeaderFieldWithUsername:</span><span class="n">apiKey</span> <span class="nl">password:</span><span class="nb">nil</span><span class="p">];</span>

	<span class="c1">// リクエストパラメータをセット</span>
	<span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
	<span class="n">NSString</span> <span class="o">*</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;おはようございます。&quot;</span><span class="p">;</span>
	<span class="p">[</span><span class="n">params</span> <span class="nl">setObject:</span><span class="n">text</span> <span class="nl">forKey:</span><span class="s">@&quot;text&quot;</span><span class="p">];</span>
	<span class="p">[</span><span class="n">params</span> <span class="nl">setObject:</span><span class="s">@&quot;show&quot;</span> <span class="nl">forKey:</span><span class="s">@&quot;speaker&quot;</span><span class="p">];</span>
	<span class="p">[</span><span class="n">params</span> <span class="nl">setObject:</span><span class="s">@&quot;ogg&quot;</span> <span class="nl">forKey:</span><span class="s">@&quot;format&quot;</span><span class="p">];]</span>

	<span class="c1">// Content-Typeをセット</span>
	<span class="p">[</span><span class="n">manager</span> <span class="nl">setResponseSerializer:</span><span class="p">[</span><span class="n">AFHTTPResponseSerializer</span> <span class="n">serializer</span><span class="p">]];</span>
	<span class="n">manager</span><span class="p">.</span><span class="n">responseSerializer</span><span class="p">.</span><span class="n">acceptableContentTypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSSet</span> <span class="nl">setWithObject:</span><span class="s">@&quot;audio/ogg&quot;</span><span class="p">];</span>

	<span class="c1">// OpenWeatherMap APIを利用</span>
	<span class="p">[</span><span class="n">manager</span> <span class="nl">POST:</span><span class="s">@&quot;https://api.voicetext.jp/v1/tts&quot;</span>
	   <span class="nl">parameters:</span><span class="n">params</span>
	      <span class="nl">success:</span><span class="o">^</span><span class="p">(</span><span class="n">NSURLSessionDataTask</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
			  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;response: %@&quot;</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
		  <span class="p">}</span> <span class="nl">failure:</span><span class="o">^</span><span class="p">(</span><span class="n">NSURLSessionDataTask</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
			  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
		  <span class="p">}</span>
<span class="p">}</span>
</pre></div>