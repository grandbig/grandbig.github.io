<div class="highlight"><pre><span class="c1">// ViewController.m</span>
<span class="c1">// CLVisitの処理</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">locationManager:</span><span class="p">(</span><span class="n">CLLocationManager</span> <span class="o">*</span><span class="p">)</span><span class="nv">manager</span> <span class="nf">didVisit:</span><span class="p">(</span><span class="n">CLVisit</span> <span class="o">*</span><span class="p">)</span><span class="nv">visit</span>
<span class="p">{</span>
	<span class="c1">// 値の取得</span>
	<span class="kt">float</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">visit</span><span class="p">.</span><span class="n">coordinate</span><span class="p">.</span><span class="n">latitude</span><span class="p">;</span>                              <span class="c1">// 緯度</span>
	<span class="kt">float</span> <span class="n">lng</span> <span class="o">=</span> <span class="n">visit</span><span class="p">.</span><span class="n">coordinate</span><span class="p">.</span><span class="n">longitude</span><span class="p">;</span>                             <span class="c1">// 経度</span>
	<span class="kt">float</span> <span class="n">hacc</span> <span class="o">=</span> <span class="n">visit</span><span class="p">.</span><span class="n">horizontalAccuracy</span><span class="p">;</span>                              <span class="c1">// 水平精度</span>
	<span class="n">NSDate</span> <span class="o">*</span><span class="n">arrivalDate</span> <span class="o">=</span> <span class="n">visit</span><span class="p">.</span><span class="n">arrivalDate</span><span class="p">;</span>                            <span class="c1">// 到着日時(NSDate型)</span>
	<span class="n">NSDate</span> <span class="o">*</span><span class="n">departureDate</span> <span class="o">=</span> <span class="n">visit</span><span class="p">.</span><span class="n">departureDate</span><span class="p">;</span>                        <span class="c1">// 出発日時(NSDate型)</span>
	<span class="kt">double</span> <span class="n">arrivalUnixTime</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrivalDate</span> <span class="n">timeIntervalSince1970</span><span class="p">];</span>       <span class="c1">// 到着日時(timestamp)</span>
	<span class="kt">double</span> <span class="n">departureUnixTime</span> <span class="o">=</span> <span class="p">[</span><span class="n">departureDate</span> <span class="n">timeIntervalSince1970</span><span class="p">];</span>   <span class="c1">// 出発日時(timestamp)</span>
	
	<span class="c1">// NSDate型の日時をNSString型に変換</span>
	<span class="n">NSDateFormatter</span> <span class="o">*</span><span class="n">outputFormatter</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDateFormatter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
	<span class="p">[</span><span class="n">outputFormatter</span> <span class="nl">setDateFormat:</span><span class="s">@&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="p">];</span>
			    
	<span class="n">NSString</span><span class="o">*</span> <span class="n">arrivalDateString</span> <span class="o">=</span> <span class="p">[</span><span class="n">outputFormatter</span> <span class="nl">stringFromDate:</span><span class="n">arrivalDate</span><span class="p">];</span>
	<span class="n">NSString</span><span class="o">*</span> <span class="n">departureDateString</span> <span class="o">=</span> <span class="p">[[</span><span class="n">outputFormatter</span> <span class="nl">stringFromDate:</span><span class="n">departureDate</span><span class="p">];</span>

	<span class="c1">// データの挿入</span>
	<span class="p">[</span><span class="n">self</span> <span class="nl">insertPlaceData:</span><span class="n">lat</span> <span class="nl">longitude:</span><span class="n">lng</span> <span class="nl">horizontalAccuracy:</span><span class="n">hacc</span> <span class="nl">arrivalDate:</span><span class="n">arrivalDateString</span> <span class="nl">departureDate:</span><span class="n">departureDateString</span> <span class="nl">arrivalDateUT:</span><span class="n">arrivalUnixTime</span> <span class="nl">departureDateUT:</span><span class="n">departureUnixTime</span><span class="p">];</span>
	<span class="c1">// ローカルプッシュ</span>
	<span class="n">NSString</span> <span class="o">*</span><span class="n">message</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSString</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFormat:</span><span class="s">@&quot;lat: %f, lng: %f, hacc: %f, 到着日時: %@, 出発日時: %@&quot;</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lng</span><span class="p">,</span> <span class="n">hacc</span><span class="p">,</span> <span class="n">arrivalDateString</span><span class="p">,</span> <span class="n">departureDateString</span><span class="p">];</span>
	<span class="p">[</span><span class="n">self</span> <span class="nl">sendLocalNotificationForMessage:</span><span class="n">message</span> <span class="nl">soundFlag:</span><span class="n">NO</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>