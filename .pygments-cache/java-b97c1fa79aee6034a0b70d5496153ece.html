<div class="highlight"><pre><span class="c1">// MainActivity.java</span>
<span class="kn">package</span> <span class="o">...</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.design.widget.FloatingActionButton</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.design.widget.Snackbar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.widget.Toolbar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.Menu</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.MenuItem</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.Auth</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.signin.GoogleSignInAccount</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.signin.GoogleSignInOptions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.signin.GoogleSignInResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.common.ConnectionResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.common.SignInButton</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.common.api.GoogleApiClient</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span>
        <span class="n">GoogleApiClient</span><span class="o">.</span><span class="na">OnConnectionFailedListener</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">RC_SIGN_IN</span> <span class="o">=</span> <span class="mi">9001</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">GoogleApiClient</span> <span class="n">mGoogleApiClient</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

		<span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>

		<span class="c1">// Button listenersの設定</span>
		<span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

		<span class="c1">// Google Sign-Inの設定</span>
		<span class="n">GoogleSignInOptions</span> <span class="n">gso</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GoogleSignInOptions</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">GoogleSignInOptions</span><span class="o">.</span><span class="na">DEFAULT_SIGN_IN</span><span class="o">).</span><span class="na">requestEmail</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
		<span class="n">mGoogleApiClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GoogleApiClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
				<span class="o">.</span><span class="na">enableAutoManage</span><span class="o">(</span><span class="k">this</span> <span class="cm">/* FragmentActivity */</span><span class="o">,</span> <span class="k">this</span> <span class="cm">/* OnConnectionFailedListener */</span><span class="o">)</span>
				<span class="o">.</span><span class="na">addApi</span><span class="o">(</span><span class="n">Auth</span><span class="o">.</span><span class="na">GOOGLE_SIGN_IN_API</span><span class="o">,</span> <span class="n">gso</span><span class="o">)</span>
				<span class="o">.</span><span class="na">build</span><span class="o">();</span>

		<span class="c1">// Google Sign-Inボタンの設定</span>
		<span class="n">SignInButton</span> <span class="n">signInButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">SignInButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">);</span>
		<span class="n">signInButton</span><span class="o">.</span><span class="na">setSize</span><span class="o">(</span><span class="n">SignInButton</span><span class="o">.</span><span class="na">SIZE_STANDARD</span><span class="o">);</span>
		<span class="n">signInButton</span><span class="o">.</span><span class="na">setScopes</span><span class="o">(</span><span class="n">gso</span><span class="o">.</span><span class="na">getScopeArray</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>

	<span class="c1">// Sign-Inした結果を受け取る処理</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>

		<span class="c1">// Result returned from launching the Intent from GoogleSignInApi.getSignInIntent(...);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="n">RC_SIGN_IN</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">GoogleSignInResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Auth</span><span class="o">.</span><span class="na">GoogleSignInApi</span><span class="o">.</span><span class="na">getSignInResultFromIntent</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
			<span class="n">handleSignInResult</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="c1">// Sign-Inした結果を扱う処理</span>
	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleSignInResult</span><span class="o">(</span><span class="n">GoogleSignInResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;handleSignInResult:&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">());</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">())</span> <span class="o">{</span>
			<span class="c1">// Signed in successfully, show authenticated UI.</span>
			<span class="n">GoogleSignInAccount</span> <span class="n">acct</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getSignInAccount</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
			<span class="c1">// Signed out, show unauthenticated UI.</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="c1">// Sign-In処理</span>
	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">signIn</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">Intent</span> <span class="n">signInIntent</span> <span class="o">=</span> <span class="n">Auth</span><span class="o">.</span><span class="na">GoogleSignInApi</span><span class="o">.</span><span class="na">getSignInIntent</span><span class="o">(</span><span class="n">mGoogleApiClient</span><span class="o">);</span>
		<span class="n">startActivityForResult</span><span class="o">(</span><span class="n">signInIntent</span><span class="o">,</span> <span class="n">RC_SIGN_IN</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">:</span>
				<span class="n">signIn</span><span class="o">();</span>
				<span class="k">break</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></div>