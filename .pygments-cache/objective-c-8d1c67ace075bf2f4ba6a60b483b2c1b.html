<div class="highlight"><pre><span class="c1">// main.swift</span>
<span class="n">import</span> <span class="n">PerfectLib</span>
<span class="n">import</span> <span class="n">PerfectHTTP</span>
<span class="n">import</span> <span class="n">PerfectHTTPServer</span>
<span class="n">import</span> <span class="n">MongoDB</span>					<span class="c1">// ここを追加</span>

<span class="c1">// 省略</span>

<span class="c1">// nameパラメータを指定したGETリクエストのハンドリング</span>
<span class="n">routes</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="nl">method:</span> <span class="p">.</span><span class="n">get</span><span class="p">,</span> <span class="nl">uri:</span> <span class="s">&quot;/mongo/name/{name}&quot;</span><span class="p">,</span> <span class="nl">handler:</span> <span class="p">{</span>
  <span class="n">request</span><span class="p">,</span> <span class="n">response</span> <span class="k">in</span>
	<span class="c1">// BSON型オブジェクトの初期化(クエリとして渡す)</span>
  <span class="n">let</span> <span class="n">bson</span> <span class="o">=</span> <span class="n">BSON</span><span class="p">()</span>
  <span class="n">defer</span> <span class="p">{</span>
		<span class="c1">// 処理完了時にBSONオブジェクトを削除</span>
    <span class="n">bson</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
  <span class="p">}</span>
	<span class="c1">// クエリとして渡すパラメータをセット</span>
  <span class="n">bson</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nl">key:</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="nl">string:</span> <span class="n">request</span><span class="p">.</span><span class="n">urlVariables</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span><span class="o">!</span><span class="p">)</span>
	<span class="c1">// クエリを指定して検索</span>
  <span class="n">mongoHandler</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="nl">query:</span> <span class="n">bson</span><span class="p">,</span> <span class="nl">request:</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>