<div class="highlight"><pre><span class="n">import</span> <span class="n">UIKit</span>
<span class="n">import</span> <span class="n">MapKit</span>

<span class="n">class</span> <span class="nl">ViewController:</span> <span class="n">UIViewController</span><span class="p">,</span> <span class="n">MKMapViewDelegate</span> <span class="p">{</span>
  <span class="err">@</span><span class="kt">IBOutlet</span> <span class="n">weak</span> <span class="n">var</span> <span class="nl">mapView:</span> <span class="n">MKMapView</span><span class="o">!</span>

  <span class="n">override</span> <span class="n">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

    <span class="c1">// マップ関連の初期化処理</span>
    <span class="n">self</span><span class="p">.</span><span class="n">mapView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span>
    <span class="n">self</span><span class="p">.</span><span class="n">mapView</span><span class="p">.</span><span class="n">setUserTrackingMode</span><span class="p">(</span><span class="n">MKUserTrackingMode</span><span class="p">.</span><span class="n">followWithHeading</span><span class="p">,</span> <span class="nl">animated:</span> <span class="n">true</span><span class="p">)</span>

    <span class="c1">// CustomAnnotationの初期化</span>
    <span class="n">let</span> <span class="n">ann</span> <span class="o">=</span> <span class="n">CustomAnnotation</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="nl">coordinate:</span> <span class="n">CLLocationCoordinate2D</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="nl">latitude:</span> <span class="mf">35.685623</span><span class="p">,</span> <span class="nl">longitude:</span> <span class="mf">139.763153</span><span class="p">),</span> <span class="nl">title:</span> <span class="s">&quot;TEST&quot;</span><span class="p">,</span> <span class="nl">subtitle:</span> <span class="s">&quot;test&quot;</span><span class="p">)</span>
    <span class="c1">// CustomAnnotationをマップに配置</span>
    <span class="n">self</span><span class="p">.</span><span class="n">mapView</span><span class="p">.</span><span class="n">addAnnotation</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>

  <span class="c1">// MARK: MKMapViewDelegate</span>
  <span class="n">func</span> <span class="n">mapView</span><span class="p">(</span><span class="n">_</span> <span class="nl">mapView:</span> <span class="n">MKMapView</span><span class="p">,</span> <span class="n">viewFor</span> <span class="nl">annotation:</span> <span class="n">MKAnnotation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MKAnnotationView</span><span class="o">?</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">annotation</span> <span class="n">is</span> <span class="n">MKUserLocation</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ユーザの現在地の青丸マークは置き換えない</span>
      <span class="k">return</span> <span class="nb">nil</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// CustomAnnotationの場合に画像を配置</span>
      <span class="n">let</span> <span class="n">identifier</span> <span class="o">=</span> <span class="s">&quot;Pin&quot;</span>
      <span class="n">var</span> <span class="nl">annotationView:</span> <span class="n">MKAnnotationView</span><span class="o">?</span> <span class="o">=</span> <span class="n">mapView</span><span class="p">.</span><span class="n">dequeueReusableAnnotationView</span><span class="p">(</span><span class="nl">withIdentifier:</span> <span class="n">identifier</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">annotationView</span> <span class="o">==</span> <span class="nb">nil</span> <span class="p">{</span>
        <span class="n">annotationView</span> <span class="o">=</span> <span class="n">MKAnnotationView</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="nl">annotation:</span> <span class="n">annotation</span><span class="p">,</span> <span class="nl">reuseIdentifier:</span> <span class="n">identifier</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="n">annotationView</span><span class="o">?</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">UIImage</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="nl">named:</span> <span class="s">&quot;xxxx&quot;</span><span class="p">)</span> <span class="c1">// 任意の画像名</span>
      <span class="n">annotationView</span><span class="o">?</span><span class="p">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">annotation</span>
      <span class="n">annotationView</span><span class="p">.</span><span class="n">canShowCallout</span> <span class="o">=</span> <span class="n">true</span>  <span class="c1">// タップで吹き出しを表示</span>
      <span class="k">return</span> <span class="n">annotationView</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>