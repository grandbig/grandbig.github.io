<div class="highlight"><pre><span class="c1">// main.swift</span>
<span class="n">routes</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="nl">method:</span> <span class="p">.</span><span class="n">post</span><span class="p">,</span> <span class="nl">uri:</span> <span class="s">&quot;/mongo/&quot;</span><span class="p">,</span> <span class="nl">handler:</span> <span class="p">{</span>
	<span class="n">request</span><span class="p">,</span> <span class="n">response</span> <span class="k">in</span>
	<span class="c1">// BSON型オブジェクトの初期化(クエリとして渡す)</span>
  <span class="n">let</span> <span class="n">bson</span> <span class="o">=</span> <span class="n">BSON</span><span class="p">()</span>
  <span class="n">defer</span> <span class="p">{</span>
		<span class="c1">// 処理完了時にBSONオブジェクトを削除</span>
    <span class="n">bson</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
  <span class="p">}</span>

	<span class="c1">// JSONString型をDictionary型に変換</span>
  <span class="n">let</span> <span class="n">decodedParam</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="nl">postBody:</span> <span class="n">request</span><span class="p">.</span><span class="n">postBodyString</span><span class="p">)</span>
	<span class="c1">// 各パラメータ単位でBSONオブジェクトに格納</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">in</span> <span class="n">decodedParam</span><span class="o">!</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="n">key</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s">&quot;name&quot;</span><span class="o">:</span>
          <span class="n">bson</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nl">key:</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="nl">string:</span> <span class="n">value</span> <span class="n">as</span><span class="o">!</span> <span class="n">String</span><span class="p">)</span>
      <span class="k">case</span> <span class="s">&quot;age&quot;</span><span class="o">:</span>
          <span class="n">bson</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nl">key:</span> <span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="nl">int32:</span> <span class="n">Int32</span><span class="p">(</span><span class="n">value</span> <span class="n">as</span><span class="o">!</span> <span class="n">Int</span><span class="p">))</span>
      <span class="k">case</span> <span class="s">&quot;hobby&quot;</span><span class="o">:</span>
          <span class="n">bson</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nl">key:</span> <span class="s">&quot;hobby&quot;</span><span class="p">,</span> <span class="nl">string:</span> <span class="n">value</span> <span class="n">as</span><span class="o">!</span> <span class="n">String</span><span class="p">)</span>
      <span class="k">default</span><span class="o">:</span>
          <span class="k">break</span>
      <span class="p">}</span>
  <span class="p">}</span>
	<span class="c1">// データ保存</span>
  <span class="n">mongoHandler</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="nl">query:</span> <span class="n">bson</span><span class="p">,</span> <span class="nl">request:</span> <span class="n">request</span><span class="p">,</span> <span class="nl">response:</span> <span class="n">response</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>