<div class="highlight"><pre><span class="err">#</span> <span class="nx">When</span> <span class="nx">the</span> <span class="nx">AOF</span> <span class="nx">fsync</span> <span class="nx">policy</span> <span class="nx">is</span> <span class="nx">set</span> <span class="nx">to</span> <span class="nx">always</span> <span class="nx">or</span> <span class="nx">everysec</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">a</span> <span class="nx">background</span>
<span class="err">#</span> <span class="nx">saving</span> <span class="nx">process</span> <span class="p">(</span><span class="nx">a</span> <span class="nx">background</span> <span class="nx">save</span> <span class="nx">or</span> <span class="nx">AOF</span> <span class="nx">log</span> <span class="nx">background</span> <span class="nx">rewriting</span><span class="p">)</span> <span class="nx">is</span>
<span class="err">#</span> <span class="nx">performing</span> <span class="nx">a</span> <span class="nx">lot</span> <span class="nx">of</span> <span class="nx">I</span><span class="o">/</span><span class="nx">O</span> <span class="nx">against</span> <span class="nx">the</span> <span class="nx">disk</span><span class="p">,</span> <span class="k">in</span> <span class="nx">some</span> <span class="nx">Linux</span> <span class="nx">configurations</span>
<span class="err">#</span> <span class="nx">Redis</span> <span class="nx">may</span> <span class="nx">block</span> <span class="nx">too</span> <span class="kr">long</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">fsync</span><span class="p">()</span> <span class="nx">call</span><span class="p">.</span> <span class="nx">Note</span> <span class="nx">that</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">no</span> <span class="nx">fix</span> <span class="k">for</span>
<span class="err">#</span> <span class="k">this</span> <span class="nx">currently</span><span class="p">,</span> <span class="nx">as</span> <span class="nx">even</span> <span class="nx">performing</span> <span class="nx">fsync</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">different</span> <span class="nx">thread</span> <span class="nx">will</span> <span class="nx">block</span>
<span class="err">#</span> <span class="nx">our</span> <span class="nx">synchronous</span> <span class="nx">write</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="nx">call</span><span class="p">.</span>
<span class="err">#</span>
<span class="err">#</span> <span class="nx">In</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">mitigate</span> <span class="k">this</span> <span class="nx">problem</span> <span class="nx">it</span><span class="err">â€˜</span><span class="nx">s</span> <span class="nx">possible</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">option</span>
<span class="err">#</span> <span class="nx">that</span> <span class="nx">will</span> <span class="nx">prevent</span> <span class="nx">fsync</span><span class="p">()</span> <span class="nx">from</span> <span class="nx">being</span> <span class="nx">called</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">main</span> <span class="nx">process</span> <span class="k">while</span> <span class="nx">a</span>
<span class="err">#</span> <span class="nx">BGSAVE</span> <span class="nx">or</span> <span class="nx">BGREWRITEAOF</span> <span class="nx">is</span> <span class="k">in</span> <span class="nx">progress</span><span class="p">.</span>
<span class="err">#</span>
<span class="err">#</span> <span class="nx">This</span> <span class="nx">means</span> <span class="nx">that</span> <span class="k">while</span> <span class="nx">another</span> <span class="nx">child</span> <span class="nx">is</span> <span class="nx">saving</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">durability</span> <span class="nx">of</span> <span class="nx">Redis</span> <span class="nx">is</span>
<span class="err">#</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">as</span> <span class="s2">&quot;appendfsync none&quot;</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">practical</span> <span class="nx">terms</span><span class="p">,</span> <span class="k">this</span> <span class="nx">means</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">is</span>
<span class="err">#</span> <span class="nx">possible</span> <span class="nx">to</span> <span class="nx">lose</span> <span class="nx">up</span> <span class="nx">to</span> <span class="mi">30</span> <span class="nx">seconds</span> <span class="nx">of</span> <span class="nx">log</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">worst</span> <span class="nx">scenario</span> <span class="p">(</span><span class="kd">with</span> <span class="nx">the</span>
<span class="err">#</span> <span class="k">default</span> <span class="nx">Linux</span> <span class="nx">settings</span><span class="p">).</span>
<span class="err">#</span>
<span class="err">#</span> <span class="nx">If</span> <span class="nx">you</span> <span class="nx">have</span> <span class="nx">latency</span> <span class="nx">problems</span> <span class="nx">turn</span> <span class="k">this</span> <span class="nx">to</span> <span class="s2">&quot;yes&quot;</span><span class="p">.</span> <span class="nx">Otherwise</span> <span class="nx">leave</span> <span class="nx">it</span> <span class="nx">as</span>
<span class="err">#</span> <span class="s2">&quot;no&quot;</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">safest</span> <span class="nx">pick</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">point</span> <span class="nx">of</span> <span class="nx">view</span> <span class="nx">of</span> <span class="nx">durability</span><span class="p">.</span>

<span class="nx">no</span><span class="o">-</span><span class="nx">appendfsync</span><span class="o">-</span><span class="nx">on</span><span class="o">-</span><span class="nx">rewrite</span> <span class="nx">no</span>
</pre></div>