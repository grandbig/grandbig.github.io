<div class="highlight"><pre><span class="c1">// 領域観測が開始した場合</span>
<span class="n">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="o">!</span><span class="p">,</span> <span class="n">didStartMonitoringForRegion</span> <span class="nl">region:</span> <span class="n">CLRegion</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">self</span><span class="p">.</span><span class="n">sendLocalNotificationForMessage</span><span class="p">(</span><span class="s">&quot;Start Monitoring Region&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 領域に侵入した場合</span>
<span class="n">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="o">!</span><span class="p">,</span> <span class="n">didEnterRegion</span> <span class="nl">region:</span> <span class="n">CLRegion</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">self</span><span class="p">.</span><span class="n">sendLocalNotificationForMessage</span><span class="p">(</span><span class="s">&quot;Enter Region&quot;</span><span class="p">)</span>

	<span class="k">if</span><span class="p">(</span><span class="n">region</span><span class="p">.</span><span class="n">isMemberOfClass</span><span class="p">(</span><span class="n">CLBeaconRegion</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">CLLocationManager</span><span class="p">.</span><span class="n">isRangingAvailable</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">self</span><span class="p">.</span><span class="n">locationManager</span><span class="o">?</span><span class="p">.</span><span class="n">startRangingBeaconsInRegion</span><span class="p">(</span><span class="n">region</span> <span class="n">as</span> <span class="n">CLBeaconRegion</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 領域から退出した場合</span>
<span class="n">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="o">!</span><span class="p">,</span> <span class="n">didExitRegion</span> <span class="nl">region:</span> <span class="n">CLRegion</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">self</span><span class="p">.</span><span class="n">sendLocalNotificationForMessage</span><span class="p">(</span><span class="s">&quot;Enter Region&quot;</span><span class="p">)</span>

	<span class="k">if</span><span class="p">(</span><span class="n">region</span><span class="p">.</span><span class="n">isMemberOfClass</span><span class="p">(</span><span class="n">CLBeaconRegion</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">CLLocationManager</span><span class="p">.</span><span class="n">isRangingAvailable</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">self</span><span class="p">.</span><span class="n">locationManager</span><span class="o">?</span><span class="p">.</span><span class="n">stopRangingBeaconsInRegion</span><span class="p">(</span><span class="n">region</span> <span class="n">as</span> <span class="n">CLBeaconRegion</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 領域内にいるかどうかの判断</span>
<span class="n">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="o">!</span><span class="p">,</span> <span class="n">didDetermineState</span> <span class="nl">state:</span> <span class="n">CLRegionState</span><span class="p">,</span> <span class="n">forRegion</span> <span class="nl">region:</span> <span class="n">CLRegion</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="p">.</span><span class="nl">Inside:</span>
		<span class="k">if</span><span class="p">(</span><span class="n">region</span><span class="p">.</span><span class="n">isMemberOfClass</span><span class="p">(</span><span class="n">CLBeaconRegion</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">CLLocationManager</span><span class="p">.</span><span class="n">isRangingAvailable</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">self</span><span class="p">.</span><span class="n">locationManager</span><span class="o">?</span><span class="p">.</span><span class="n">startRangingBeaconsInRegion</span><span class="p">(</span><span class="n">region</span> <span class="n">as</span> <span class="n">CLBeaconRegion</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="k">break</span>
	<span class="k">case</span> <span class="p">.</span><span class="nl">Outside:</span>
		<span class="k">break</span>
	<span class="k">case</span> <span class="p">.</span><span class="nl">Unknown:</span>
		<span class="k">break</span>
	<span class="k">default</span><span class="o">:</span>
		<span class="k">break</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 距離計測</span>
<span class="n">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="o">!</span><span class="p">,</span> <span class="n">didRangeBeacons</span> <span class="nl">beacons:</span> <span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span><span class="o">!</span><span class="p">,</span> <span class="n">inRegion</span> <span class="nl">region:</span> <span class="n">CLBeaconRegion</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">beacons</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">self</span><span class="p">.</span><span class="n">nearestBeacon</span> <span class="o">=</span> <span class="n">beacons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="n">as</span><span class="o">?</span> <span class="n">CLBeacon</span>

		<span class="n">var</span> <span class="nl">proximity:</span><span class="n">CLProximity</span><span class="o">!</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">nearestBeacon</span><span class="o">?</span><span class="p">.</span><span class="n">proximity</span>
		<span class="n">var</span> <span class="nl">bAccuracy:</span><span class="n">CLLocationAccuracy</span><span class="o">!</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">nearestBeacon</span><span class="o">?</span><span class="p">.</span><span class="n">accuracy</span>
		<span class="n">var</span> <span class="nl">rangeMessage:</span><span class="n">NSString</span>

		<span class="k">if</span><span class="p">(</span><span class="n">proximity</span> <span class="o">==</span> <span class="n">CLProximity</span><span class="p">.</span><span class="n">Immediate</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rangeMessage</span> <span class="o">=</span> <span class="s">&quot;Range Immediate&quot;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">proximity</span> <span class="o">==</span> <span class="n">CLProximity</span><span class="p">.</span><span class="n">Near</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rangeMessage</span> <span class="o">=</span> <span class="s">&quot;Range Near&quot;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">proximity</span> <span class="o">==</span> <span class="n">CLProximity</span><span class="p">.</span><span class="n">Far</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rangeMessage</span> <span class="o">=</span> <span class="s">&quot;Range Far&quot;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">proximity</span> <span class="o">==</span> <span class="n">CLProximity</span><span class="p">.</span><span class="n">Unknown</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rangeMessage</span> <span class="o">=</span> <span class="s">&quot;Range Unknown&quot;</span>
		<span class="p">}</span>

		<span class="n">self</span><span class="p">.</span><span class="n">str</span> <span class="o">=</span> <span class="s">&quot;\(bAccuracy) [m]&quot;</span>
		<span class="n">self</span><span class="p">.</span><span class="n">sendLocalNotificationForMessage</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">str</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 領域観測に失敗した場合</span>
<span class="n">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="o">!</span><span class="p">,</span> <span class="n">monitoringDidFailForRegion</span> <span class="nl">region:</span> <span class="n">CLRegion</span><span class="o">!</span><span class="p">,</span> <span class="n">withError</span> <span class="nl">error:</span> <span class="n">NSError</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">self</span><span class="p">.</span><span class="n">sendLocalNotificationForMessage</span><span class="p">(</span><span class="s">&quot;Exit Region&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 位置情報の許可設定</span>
<span class="n">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="o">!</span><span class="p">,</span> <span class="n">didChangeAuthorizationStatus</span> <span class="nl">status:</span> <span class="n">CLAuthorizationStatus</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="p">.</span><span class="n">NotDetermined</span><span class="p">)</span> <span class="p">{</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="p">.</span><span class="n">Authorized</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">self</span><span class="p">.</span><span class="n">locationManager</span><span class="o">?</span><span class="p">.</span><span class="n">startMonitoringForRegion</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">beaconRegion</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="p">.</span><span class="n">AuthorizedWhenInUse</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">self</span><span class="p">.</span><span class="n">locationManager</span><span class="o">?</span><span class="p">.</span><span class="n">startRangingBeaconsInRegion</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">beaconRegion</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>