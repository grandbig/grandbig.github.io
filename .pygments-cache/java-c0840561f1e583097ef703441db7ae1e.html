<div class="highlight"><pre><span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>

<span class="c1">// AltBeacon関連のライブラリをimport</span>
<span class="kn">import</span> <span class="nn">org.altbeacon.beacon.BeaconConsumer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.altbeacon.beacon.BeaconManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.altbeacon.beacon.BeaconParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.altbeacon.beacon.Identifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.altbeacon.beacon.MonitorNotifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.altbeacon.beacon.Region</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="o">:</span> <span class="n">ActionBarActivity</span><span class="o">(),</span> <span class="n">BeaconConsumer</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">val</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;AltBeacon Sample&quot;</span>

	<span class="c1">// BeaconManagerクラスの変数を定義</span>
	<span class="kd">private</span> <span class="n">var</span> <span class="nl">beaconManager:</span> <span class="n">BeaconManager</span><span class="o">?</span> <span class="o">=</span> <span class="kc">null</span>

	<span class="kd">public</span> <span class="n">val</span> <span class="n">IBEACON_FORMAT</span> <span class="o">=</span> <span class="s">&quot;m:2-3=0215,i:4-19,i:20-21,i:22-23,p:24-24&quot;</span>

	<span class="n">override</span> <span class="n">fun</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nl">savedInstanceState:</span> <span class="n">Bundle</span><span class="o">?)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">)</span>
		<span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">)</span>

		<span class="c1">// staticメソッドでBeaconManagerクラスのインスタンスを取得</span>
		<span class="n">beaconManager</span> <span class="o">=</span> <span class="n">BeaconManager</span><span class="o">.</span><span class="na">getInstanceForApplication</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
		<span class="c1">// BeaconParseをBeaconManagerに設定</span>
		<span class="n">beaconManager</span><span class="o">!!.</span><span class="na">beaconParsers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">BeaconParser</span><span class="o">().</span><span class="na">setBeaconLayout</span><span class="o">(</span><span class="n">IBEACON_FORMAT</span><span class="o">))</span>
	<span class="o">}</span>

	<span class="n">override</span> <span class="n">fun</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="nl">menu:</span> <span class="n">Menu</span><span class="o">):</span> <span class="n">Boolean</span> <span class="o">{</span>
		<span class="c1">// Inflate the menu; this adds items to the action bar if it is present.</span>
		<span class="n">menuInflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">menu_main</span><span class="o">,</span> <span class="n">menu</span><span class="o">)</span>
		<span class="k">return</span> <span class="kc">true</span>
	<span class="o">}</span>

	<span class="n">override</span> <span class="n">fun</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="nl">item:</span> <span class="n">MenuItem</span><span class="o">):</span> <span class="n">Boolean</span> <span class="o">{</span>
		<span class="c1">// Handle action bar item clicks here. The action bar will</span>
		<span class="c1">// automatically handle clicks on the Home/Up button, so long</span>
		<span class="c1">// as you specify a parent activity in AndroidManifest.xml.</span>
		<span class="n">val</span> <span class="n">id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">itemId</span>

		<span class="c1">//noinspection SimplifiableIfStatement</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">action_settings</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span>
		<span class="o">}</span>

		<span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">)</span>
	<span class="o">}</span>

	<span class="n">override</span> <span class="n">fun</span> <span class="nf">onBeaconServiceConnect</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// BeaconManagerクラスのモニタリング通知受取り処理</span>
		<span class="n">beaconManager</span><span class="o">!!.</span><span class="na">setMonitorNotifier</span><span class="o">(</span><span class="n">object</span> <span class="o">:</span> <span class="n">MonitorNotifier</span> <span class="o">{</span>
			<span class="n">override</span> <span class="n">fun</span> <span class="nf">didEnterRegion</span><span class="o">(</span><span class="nl">region:</span> <span class="n">Region</span><span class="o">)</span> <span class="o">{</span>
				<span class="c1">// 領域進入時に実行</span>
				<span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;didEnterRegion&quot;</span><span class="o">)</span>
			<span class="o">}</span>

			<span class="n">override</span> <span class="n">fun</span> <span class="nf">didExitRegion</span><span class="o">(</span><span class="nl">region:</span> <span class="n">Region</span><span class="o">)</span> <span class="o">{</span>
				<span class="c1">// 領域退出時に実行</span>
				<span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;didExitRegion&quot;</span><span class="o">)</span>
			<span class="o">}</span>

			<span class="n">override</span> <span class="n">fun</span> <span class="nf">didDetermineStateForRegion</span><span class="o">(</span><span class="nl">i:</span> <span class="n">Int</span><span class="o">,</span> <span class="nl">region:</span> <span class="n">Region</span><span class="o">)</span> <span class="o">{</span>
				<span class="c1">// 領域への侵入/退出のステータスが変化したときに実行</span>
				<span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;didDetermineStateForRegion&quot;</span><span class="o">)</span>
			<span class="o">}</span>
		<span class="o">})</span>

		<span class="k">try</span> <span class="o">{</span>
			<span class="c1">// UUIDの作成</span>
			<span class="n">val</span> <span class="n">identifier</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;434B4666-E4B2-4B78-8C13-901AFEE3DBB6&quot;</span><span class="o">)</span>
			<span class="c1">// モニタリングの開始</span>
			<span class="n">beaconManager</span><span class="o">!!.</span><span class="na">startMonitoringBeaconsInRegion</span><span class="o">(</span><span class="n">Region</span><span class="o">(</span><span class="s">&quot;unique-id-001&quot;</span><span class="o">,</span> <span class="n">identifier</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">))</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nl">e:</span> <span class="n">RemoteException</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// 例外が発生した場合の処理</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">()</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="n">override</span> <span class="n">fun</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">()</span>
		<span class="n">beaconManager</span><span class="o">!!.</span><span class="na">unbind</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
	<span class="o">}</span>

	<span class="n">override</span> <span class="n">fun</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">()</span>
		<span class="n">beaconManager</span><span class="o">!!.</span><span class="na">bind</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></div>