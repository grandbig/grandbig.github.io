<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Takahiro Octopress Blog]]></title>
  <link href="http://grandbig.github.io/atom.xml" rel="self"/>
  <link href="http://grandbig.github.io/"/>
  <updated>2016-02-01T00:08:54+09:00</updated>
  <id>http://grandbig.github.io/</id>
  <author>
    <name><![CDATA[Takahiro]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[位置情報サービスの許可アラートに表示する文字数について]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/31/location-alert-number-of-characters/"/>
    <updated>2016-01-31T22:55:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/31/location-alert-number-of-characters</id>
    <content type="html"><![CDATA[<h4>位置情報サービスの許可アラートに文字数制限はあるのか！？</h4>

<p>位置情報サービスを利用するアプリの場合、位置情報サービスの利用許可を求めるアラートが表示されます。<br/>
これはアプリで位置情報を利用するために必須の機能であり、これなくしては、<code>CoreLocation.framework</code>を通して、位置情報を利用することはできません。</p>

<p>とここまではiOSエンジニアで位置情報サービスを扱ったアプリを開発した方々にとっては周知の事実かと思います。<br/>
しかし、その許可アラートには『 <strong>どのくらいの文字を記載することができるのか</strong> 』まで気にする方はあまり多くないかもしれません。</p>

<p>ふと気になったので、試してみました。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>Local Notification / Remote Notificationは文字数に制限があるということで以前から述べられてきました。<br/>
例えば、下記が参考になると思います。</p>

<ul>
<li><a href="http://www.hangout.co.jp/blog/archives/295">iOSのプッシュ通知の文字数とデータサイズの制限</a></li>
<li><a href="http://iot.mb.cloud.nifty.com/iotcolumn/%E6%96%87%E5%AD%97%E6%95%B0%E5%88%B6%E9%99%90%E3%83%97%E3%83%83%E3%82%B7%E3%83%A5%E9%80%9A%E7%9F%A5">文字数制限を知って効果的にプッシュ通知を利用しよう！</a></li>
<li><a href="http://qiita.com/mono0926/items/df03c61adc56934e2e7a">iOSのPUSH通知(APNS)の特徴・ノウハウまとめ(iOS 9まで対応)</a></li>
</ul>


<p>では、位置情報サービスを利用する際に表示される許可アラートに表示可能な文字数に制限はあるのでしょうか？<br/>
iOS9ではLocal Notification / Remote Notificationの制限は4KB(4096Bytes)とのことなので、このくらいいけるのでしょうか&hellip;。</p>

<p>はい。結果です。<br/>
全角で <strong>3938文字</strong> まで行けました。<br/>
これは<code>Info.plist</code>に記載できた文字数です。<br/>
これ以上は入力しても<code>Info.plist</code>に表示されないんですね&hellip;。<br/>
ただ、設定 > 位置情報サービス > アプリ に表示される文言はもう少し行けてるんですよ&hellip;。</p>

<p>たぶんLocal Notification / Remote Notificationと同じ制限な気がしますね。<br/>
まだまだiOS7やiOS8に対応する必要もあるでしょうし、長すぎるとそもそもユーザに対するハードルを上げることになるので全くオススメできませんよね。</p>

<p>ま、文字数は気にしすぎずに、Appleが言うように極力短く的確に書くにこしたことはないと思います。</p>

<p>参考までにキャプチャを貼っておきます。</p>

<p><img src="http://grandbig.github.io/images/corelocation_alert.png" alt="位置情報サービス許可アラート" /><br/>
アラート内をスクロールして全文を読むことができます。</p>

<p>といったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Studio2.0: TabLayoutを使ってみよう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/30/android-tablayout/"/>
    <updated>2016-01-30T14:32:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/30/android-tablayout</id>
    <content type="html"><![CDATA[<h4>TabHostとTabLayoutについて</h4>

<p>前回、AndroidでTabHostを使ったアプリの作り方について見ていきましたが、本日は <strong>TabLayout</strong> を使ったアプリの作り方を見ていきたいと思います。<br/>
なぜ似たような名前のクラスがあるのかと思いますよね？<br/>
実はTabHostはもう随分前から非推奨とされており、同様の機能を実装するために <strong>TabLayout</strong> が提供されているようなんです。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>もう少し、詳しく説明すると、<br/>
『Google I/O 2014』にて<a href="https://www.google.com/design/spec/material-design/introduction.html">Material Design</a>が発表されました。<br/>
(これはGoogleが提唱するパソコンやスマートフォン向けのアプリまたはWebサイト等の新しいデザイン方式です。)</p>

<p>そして、『<a href="https://events.google.com/io2015/#">Google I/O 2015</a>』にてMaterial Designを実現するためのサポートライブラリ『 <strong>Android Design Support Library</strong> 』が発表されました。<br/>
<strong>TabLayout</strong> はこの <strong>Android Design Support Library</strong> に含まれるコンポーネントの1つなのです。</p>

<p>また、現在(2016/01/30時点)、公式でリリースされているAndroid Studioでは自身で<code>build.gradle</code>に<code>compile 'com.android.support:design:23.+'</code>と追記する必要がありますが、Preview版として提供されている <strong>Android Studio 2.0</strong> では、Blank Activityですらデフォルトで <strong>Android Design Support Library</strong> を利用するように組み込まれています。</p>

<p>さて、今日はそんな <strong>Android Design Support Library</strong> のコンポーネントの1つ <strong>TabLayout</strong> について見ていきたいと思います。</p>

<!-- more -->


<h4>TabLayoutを使ってみよう！</h4>

<p>TabHostを書いた時と同じ書式で書いていきます。</p>

<p>1． Android Studioで<code>Blank Activity</code>を選択して、プロジェクトを新規作成<br/>
下記のようなプロジェクト構成ができあがります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">app</span>
</span><span class='line'> <span class="err">┣━━</span> <span class="n">manifests</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┗━━</span> <span class="n">AndroidManifest</span><span class="o">.</span><span class="na">xml</span>
</span><span class='line'> <span class="err">┣━━</span> <span class="n">java</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┣━━</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tabhostapplication</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┃</span>      <span class="err">┗━━</span> <span class="n">MainActivity</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┣━━</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tabhostapplication</span><span class="o">(</span><span class="n">androidTest</span><span class="o">)</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┃</span>      <span class="err">┗━━</span> <span class="n">ApplicationTest</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┗━━</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tabhostapplication</span><span class="o">(</span><span class="n">test</span><span class="o">)</span>
</span><span class='line'> <span class="err">┃</span>           <span class="err">┗━━</span> <span class="n">ExampleUnitTest</span>
</span><span class='line'> <span class="err">┗━━</span> <span class="n">res</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">drawable</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">layout</span>
</span><span class='line'>      <span class="err">┃</span>     <span class="err">┣━━</span> <span class="n">activity_main</span><span class="o">.</span><span class="na">xml</span>
</span><span class='line'>      <span class="err">┃</span>     <span class="err">┗━━</span> <span class="n">content_main</span><span class="o">.</span><span class="na">xml</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">menu</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">mipmap</span>
</span><span class='line'>      <span class="err">┗━━</span> <span class="n">values</span>
</span></code></pre></td></tr></table></div></figure>


<p>2．<code>content_main.xml</code>にTabLayoutを追加<br/>
ページ遷移のためにViewPagerも追加しておきます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">RelativeLayout</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>  <span class="o">....</span>
</span><span class='line'>  <span class="nl">tools:</span><span class="n">showIn</span><span class="o">=</span><span class="s">&quot;@layout/activity_main&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">design</span><span class="o">.</span><span class="na">widget</span><span class="o">.</span><span class="na">TabLayout</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/tabs&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">view</span><span class="o">.</span><span class="na">ViewPager</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/pager&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_below</span><span class="o">=</span><span class="s">&quot;@+id/tabs&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">RelativeLayout</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>3．表示ページ用に<code>Fragment</code>を継承した<code>PageFragment</code>を作成<br/>
メニューから<code>BlankFragment</code>を追加すると、ある程度デフォルトで処理を作成してくれます。<br/>
まずは<code>PageFragment.java</code>ファイルは下記に一部修正しました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tablayoutapplication</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.support.v4.app.Fragment</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.LayoutInflater</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.ViewGroup</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ARG_PARAM</span> <span class="o">=</span> <span class="s">&quot;page&quot;</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">mParam</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">OnFragmentInteractionListener</span> <span class="n">mListener</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// コンストラクタ</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">PageFragment</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">PageFragment</span> <span class="nf">newInstance</span><span class="o">(</span><span class="kt">int</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">PageFragment</span> <span class="n">fragment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageFragment</span><span class="o">();</span>
</span><span class='line'>      <span class="n">Bundle</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">();</span>
</span><span class='line'>      <span class="n">args</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="n">ARG_PARAM</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
</span><span class='line'>      <span class="n">fragment</span><span class="o">.</span><span class="na">setArguments</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">fragment</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">getArguments</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">mParam</span> <span class="o">=</span> <span class="n">getArguments</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">ARG_PARAM</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span>
</span><span class='line'>      <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// Inflate the layout for this fragment</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">page</span> <span class="o">=</span> <span class="n">getArguments</span><span class="o">().</span><span class="na">getInt</span><span class="o">(</span><span class="n">ARG_PARAM</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_page</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span><span class='line'>      <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textView</span><span class="o">)).</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;Page&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onButtonPressed</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">mListener</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">mListener</span><span class="o">.</span><span class="na">onFragmentInteraction</span><span class="o">(</span><span class="n">uri</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAttach</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onAttach</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">context</span> <span class="k">instanceof</span> <span class="n">OnFragmentInteractionListener</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">mListener</span> <span class="o">=</span> <span class="o">(</span><span class="n">OnFragmentInteractionListener</span><span class="o">)</span> <span class="n">context</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
</span><span class='line'>              <span class="o">+</span> <span class="s">&quot; must implement OnFragmentInteractionListener&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDetach</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onDetach</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mListener</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OnFragmentInteractionListener</span> <span class="o">{</span>
</span><span class='line'>      <span class="kt">void</span> <span class="nf">onFragmentInteraction</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>続いて、XMLファイルは下記です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">FrameLayout</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>  <span class="nl">xmlns:</span><span class="n">tools</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="nl">tools:</span><span class="n">context</span><span class="o">=</span><span class="s">&quot;com.example.takahiro.tablayoutapplication.PageFragment&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="o">&lt;</span><span class="n">TextView</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Page&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/textView&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_centerVertical</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_centerHorizontal</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">textSize</span><span class="o">=</span><span class="s">&quot;32sp&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">RelativeLayout</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>4．<code>MainActivity.java</code>にTabLayoutとViewPagerを組み込み</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">ViewPager</span><span class="o">.</span><span class="na">OnPageChangeListener</span><span class="o">,</span> <span class="n">PageFragment</span><span class="o">.</span><span class="na">OnFragmentInteractionListener</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Toolbar</span> <span class="n">toolbar</span> <span class="o">=</span> <span class="o">(</span><span class="n">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// xmlからTabLayoutの取得</span>
</span><span class='line'>      <span class="n">TabLayout</span> <span class="n">tabLayout</span> <span class="o">=</span> <span class="o">(</span><span class="n">TabLayout</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tabs</span><span class="o">);</span>
</span><span class='line'>      <span class="c1">// xmlからViewPagerを取得</span>
</span><span class='line'>      <span class="n">ViewPager</span> <span class="n">viewPager</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewPager</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">pager</span><span class="o">);</span>
</span><span class='line'>      <span class="c1">// ページタイトル配列</span>
</span><span class='line'>      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pageTitle</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;HOME&quot;</span><span class="o">,</span> <span class="s">&quot;EVENT&quot;</span><span class="o">,</span> <span class="s">&quot;SETTING&quot;</span><span class="o">};</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// 表示Pageに必要な項目を設定</span>
</span><span class='line'>      <span class="n">FragmentPagerAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FragmentPagerAdapter</span><span class="o">(</span><span class="n">getSupportFragmentManager</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>          <span class="nd">@Override</span>
</span><span class='line'>          <span class="kd">public</span> <span class="n">Fragment</span> <span class="nf">getItem</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">PageFragment</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="nd">@Override</span>
</span><span class='line'>          <span class="kd">public</span> <span class="n">CharSequence</span> <span class="nf">getPageTitle</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">pageTitle</span><span class="o">[</span><span class="n">position</span><span class="o">];</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="nd">@Override</span>
</span><span class='line'>          <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">pageTitle</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// ViewPagerにページを設定</span>
</span><span class='line'>      <span class="n">viewPager</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
</span><span class='line'>      <span class="n">viewPager</span><span class="o">.</span><span class="na">addOnPageChangeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// ViewPagerをTabLayoutを設定</span>
</span><span class='line'>      <span class="n">tabLayout</span><span class="o">.</span><span class="na">setupWithViewPager</span><span class="o">(</span><span class="n">viewPager</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="o">....</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPageScrolled</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">float</span> <span class="n">positionOffset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">positionOffsetPixels</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPageSelected</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPageScrollStateChanged</span><span class="o">(</span><span class="kt">int</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFragmentInteraction</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これでタブによる画面遷移が完成です。</p>

<p><img src="http://grandbig.github.io/images/android-tablayout.png" alt="TabLayoutによるアプリ画面" /></p>

<h4>スワイプを禁止した単純なTab遷移にするためには</h4>

<p>筆者のTabの印象には、横スワイプによる画面切替は含まれていませんでした。<br/>
なので、スワイプによる画面切替を禁止してみましょう。<br/>
<a href="http://pastebin.com/J63dvdDB">HoldableViewPager</a>をまんま使います。</p>

<p><code>ViewPager</code>を継承した<code>HoldableViewPager</code>を作成します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tablayoutapplication</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.support.v4.view.ViewPager</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.util.AttributeSet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.MotionEvent</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HoldableViewPager</span> <span class="kd">extends</span> <span class="n">ViewPager</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// スワイプの禁止フラグ(true: スワイプ禁止, false: スワイプOK)</span>
</span><span class='line'>  <span class="kt">boolean</span> <span class="n">isSwipeHold</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSwipeHold</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">enabled</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">isSwipeHold</span> <span class="o">=</span> <span class="n">enabled</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// コンストラクタ</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">HoldableViewPager</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// コンストラクタ</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">HoldableViewPager</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attributeSet</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attributeSet</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">motionEvent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span><span class="n">isSwipeHold</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="c1">// スワイプ禁止の場合</span>
</span><span class='line'>          <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">motionEvent</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onInterceptTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span><span class="n">isSwipeHold</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="c1">// スワイプ禁止の場合</span>
</span><span class='line'>          <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onInterceptTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>この<code>HoldableViewPager</code>を<code>MainActivity.java</code>で使います。<br/>
使い方は簡単で<code>ViewPager</code>を<code>HoldableViewPager</code>で置き換えて、<code>isSwipeHold</code>をtrueにするだけです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">....</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">....</span>
</span><span class='line'>  <span class="c1">// xmlからTabLayoutの取得</span>
</span><span class='line'>  <span class="n">TabLayout</span> <span class="n">tabLayout</span> <span class="o">=</span> <span class="o">(</span><span class="n">TabLayout</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tabs</span><span class="o">);</span>
</span><span class='line'>  <span class="c1">// xmlからViewPagerを取得</span>
</span><span class='line'>  <span class="n">HoldableViewPager</span> <span class="n">viewPager</span> <span class="o">=</span> <span class="o">(</span><span class="n">HoldableViewPager</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">pager</span><span class="o">);</span>
</span><span class='line'>  <span class="c1">// スワイプ禁止設定の追加</span>
</span><span class='line'>  <span class="n">viewPager</span><span class="o">.</span><span class="na">setSwipeHold</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>  <span class="o">....</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">....</span>
</span></code></pre></td></tr></table></div></figure>


<p>また、<code>content_main.xml</code>も<code>ViewPager</code>から<code>HoldableViewPager</code>に変更する必要があります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">RelativeLayout</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tablayoutapplication</span><span class="o">.</span><span class="na">HoldableViewPager</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/pager&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_below</span><span class="o">=</span><span class="s">&quot;@+id/tabs&quot;</span>
</span><span class='line'>   <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">RelativeLayout</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Studio2.0: TabHostを使ってみよう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/27/android-tabhost/"/>
    <updated>2016-01-27T23:14:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/27/android-tabhost</id>
    <content type="html"><![CDATA[<h4>始めに</h4>

<p>たまには本格的にAndroid開発についてブログを書こうと思います。<br/>
最近は特に期待のAndroid Studio2.0の本リリースが近づいていると思いますし、筆者的にもiOS開発が集中してしまっていたのでモチベーションがAndroidによっています。<br/>
何はともあれシリーズ化を目指して、一先ず <strong>TabHost</strong> から扱ってみたいと思います。</p>

<h4>TabHostを使ってみよう</h4>

<p>さて、早速、TabHostを実装してみたいと思います。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>1． Android Studioで<code>Blank Activity</code>を選択して、プロジェクトを新規作成<br/>
下記のようなプロジェクト構成ができあがります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">app</span>
</span><span class='line'> <span class="err">┣━━</span> <span class="n">manifests</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┗━━</span> <span class="n">AndroidManifest</span><span class="o">.</span><span class="na">xml</span>
</span><span class='line'> <span class="err">┣━━</span> <span class="n">java</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┣━━</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tabhostapplication</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┃</span>      <span class="err">┗━━</span> <span class="n">MainActivity</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┣━━</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tabhostapplication</span><span class="o">(</span><span class="n">androidTest</span><span class="o">)</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┃</span>      <span class="err">┗━━</span> <span class="n">ApplicationTest</span>
</span><span class='line'> <span class="err">┃</span>    <span class="err">┗━━</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">tabhostapplication</span><span class="o">(</span><span class="n">test</span><span class="o">)</span>
</span><span class='line'> <span class="err">┃</span>           <span class="err">┗━━</span> <span class="n">ExampleUnitTest</span>
</span><span class='line'> <span class="err">┗━━</span> <span class="n">res</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">drawable</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">layout</span>
</span><span class='line'>      <span class="err">┃</span>     <span class="err">┣━━</span> <span class="n">activity_main</span><span class="o">.</span><span class="na">xml</span>
</span><span class='line'>      <span class="err">┃</span>     <span class="err">┗━━</span> <span class="n">content_main</span><span class="o">.</span><span class="na">xml</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">menu</span>
</span><span class='line'>      <span class="err">┣━━</span> <span class="n">mipmap</span>
</span><span class='line'>      <span class="err">┗━━</span> <span class="n">values</span>
</span></code></pre></td></tr></table></div></figure>


<p>2． <code>content_main.xml</code>にTabHostを追加<br/>
下記のようなxmlが作成されます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">RelativeLayout</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>  <span class="o">.....</span>
</span><span class='line'>  <span class="nl">tools:</span><span class="n">showIn</span><span class="o">=</span><span class="s">&quot;@layout/activity_main&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">TabHost</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/tabHost&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_alignParentTop</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>      <span class="nl">android:</span><span class="n">layout_alignParentStart</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">LinearLayout</span>
</span><span class='line'>          <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>          <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>          <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>          <span class="o">&lt;</span><span class="n">TabWidget</span>
</span><span class='line'>              <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@android:id/tabs&quot;</span>
</span><span class='line'>              <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>              <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span><span class="o">&gt;&lt;/</span><span class="n">TabWidget</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>          <span class="o">&lt;</span><span class="n">FrameLayout</span>
</span><span class='line'>              <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@android:id/tabcontent&quot;</span>
</span><span class='line'>              <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>              <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>              <span class="o">&lt;</span><span class="n">LinearLayout</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/linearLayout&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="o">&gt;&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>              <span class="o">&lt;</span><span class="n">LinearLayout</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/linearLayout2&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="o">&gt;&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span><span class='line'>              
</span><span class='line'>              <span class="o">&lt;</span><span class="n">LinearLayout</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/linearLayout3&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>                  <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="o">&gt;&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;/</span><span class="n">FrameLayout</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">TabHost</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">RelativeLayout</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>3．各Tabで表示するためのActivityを作成<br/>
右クリックして、NEW > Activity > Empty Activityを追加したいタブ数分 追加する。</p>

<p>各Tabのレイアウトやデザインは各xmlファイルに書きたいので、<br/>
先ほどの<code>content_main.xml</code>を修正します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">LinearLayout</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/linearLayout&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">include</span> <span class="n">layout</span><span class="o">=</span><span class="s">&quot;@layout/activity_tab1&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">LinearLayout</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/linearLayout2&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">include</span> <span class="n">layout</span><span class="o">=</span><span class="s">&quot;@layout/activity_tab2&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">LinearLayout</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/linearLayout3&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">include</span> <span class="n">layout</span><span class="o">=</span><span class="s">&quot;@layout/activity_tab3&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>&lt;include layout="@layout/activity_tab1"&gt;</code>のようにファイルのインクルードを指定します。</p>

<p>4．<code>MainActivity.java</code>に<code>TabHost</code>の初期化および設定をする</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// TabHostの初期化および設定処理</span>
</span><span class='line'>      <span class="n">initTabs</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">.....</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">....</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initTabs</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">TabHost</span> <span class="n">tabHost</span> <span class="o">=</span> <span class="o">(</span><span class="n">TabHost</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tabHost</span><span class="o">);</span>
</span><span class='line'>          <span class="n">tabHost</span><span class="o">.</span><span class="na">setup</span><span class="o">();</span>
</span><span class='line'>          <span class="n">TabHost</span><span class="o">.</span><span class="na">TabSpec</span> <span class="n">spec</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// Tab1</span>
</span><span class='line'>          <span class="n">spec</span> <span class="o">=</span> <span class="n">tabHost</span><span class="o">.</span><span class="na">newTabSpec</span><span class="o">(</span><span class="s">&quot;Tab1&quot;</span><span class="o">)</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">setIndicator</span><span class="o">(</span><span class="s">&quot;Home&quot;</span><span class="o">,</span> <span class="n">ContextCompat</span><span class="o">.</span><span class="na">getDrawable</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_home_white_36dp</span><span class="o">))</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">linearLayout</span><span class="o">);</span>
</span><span class='line'>          <span class="n">tabHost</span><span class="o">.</span><span class="na">addTab</span><span class="o">(</span><span class="n">spec</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// Tab2</span>
</span><span class='line'>          <span class="n">spec</span> <span class="o">=</span> <span class="n">tabHost</span><span class="o">.</span><span class="na">newTabSpec</span><span class="o">(</span><span class="s">&quot;Tab2&quot;</span><span class="o">)</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">setIndicator</span><span class="o">(</span><span class="s">&quot;Event&quot;</span><span class="o">,</span> <span class="n">ContextCompat</span><span class="o">.</span><span class="na">getDrawable</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_event_white_36dp</span><span class="o">))</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">linearLayout2</span><span class="o">);</span>
</span><span class='line'>          <span class="n">tabHost</span><span class="o">.</span><span class="na">addTab</span><span class="o">(</span><span class="n">spec</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// Tab3</span>
</span><span class='line'>          <span class="n">spec</span> <span class="o">=</span> <span class="n">tabHost</span><span class="o">.</span><span class="na">newTabSpec</span><span class="o">(</span><span class="s">&quot;Tab3&quot;</span><span class="o">)</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">setIndicator</span><span class="o">(</span><span class="s">&quot;Event&quot;</span><span class="o">,</span> <span class="n">ContextCompat</span><span class="o">.</span><span class="na">getDrawable</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_event_white_36dp</span><span class="o">))</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">linearLayout3</span><span class="o">);</span>
</span><span class='line'>          <span class="n">tabHost</span><span class="o">.</span><span class="na">addTab</span><span class="o">(</span><span class="n">spec</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">tabHost</span><span class="o">.</span><span class="na">setCurrentTab</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RuntimeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これでタブでの画面遷移完成です！<br/>
完成した画面がこちら(<code>TabHost</code>しか実装してないので、簡素ですが&hellip;)</p>

<p><img src="http://grandbig.github.io/images/android-tabhost.png" alt="TabHost実装画面" /></p>

<p>本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swiftでドキュメントコメントを正しく書こう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/24/swift-document-comment/"/>
    <updated>2016-01-24T00:13:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/24/swift-document-comment</id>
    <content type="html"><![CDATA[<h4>Swiftでのドキュメントコメントの書き方を覚えよう！</h4>

<p>先日、<a href="http://grandbig.github.io/blog/2016/01/12/jazzy/">jazzy: リファレンス自動生成ツール</a>の記事を書きました。<br/>
その中で幾つかのドキュメントコメントの書き方を紹介しましたが、改めて説明しておきたいと思います。</p>

<p>Swiftではドキュメントコメントの中でマークアップ言語の書式が有効に働きます。<br/>
代表的なマークアップ言語の書式は下記の通りです。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>マークアップ言語の書式</h4>

<h5>見出し</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp"># 最大見出し</span>
</span><span class='line'><span class="cp">## 大見出し</span>
</span><span class='line'><span class="cp">### 中見出し</span>
</span><span class='line'><span class="cp">#### 見出し</span>
</span><span class='line'><span class="cp">##### 小見出し</span>
</span><span class='line'><span class="cp">###### 最小見出し</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_1.png" alt="見出しを書いた場合" /></p>

<h5>リスト</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="o">-</span> <span class="err">リスト項目１</span>
</span><span class='line'>    <span class="o">-</span> <span class="err">リスト小項目１</span>
</span><span class='line'>    <span class="o">-</span> <span class="err">リスト小項目２</span>
</span><span class='line'>    <span class="o">-</span> <span class="err">リスト小項目３</span>
</span><span class='line'><span class="o">-</span> <span class="err">リスト項目２</span>
</span><span class='line'><span class="o">-</span> <span class="err">リスト項目３</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_2.png" alt="リストを書いた場合" /></p>

<h5>順序リスト</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="mf">1.</span> <span class="err">順序リスト項目１</span>
</span><span class='line'>    <span class="mf">1.</span> <span class="err">小順序リスト項目１</span>
</span><span class='line'>    <span class="mf">2.</span> <span class="err">小順序リスト項目２</span>
</span><span class='line'>    <span class="mf">3.</span> <span class="err">小順序リスト項目３</span>
</span><span class='line'><span class="mf">2.</span> <span class="err">順序リスト項目２</span>
</span><span class='line'><span class="mf">3.</span> <span class="err">順序リスト項目３</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_3.png" alt="順序リストを書いた場合" /></p>

<h5>ItalicとBold</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">normal</span>
</span><span class='line'>
</span><span class='line'><span class="o">*</span><span class="n">Italic</span><span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="o">**</span><span class="n">Bold</span><span class="o">**</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_4.png" alt="ItalicとBold" /></p>

<h5>URLリンク</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[</span><span class="n">URL</span><span class="err">リンク</span><span class="p">](</span><span class="nl">https:</span><span class="c1">//developer.apple.com/jp/)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_5.png" alt="URLリンク" /></p>

<h5>罫線</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">abcdefg</span>
</span><span class='line'><span class="o">***</span>
</span><span class='line'><span class="mi">123456</span>
</span><span class='line'>      
</span><span class='line'><span class="o">---</span>
</span><span class='line'><span class="err">あいうえお</span>
</span><span class='line'><span class="n">___</span>
</span><span class='line'><span class="err">かきくけこ</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_6.png" alt="罫線" /></p>

<h5>コード表記</h5>

<p>(Octopressの都合上、ここでは書き方が異なりますが、ご了承ください。)</p>

<p>` ` `<br/>
self.sampleMethod()<br/>
` ` `</p>

<p><img src="http://grandbig.github.io/images/documment_comment_7.png" alt="コード表記" /></p>

<h4>Swiftのドキュメントコメントの書式</h4>

<h5>MARK</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// MARK: - Properties</span>
</span><span class='line'><span class="n">var</span> <span class="nl">sample:</span><span class="n">String</span> <span class="o">=</span> <span class="s">&quot;sampleProperty&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// MARK: - Method</span>
</span><span class='line'><span class="n">func</span> <span class="n">sampleMethod</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">print</span><span class="p">(</span><span class="s">&quot;This is sampleMethod.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_8.png" alt="MARK" /></p>

<h5>FIXME</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">func</span> <span class="nf">sampleMethod</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// FIXME: - ログ出力ではなく、アラートを出す</span>
</span><span class='line'>  <span class="n">print</span><span class="p">(</span><span class="s">&quot;This is sampleMethod.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_9.png" alt="FIXME" /></p>

<h5>TODO</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">func</span> <span class="nf">sampleMethod</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// TODO: - ログ出力ではなく、何か処理を書く(まだ決まっていないけど)</span>
</span><span class='line'>  <span class="n">print</span><span class="p">(</span><span class="s">&quot;This is sampleMethod.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_10.png" alt="TODO" /></p>

<h5>Parameter / Throws / Returns</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> サンプルメソッド</span>
</span><span class='line'><span class="cm">       </span>
</span><span class='line'><span class="cm"> - parameter name: パラメータの書き方</span>
</span><span class='line'><span class="cm"> - throws: 例外処理の書き方</span>
</span><span class='line'><span class="cm"> - returns: 戻り値の書き方</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="n">func</span> <span class="n">sampleMethod2</span><span class="p">(</span><span class="nl">name:</span><span class="n">String</span><span class="p">)</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class='line'>                                  
</span><span class='line'>  <span class="k">return</span> <span class="s">&quot;result: &quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://grandbig.github.io/images/documment_comment_11.png" alt="Parameter / Throws / Returns" /></p>

<h5>Description内で利用可能な文言</h5>

<p>この他にクラス, プロパティ, メソッドの説明(Description)を書く際に利用可能な予約語的なものが幾つかあります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> - Attention: 注意書き</span>
</span><span class='line'><span class="cm"> - Author: 作成者が一人の場合</span>
</span><span class='line'><span class="cm"> - Authors: 作成者が複数人の場合</span>
</span><span class='line'><span class="cm"> - Bug: バグの詳細</span>
</span><span class='line'><span class="cm"> - Copyright: 著作権の所在</span>
</span><span class='line'><span class="cm"> - Date: 日付(作成日, 更新日など)</span>
</span><span class='line'><span class="cm"> - Experiment: 実験内容</span>
</span><span class='line'><span class="cm"> - Important: 重要事項</span>
</span><span class='line'><span class="cm"> - Invariant: 不変事項</span>
</span><span class='line'><span class="cm"> - Note: その他、必要事項</span>
</span><span class='line'><span class="cm"> - Precondition: 事前条件</span>
</span><span class='line'><span class="cm"> - Postcondition: 事後条件</span>
</span><span class='line'><span class="cm"> - Remark: 備考</span>
</span><span class='line'><span class="cm"> - Requires: 要求事項</span>
</span><span class='line'><span class="cm"> - SeeAlso: 参照事項</span>
</span><span class='line'><span class="cm"> - Since: いつから実装されているか</span>
</span><span class='line'><span class="cm"> - Version: バージョン</span>
</span><span class='line'><span class="cm"> - Warning: 警告                  </span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>上記のように書くことで、 <strong>太字</strong> かつ <strong>各用語に属する説明</strong> が付与されます。</p>

<p><img src="http://grandbig.github.io/images/documment_comment_12.png" alt="予約語1" /></p>

<p><img src="http://grandbig.github.io/images/documment_comment_13.png" alt="予約語2" /></p>

<h4>まとめ</h4>

<p>さて、いかがだったでしょうか？<br/>
これだけ知っていれば、ほぼ確実に困ることはないと思います。<br/>
どこまで頑張って書くかは開発者次第かもしれませんが、やはり初めてコードを見る人でも極力伝わるようにしておくことは必要不可欠かと思います。</p>

<p>といったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kotlinを使ってみよう！(2) : OkHttp編]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/23/kotlin-okhttp/"/>
    <updated>2016-01-23T16:47:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/23/kotlin-okhttp</id>
    <content type="html"><![CDATA[<h4>今回のKotlinのお題は？</h4>

<p>さて、久々にKotlinについて勉強をしたいと思います。<br/>
今回のお題は<a href="http://grandbig.github.io/blog/2016/01/19/android-okhttp/">Android StudioでOkHttp3.0.1を使おう！</a>にしたいと思います。<br/>
では、早速見ていきましょう！</p>

<h4>KotlinでOkHttp3.0.1を使うソースを書いてみる</h4>

<p>まずは、OkHttp3.0.1を使ったソースを書いてみます。<br/>
OkHttpの導入はJavaと同じです。</p>

<p>build.gradle(app)に下記を追加しましょう。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'>  <span class="n">compile</span> <span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">squareup</span><span class="o">.</span><span class="na">okhttp3</span><span class="o">:</span><span class="nl">okhttp:</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="err">&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>Javaで紹介したときと同様に、Open Weather Map APIを使ったGETリクエストを利用します。<br/>
OkHttpでは通信処理をメインスレッドで実行しようとするとエラーが発生してしまうので、<code>AsyncTask</code>を利用します。<br/>
<code>AsyncTask</code>を継承したクラスを書きます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">simpleapplication</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.AsyncTask</span>
</span><span class='line'>
</span><span class='line'><span class="n">open</span> <span class="kd">class</span> <span class="nc">MyAsyncTask</span> <span class="o">:</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">override</span> <span class="n">fun</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">vararg</span> <span class="nl">params:</span> <span class="n">Void</span><span class="o">):</span> <span class="n">String</span><span class="o">?</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">null</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ここでKotlinの書き方を説明しましょう。</p>

<ul>
<li><code>open</code>

<ul>
<li>他のクラスからの継承を許可するアノテーション</li>
<li><code>MainActivity</code>で<code>doInBackground</code>メソッドをオーバーライドするために設定<br/>
　</li>
</ul>
</li>
<li><code>vararg</code>

<ul>
<li>可変長にしたい引数の名前に設定</li>
<li><code>donInBackground</code>は引数が1つ以上設定可能な可変長なものを持つため利用</li>
</ul>
</li>
</ul>


<p>続いて、<code>MainActivity</code>を書いていきます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">simpleapplication</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.AsyncTask</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.OkHttpClient</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Request</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Response</span>
</span><span class='line'>
</span><span class='line'><span class="kd">class</span> <span class="nc">MainActivity</span><span class="o">:</span><span class="n">AppCompatActivity</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">internal</span> <span class="n">var</span> <span class="n">client</span> <span class="o">=</span> <span class="n">OkHttpClient</span><span class="o">()</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">override</span> <span class="n">fun</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nl">savedInstanceState:</span> <span class="n">Bundle</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">)</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">)</span>
</span><span class='line'>      <span class="n">val</span> <span class="n">toolbar</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">)</span> <span class="n">as</span> <span class="n">Toolbar</span>
</span><span class='line'>      <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// GET Weatherボタンを取得して、クリック処理を実装</span>
</span><span class='line'>      <span class="n">val</span> <span class="n">btn</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">)</span> <span class="n">as</span> <span class="n">Button</span>
</span><span class='line'>      <span class="n">btn</span><span class="o">.</span><span class="na">setOnClickListener</span> <span class="o">{</span>
</span><span class='line'>          <span class="nl">object:</span> <span class="n">MyAsyncTask</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">override</span> <span class="n">fun</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">vararg</span> <span class="nl">params:</span> <span class="n">Void</span><span class="o">):</span> <span class="n">String</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">var</span> <span class="nl">res:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>                  <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">res</span> <span class="o">=</span> <span class="n">run</span><span class="o">(</span><span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?APPID=&lt;自身のAPPID&gt;&amp;q=Tokyo&quot;</span><span class="o">)</span>
</span><span class='line'>                      <span class="n">val</span> <span class="n">resJson</span> <span class="o">=</span> <span class="n">JsonObject</span><span class="o">(</span><span class="n">res</span><span class="o">)</span>
</span><span class='line'>                      <span class="n">val</span> <span class="n">weathers</span> <span class="o">=</span> <span class="n">resJson</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">&quot;weather&quot;</span><span class="o">)</span>
</span><span class='line'>                      <span class="n">val</span> <span class="n">weather</span> <span class="o">=</span> <span class="n">weathers</span><span class="o">.</span><span class="na">getJsonObject</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</span><span class='line'>                      <span class="n">val</span> <span class="n">description</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">)</span>
</span><span class='line'>                      <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;MainActivity&quot;</span><span class="o">,</span> <span class="n">description</span><span class="o">)</span>
</span><span class='line'>                      <span class="n">res</span> <span class="o">=</span> <span class="n">description</span>
</span><span class='line'>                  <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nl">e:</span> <span class="n">IOException</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>                  <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nl">e:</span> <span class="n">JSONException</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>          <span class="o">}.</span><span class="na">execute</span><span class="o">()</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">fun</span> <span class="nf">run</span><span class="o">(</span><span class="nl">url:</span> <span class="n">String</span><span class="o">):</span> <span class="n">String</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">val</span> <span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">url</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">val</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">()</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">string</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ここでもKotlinの書き方を説明します。</p>

<ul>
<li><code>object</code>

<ul>
<li>匿名サブクラスのインスタンスの返却式</li>
<li>setOnClickListenerの引数にMyAsyncTaskを匿名クラスとして指定するために利用</li>
<li>Kotlinではインスタンス生成に<code>new</code>は利用しない</li>
</ul>
</li>
</ul>


<p>さて、いかがでしたでしょうか？<br/>
KotlinはSwiftに近い書式で書けるため、筆者にとっては非常にわかりやすいです。<br/>
ただ、Javaとの互換性が非常に高いため、やはりそれなりに覚えなくてはならないことがありますね。</p>

<p>これからも少しずつではありますが、Kotlinを見ていきたいと思います。<br/>
といったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android StudioでOkHttp3.0.1を使おう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/19/android-okhttp/"/>
    <updated>2016-01-19T00:35:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/19/android-okhttp</id>
    <content type="html"><![CDATA[<h4>Volleyではなく、OkHttpを使おう！</h4>

<p>さて、本日は久しぶりにAndroidの話です。<br/>
これまでAndroidの通信ライブラリとして活躍してきた <strong>Volley</strong> が敬遠されている傾向があります。<br/>
と言うのも、Volleyが依存しているApache Http ClientがAPI Level22からdeprecatedになったためです。</p>

<p>では、今後は何を使っていけば良いのでしょうか？<br/>
もちろん開発者自身で通信処理を0から実装することも悪いことではないのですが、<br/>
やはり、少しでも開発効率を良くするためにオープンソースを利用したいところですよね。</p>

<p>そこで、昨今、皆が使っているものとして<a href="http://square.github.io/okhttp/">OkHttp</a>というものがあります。<br/>
これは <strong>HTTP</strong> だけでなく、 <strong>HTTP/2</strong> も対応しているため、きちんと最新を追えているという安心感がある点も良い印象です。</p>

<p>また、<a href="http://techlife.cookpad.com/entry/2015/06/25/093507">クックパッド開発者ブログ</a>でも <strong>OkHttp</strong> への移行を進める旨が書かれていますので、知っていて損はなさそうです。</p>

<p>今回は、OKHttpを使ったサンプルを載せたいと思います。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>OKHttpの導入</h4>

<p>Android StudioにOKHttpを導入しましょう。<br/>
導入は超簡単です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'>  <span class="n">compile</span> <span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">squareup</span><span class="o">.</span><span class="na">okhttp3</span><span class="o">:</span><span class="nl">okhttp:</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="err">&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>はい。以上です。</p>

<h4>OKHttpでGETリクエストを実行</h4>

<p>さて、GETリクエストを実行してみましょう。<br/>
今回は下記のようなサンプルアプリを作成しました。<br/>
<img src="http://grandbig.github.io/images/android-okhttp.png" alt="サンプルアプリ" /></p>

<p>まずは、<code>AsyncTask</code>を継承したクラスを下記のように作ります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">takahiro</span><span class="o">.</span><span class="na">simpleapplication</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.AsyncTask</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Created by kato_takahiro on 2016/01/19.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// コンストラクタ</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">MyAsyncTask</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="n">String</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>さて、<code>MainActivity.java</code>内で実行してみます。<br/>
このとき、 <strong>GET Weather</strong> ボタンをタップしたときに天気情報を取得するものとします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Toolbar</span> <span class="n">toolbar</span> <span class="o">=</span> <span class="o">(</span><span class="n">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// GET Weatherボタンを取得して、クリック処理を実装</span>
</span><span class='line'>      <span class="n">Button</span> <span class="n">btn</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
</span><span class='line'>      <span class="n">btn</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="nd">@Override</span>
</span><span class='line'>          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">new</span> <span class="nf">MyAsyncTask</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                  <span class="nd">@Override</span>
</span><span class='line'>                  <span class="kd">protected</span> <span class="n">String</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">String</span> <span class="n">res</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>                      <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                          <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="o">(</span><span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?APPID=&lt;自身のAPPID&gt;&amp;q=Tokyo&quot;</span><span class="o">);</span>
</span><span class='line'>                          <span class="n">JSONObject</span> <span class="n">resJson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span><span class='line'>                          <span class="n">JSONArray</span> <span class="n">weathers</span> <span class="o">=</span> <span class="n">resJson</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">&quot;weather&quot;</span><span class="o">);</span>
</span><span class='line'>                          <span class="n">JSONObject</span> <span class="n">weather</span> <span class="o">=</span> <span class="n">weathers</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>                          <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>                          <span class="n">res</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
</span><span class='line'>                      <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>                      <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>                      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>                      <span class="k">return</span> <span class="n">res</span><span class="o">;</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>              <span class="o">}.</span><span class="na">execute</span><span class="o">();</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// OKHttpを使った通信処理</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span><span class='line'>              <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
</span><span class='line'>              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">string</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>忘れずに<code>AndroidManifest.xml</code>で通信許可しておきましょう。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">manifest</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="n">package</span><span class="o">=</span><span class="s">&quot;com.example.takahiro.simpleapplication&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.permission.INTERNET&quot;</span> <span class="o">&gt;&lt;/</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;/</span><span class="n">manifest</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>まだ、GETしか試していませんが、割りと簡単に実装できますね。</p>

<h4>注意点</h4>

<p>初め、実装するにあたって、躓いたことを書いておきます。<br/>
何となしに<code>OKHttp</code>を実装し、デバッグしたところ、<code>android.os.NetworkOnMainThreadException</code>が発生しました。</p>

<p>これは、通信処理をメインスレッドで実行しようとしたために発生しました。<br/>
そのため、<code>AsyncTask</code>を使って別スレッドで通信処理を実行するように改修する必要がありました。</p>

<p>さて、今回は筆者用のメモの意味合いが強いのですが、Androidアプリの開発に関する記事も今度どんどん増やしていきたいと思います。<br/>
と言ったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SwiftでGCDを使ってみよう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/18/semaphore/"/>
    <updated>2016-01-18T09:26:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/18/semaphore</id>
    <content type="html"><![CDATA[<h4>GCDとは</h4>

<p>GCDとはGrand Central Dispatchの略で、iOSアプリでマルチスレッド処理を実行したいときに利用する手法です。<br/>
書き方は独特ですが、慣れてしまえば、簡単に使いこなすことができると思います。<br/>
今回は筆者が困ったときに使う方法について紹介していきます。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>メインスレッドの処理を妨げたくないとき</h4>

<p>iOSアプリでは描画はメインスレッドでしか実行できません。<br/>
(もし、それ以外で実行しようとすれば、アプリがダウンしてしまいます。)</p>

<p>筆者がアプリを開発しているときに、<br/>
検証のため、ログをローカルストレージに保存したい場面がありました。<br/>
ログ保存処理は一時的な検証のためであり、本来のメイン処理を妨げたくはありません。</p>

<p>ログ保存処理は <strong>描画を含まない処理</strong> であるため、<br/>
別にスレッドを立てて、そちらに任せてしまうことができます。<br/>
これにより、メインスレッドに影響を及ぼすことなく、処理を実行することができます。</p>

<p>下記にサンプルを載せます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// ViewController.swift</span>
</span><span class='line'><span class="n">import</span> <span class="n">UIKit</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">let</span> <span class="nl">queue:</span><span class="n">dispatch_queue_t</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="p">{()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="c1">// 別スレッドでの処理</span>
</span><span class='line'>          <span class="c1">// 例えば、Realmを使った保存処理などを書く(今回は省略します)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// アラート表示処理</span>
</span><span class='line'>      <span class="n">let</span> <span class="nl">alertController:</span><span class="n">UIAlertController</span> <span class="o">=</span> <span class="n">UIAlertController</span><span class="p">(</span><span class="nl">title:</span> <span class="s">&quot;確認&quot;</span><span class="p">,</span> <span class="nl">message:</span> <span class="n">message</span><span class="p">,</span> <span class="nl">preferredStyle:</span> <span class="p">.</span><span class="n">Alert</span><span class="p">)</span>
</span><span class='line'>      <span class="n">let</span> <span class="nl">okAction:</span><span class="n">UIAlertAction</span> <span class="o">=</span> <span class="n">UIAlertAction</span><span class="p">(</span><span class="nl">title:</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="nl">style:</span> <span class="p">.</span><span class="n">Default</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">alert</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="c1">// OKを選択したときに実行される処理</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">alertController</span><span class="p">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">okAction</span><span class="p">)</span>
</span><span class='line'>      <span class="n">presentViewController</span><span class="p">(</span><span class="n">alertController</span><span class="p">,</span> <span class="nl">animated:</span> <span class="n">true</span><span class="p">,</span> <span class="nl">completion:</span> <span class="nb">nil</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>このように <strong>dispatch_async</strong> 内でRealmへのログ保存処理をすれば、<br/>
別スレッドでの処理となるため、<br/>
ログ保存処理を待たずにアラートの表示処理を実行することができます。</p>

<p><strong>dispatch_get_global_queue</strong> とその引数などの詳細は<a href="https://github.com/mixi-inc/iOSTraining/wiki/8.2-Grand-Central-Dispatch">8.2 Grand Central Dispatch</a>に非常に詳しく書かれているので、ぜひご参照ください。</p>

<h4>複数の非同期処理の情報で何か処理がしたいとき</h4>

<p>例えば、複数種類のWeb APIを叩いて、それぞれから取得した情報を合算して、画面に表示したいとします。<br/>
（別々にAPIを叩いて取得した情報を別々に返せば問題ない場面では当てはまらないので注意）</p>

<p>そんなときは <strong>dispatch_group_async</strong> と <strong>dispatch_group_notify</strong> を使います。</p>

<p>下記にサンプルを載せます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import UIKit</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewControlelr:</span><span class="n">UIViewController</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">let</span> <span class="nl">queue:</span><span class="n">dispatch_queue_t</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="n">let</span> <span class="nl">group:</span><span class="n">dispatch_group_t</span> <span class="o">=</span> <span class="n">dispatch_group_create</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm"> 指定都市の天気情報を取得する処理</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>  <span class="n">func</span> <span class="n">getWeather</span><span class="p">(</span><span class="nl">location:</span><span class="n">String</span><span class="p">,</span> <span class="nl">closure:</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Alamofire</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?APPID=&lt;自身のAPPID&gt;&quot;</span><span class="p">,</span> <span class="nl">parameters:</span>
</span><span class='line'>          <span class="p">[</span><span class="s">&quot;q&quot;</span><span class="o">:</span><span class="n">location</span><span class="p">]).</span><span class="n">response</span> <span class="p">{</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">let</span> <span class="n">dataDict</span> <span class="o">=</span> <span class="n">try</span> <span class="n">NSJSONSerialization</span><span class="p">.</span><span class="n">JSONObjectWithData</span><span class="p">(</span><span class="n">data</span><span class="o">!</span><span class="p">,</span> <span class="nl">options:</span> <span class="n">NSJSONReadingOptions</span><span class="p">.</span><span class="n">AllowFragments</span><span class="p">)</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weatherArray:</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataDict</span><span class="p">[</span><span class="s">&quot;weather&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weather:</span><span class="n">AnyObject</span> <span class="o">=</span> <span class="n">weatherArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">description:</span><span class="n">String</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="n">String</span>
</span><span class='line'>                  <span class="n">closure</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">print</span><span class="p">(</span><span class="s">&quot;例外が発生しました&quot;</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm"> 複数都市の天気情報を取得しログ出力する処理</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>  <span class="n">func</span> <span class="n">getMultiLocationWeather</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">var</span> <span class="nl">tokyoWeather:</span><span class="n">String</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span>
</span><span class='line'>      <span class="n">var</span> <span class="nl">osakaWeather:</span><span class="n">String</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span>
</span><span class='line'>      <span class="n">var</span> <span class="nl">saitamaWeather:</span><span class="n">String</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// グループに 「+1」</span>
</span><span class='line'>      <span class="n">dispatch_group_enter</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">)</span>
</span><span class='line'>      <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">getWeather</span><span class="p">(</span><span class="s">&quot;Tokyo, jp&quot;</span><span class="p">,</span> <span class="nl">closure:</span> <span class="p">{</span> <span class="p">(</span><span class="n">weather</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>              <span class="n">tokyoWeather</span> <span class="o">=</span> <span class="n">weather</span>
</span><span class='line'>              <span class="c1">// グループに 「-1」</span>
</span><span class='line'>              <span class="n">dispatch_group_leave</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">)</span>
</span><span class='line'>          <span class="p">})</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// グループに 「+1」</span>
</span><span class='line'>      <span class="n">dispatch_group_enter</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">)</span>
</span><span class='line'>      <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">getWeather</span><span class="p">(</span><span class="s">&quot;Osaka, jp&quot;</span><span class="p">,</span> <span class="nl">closure:</span> <span class="p">{</span> <span class="p">(</span><span class="n">weather</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>              <span class="n">osakaWeather</span> <span class="o">=</span> <span class="n">weather</span>
</span><span class='line'>              <span class="c1">// グループに 「-1」</span>
</span><span class='line'>              <span class="n">dispatch_group_leave</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">)</span>
</span><span class='line'>          <span class="p">})</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// グループに 「+1」</span>
</span><span class='line'>      <span class="n">dispatch_group_enter</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">)</span>
</span><span class='line'>      <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">getWeather</span><span class="p">(</span><span class="s">&quot;Saitama, jp&quot;</span><span class="p">,</span> <span class="nl">closure:</span> <span class="p">{</span> <span class="p">(</span><span class="n">weather</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>              <span class="n">saitamaWeather</span> <span class="o">=</span> <span class="n">weather</span>
</span><span class='line'>              <span class="c1">// グループに 「-1」</span>
</span><span class='line'>              <span class="n">dispatch_group_leave</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">)</span>
</span><span class='line'>          <span class="p">})</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// 全ての処理が終わったら実行される</span>
</span><span class='line'>      <span class="n">dispatch_group_notify</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">group</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="n">print</span><span class="p">(</span><span class="s">&quot;Tokyo: \(tokyoWeather), Osaka: \(osakaWeather), Saitama: \(saitamaWeather)&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上のように、3つの非同期処理で取得した情報を使って、文章を作成し、ログ出力することができます。</p>

<h4>非同期処理を同期処理にしたい(排他制御を使いたい)とき</h4>

<p>さて、こちらは正直、筆者は利用したいと思ったことがありません。<br/>
恐らく、かなり多機能なアプリで、極力多くの処理を並列に実行したい場合に必要なのかなと思ったりします。<br/>
では、なぜ書くかというと、先日スタックオーバーフローを見て気になったからです。</p>

<p>因みに、筆者のスタックオーバーフローユーザは<a href="http://ja.stackoverflow.com/users/8968/takahiro">こちら</a>です。</p>

<p><a href="https://blog.katty.in/2365">Objective-Cで非同期処理を同期処理にする方法。</a>の例をSwiftで書き直します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import UIKit</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span><span class="n">UIViewController</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">let</span> <span class="nl">semaphore:</span><span class="n">dispatch_semaphore_t</span> <span class="o">=</span> <span class="n">dispatch_semaphore_create</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="n">let</span> <span class="nl">queue:</span><span class="n">dispatch_queue_t</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">func</span> <span class="n">printLog</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="k">for</span><span class="p">(</span><span class="n">var</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>              <span class="n">print</span><span class="p">(</span><span class="s">&quot;Process: \(i)&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">dispatch_semaphore_signal</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">semaphore</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s">&quot;wait...&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">dispatch_semaphore_wait</span><span class="p">(</span><span class="n">semaphore</span><span class="p">,</span> <span class="n">DISPATCH_TIME_FOREVER</span><span class="p">)</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s">&quot;finish&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>実行してみれば、下記のようにログ出力されることがわかるでしょう。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">wait</span><span class="p">...</span>
</span><span class='line'><span class="nl">Process:</span> <span class="mi">0</span>
</span><span class='line'><span class="nl">Process:</span> <span class="mi">1</span>
</span><span class='line'><span class="nl">Process:</span> <span class="mi">2</span>
</span><span class='line'><span class="nl">Process:</span> <span class="mi">3</span>
</span><span class='line'><span class="nl">Process:</span> <span class="mi">4</span>
</span><span class='line'><span class="n">finish</span>
</span></code></pre></td></tr></table></div></figure>


<p>非同期処理を待ってから、 <strong>finish</strong> とログ出力されていることがわかります。<br/>
この例ではわかりやすさのため、 <strong>dispatch_async</strong> を使って、非同期処理を作り出しています。</p>

<p>iOSアプリの開発でよく利用する非同期処理と言えば、通信処理ではないでしょうか？<br/>
Swiftでは特に<a href="https://github.com/Alamofire/Alamofire">Alamofire</a>がよく利用されています。</p>

<p>Alamofireを使って、上記と似たことをやろうとすると、下記のように書くかもしれません。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import UIKit</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span><span class="n">UIViewController</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">let</span> <span class="nl">semaphore:</span><span class="n">dispatch_semaphore_t</span> <span class="o">=</span> <span class="n">dispatch_semaphore_create</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="n">let</span> <span class="nl">queue:</span><span class="n">dispatch_queue_t</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">func</span> <span class="n">getWeather</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Alamofire</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?APPID=&lt;自身のAPPID&gt;&quot;</span><span class="p">,</span> <span class="nl">parameters:</span>
</span><span class='line'>          <span class="p">[</span><span class="nl">q:</span> <span class="s">&quot;Tokyo, jp&quot;</span><span class="p">]).</span><span class="n">response</span> <span class="p">{</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>                      <span class="n">let</span> <span class="n">dataDict</span> <span class="o">=</span> <span class="n">try</span> <span class="n">NSJSONSerialization</span><span class="p">.</span><span class="n">JSONObjectWithData</span><span class="p">(</span><span class="n">data</span><span class="o">!</span><span class="p">,</span> <span class="nl">options:</span> <span class="n">NSJSONReadingOptions</span><span class="p">.</span><span class="n">AllowFragments</span><span class="p">)</span>
</span><span class='line'>                      <span class="n">let</span> <span class="nl">weatherArray:</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataDict</span><span class="p">[</span><span class="s">&quot;weather&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span>
</span><span class='line'>                      <span class="n">let</span> <span class="nl">weather:</span><span class="n">AnyObject</span> <span class="o">=</span> <span class="n">weatherArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>                      <span class="n">let</span> <span class="nl">description:</span><span class="n">String</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="n">String</span>
</span><span class='line'>
</span><span class='line'>                      <span class="n">dispatch_semaphore_signal</span><span class="p">(</span><span class="n">semaphore</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>                      <span class="n">print</span><span class="p">(</span><span class="s">&quot;例外が発生しました&quot;</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">}</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s">&quot;wait...&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">dispatch_semaphore_wait</span><span class="p">(</span><span class="n">semaphore</span><span class="p">,</span> <span class="n">DISPATCH_TIME_FOREVER</span><span class="p">)</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s">&quot;finish&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>しかしながら、これは実行しても <strong>finish</strong> とログを出力することはありません。<br/>
理由は、<strong>dispatch_semaphore_wait</strong> を実行した後、メインスレッドを停止するのですが、<br/>
<code>Alamofire</code>の <strong>response</strong> のクロージャ処理はメインスレッドで実行されるため、<br/>
<strong>dispatch_semaphore_signal</strong> が実行されることがないからです。</p>

<p>実際に<code>Alamofire</code>の<code>ResponseSerialization.swift</code> > <code>Request</code> クラスを見てみましょう。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">public</span> <span class="n">func</span> <span class="nf">response</span><span class="p">(</span>
</span><span class='line'>  <span class="n">queue</span> <span class="nl">queue:</span> <span class="n">dispatch_queue_t</span><span class="o">?</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">,</span>
</span><span class='line'>  <span class="nl">completionHandler:</span> <span class="p">(</span><span class="n">NSURLRequest</span><span class="o">?</span><span class="p">,</span> <span class="n">NSHTTPURLResponse</span><span class="o">?</span><span class="p">,</span> <span class="n">NSData</span><span class="o">?</span><span class="p">,</span> <span class="n">NSError</span><span class="o">?</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span>
</span><span class='line'>  <span class="o">-&gt;</span> <span class="n">Self</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">delegate</span><span class="p">.</span><span class="n">queue</span><span class="p">.</span><span class="n">addOperationWithBlock</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span> <span class="o">??</span> <span class="n">dispatch_get_main_queue</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">completionHandler</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">request</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">response</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">delegate</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">delegate</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">self</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>となっていることがわかるはずです。</p>

<p>さて、いかがでしたでしょうか？<br/>
GCDは非常に便利な反面、迂闊に使うと思わぬ落とし穴にハマってしまうことがあります。<br/>
とは言え、<br/>
一度ハマってみないと身につかないのがプログラミングの世界だと思っているので、<br/>
ぜひじゃんじゃん使ってハマってみて頂ければと思います笑</p>

<p>と言ったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[tabBarControllerとUINavigationControllerを同時に使いたい！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/17/tabbarcontroller/"/>
    <updated>2016-01-17T22:18:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/17/tabbarcontroller</id>
    <content type="html"><![CDATA[<h4>tabBarControllerとUINavigationControllerを両立させよう！</h4>

<p>本日はtabBarControllerとUINavigationControllerを両方使いたい場合の方法を説明します。<br/>
方法は簡単です。</p>

<p><strong>tabBarControllerを先に追加して、</strong><br/>
<strong>その子要素にUINavigationControllerを追加してください。</strong></p>

<p>具体的に図で説明します。</p>

<p>１．storyboardでtabBarControllerを追加<br/>
XcodeメニューのEditor > Embed in > Tab Bar Controller を選択してください。<br/>
<img src="http://grandbig.github.io/images/tabBarController_1.png" alt="tabBarControllerの追加" /></p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>すると、下図のようにstoryboardにTab Bar Controllerが追加されます。<br/>
<img src="http://grandbig.github.io/images/tabBarController_2.png" alt="storyboardに表示されます" /></p>

<p>このままでは、tabBarにitem(項目)が１つしかないので、ViewControllerを追加しましょう。</p>

<p>２．ドラッグ＆ドロップでstoryboardにUIViewControllerを追加<br/>
右メニューから <strong>View Controller</strong> をドラッグ＆ドロップしましょう。<br/>
<img src="http://grandbig.github.io/images/tabBarController_3.png" alt="View Controllerをドラッグ＆ドロップ" /></p>

<p>３．tabBarControllerと追加したUIViewControllerを紐付ける<br/>
Tab Bar Controller上でcontrolキーを押しながら、追加したView Controllerの方へ線を伸ばして紐付けます。<br/>
<img src="http://grandbig.github.io/images/tabBarController_4.png" alt="Tab Bar ControllerとView Controllerのひも付け" /></p>

<p>これにより、Tab Bar Controllerに1つ項目が増えて、View Controllerまでひも付けが伸びていることを確認できます。<br/>
<img src="http://grandbig.github.io/images/tabBarController_5.png" alt="項目の追加完了" /></p>

<p>続いて、UINavigationControllerを追加していきましょう。</p>

<p>４．子要素のView ControllerにUINavigationControllerを追加<br/>
UINavigationControllerを追加したいView Controllerを選択して、<br/>
XcodeメニューのEditor > Embed in > Navigation Controller を選択してください。<br/>
<img src="http://grandbig.github.io/images/tabBarController_6.png" alt="UINavigationControllerの追加" /></p>

<p>結果、Tab Bar ControllerとView Controllerの間にNavigation Controllerが追加されたことがわかると思います。<br/>
<img src="http://grandbig.github.io/images/tabBarController_7.png" alt="Navigation Controllerが追加されました" /></p>

<p>別の子要素のView ControllerにもNavigation Controllerが必要な場合は、<br/>
そのView Controllerに対して同じ操作を繰り返し実施してください。</p>

<p>storyboard上ではUINavigationControllerを先に追加して、<br/>
tabBarControllerを追加することもできます。<br/>
ですが、UINavigationControllerの戻るボタンの非表示やカスタム化などをしようとすると、<br/>
どうもうまくいきません&hellip;。<br/>
なので、一見無駄に見えるかもしれませんが、この方法を試してみることをオススメします。</p>

<p>本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[QuickでSwiftコードのUnitテストをしよう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/16/quick/"/>
    <updated>2016-01-16T19:49:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/16/quick</id>
    <content type="html"><![CDATA[<h4>Quickフレームワークを使おう！</h4>

<p>先日、XCTestによるiOSアプリのUnit TestとUI Testについて記事を書きました。<br/>
もちろんXCTestを使って、テストをすることに問題はありません。<br/>
ですが、XCTestは非常に独特な書式で、初めて使う人には取っ付きにくいかと思います。</p>

<p>そんな中、注目を集めているiOSアプリ用のテストフレームワークが<a href="https://github.com/Quick/Quick">Quick</a>です。<br/>
GitHubに書かれている通り、<a href="https://github.com/rspec/rspec">RSpec</a> / <a href="https://github.com/specta/specta">Specta</a> / <a href="https://github.com/onsi/ginkgo">Ginkgo</a>にインスパイアされて開発されているため、親しみやすい書式でテストコードを書くことができます。<br/>
(筆者もこれを機に親しもうと思います笑)</p>

<p>これまでiOSアプリのテストコードは独特で&hellip;と避けてきた方がいましたら、ぜひ <strong>Quick</strong> を導入してみて頂ければと思います。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>Quickの導入方法</h4>

<p>では、Quickを導入しましょう。<br/>
GitHubにも書いてありますが、CocoaPodsでの導入方法は下記です。<br/>
※ 説明用のプロジェクト名を <strong>QuickSample</strong> とします。</p>

<p>１．Podfileの作成</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp"># Podfile</span>
</span><span class='line'>
</span><span class='line'><span class="n">use_frameworks</span><span class="o">!</span>
</span><span class='line'>
</span><span class='line'><span class="n">def</span> <span class="n">testing_pods</span>
</span><span class='line'>  <span class="n">pod</span> <span class="err">&#39;</span><span class="n">Quick</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="o">~&gt;</span> <span class="mf">0.8.0</span><span class="err">&#39;</span>
</span><span class='line'>  <span class="n">pod</span> <span class="err">&#39;</span><span class="n">Nimble</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="mf">3.0.0</span><span class="err">&#39;</span>
</span><span class='line'><span class="n">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">target</span> <span class="err">&#39;</span><span class="n">QuickSampleTests</span><span class="err">&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">testing_pods</span>
</span><span class='line'><span class="n">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">target</span> <span class="err">&#39;</span><span class="n">QuickSampleUITests</span><span class="err">&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">testing_pods</span>
</span><span class='line'><span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>２．CocoaPodsコマンドを実行<br/>
Podfileと同階層で<code>pod install</code>を実行</p>

<p>３．テストファイルを用意<br/>
プロジェクト作成時に<code>QuickSampleTests.swift</code>を作成しておいたので、それを編集します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// QuickSampleTests.swift</span>
</span><span class='line'><span class="n">import</span> <span class="n">XCTest</span>
</span><span class='line'><span class="n">import</span> <span class="n">Quick</span>
</span><span class='line'><span class="n">import</span> <span class="n">Nimble</span>
</span><span class='line'><span class="err">@</span><span class="n">testable</span> <span class="n">import</span> <span class="n">QuickSample</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">QuickSampleTests:</span> <span class="n">QuickSpec</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">spec</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// ここにテストコードを書いていきます。</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これで<code>QuickSpec</code>をオーバーライドしたテスト用クラスになりました。<br/>
最低限の準備はこれで完了です。</p>

<h4>Quickでのテストコードの書式</h4>

<p>続いて、基本的なテストコードの書式を見ていきましょう。</p>

<p>１．<code>describe</code>：『何のテストをするのか』を記述</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// テストコード</span>
</span><span class='line'><span class="n">override</span> <span class="n">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">describe</span><span class="p">(</span><span class="s">&quot;天気情報をログ出力する&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// 「天気情報をログ出力する」ことをテストするためのコードを書いていきます。</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>２．<code>context</code>：『どういった条件のテストをするのか』を記述</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// テストコード</span>
</span><span class='line'><span class="n">override</span> <span class="n">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">describe</span><span class="p">(</span><span class="s">&quot;天気情報をログ出力する&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">context</span><span class="p">(</span><span class="s">&quot;晴れの場合&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 天気が晴れの場合のテスト</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">context</span><span class="p">(</span><span class="s">&quot;雨の場合&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 天気が雨の場合のテスト</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>３．<code>it</code>：『このテストはこういった結果になる』ということを記述</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// テストコード</span>
</span><span class='line'><span class="n">override</span> <span class="n">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">describe</span><span class="p">(</span><span class="s">&quot;天気情報をログ出力する&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">context</span><span class="p">(</span><span class="s">&quot;晴れの場合&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 天気が晴れの場合のテスト</span>
</span><span class='line'>          <span class="n">it</span><span class="p">(</span><span class="s">&quot;print out &#39;sunny&#39;&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="c1">// 実行するテストコードをここに記述します</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>４．<code>expect('☓☓☓').to(△△△)</code>：『「☓☓☓」が「△△△」と等しい結果になる』ことを記述<br/>
ここは説明のために、テスト対象を<code>Weather.swift</code>として下記のようなコードだとします。<br/>
あくまでも<code>expect('☓☓☓').to(△△△)</code>の説明であるため、<code>Weather.getWeather</code>の処理は超簡単にしています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// Weather.swift</span>
</span><span class='line'><span class="n">class</span> <span class="nl">Weather:</span><span class="n">NSObject</span> <span class="p">{</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">getWeather</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="s">&quot;sunny&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>続いてテストコードです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// テストコード</span>
</span><span class='line'><span class="n">override</span> <span class="n">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">describe</span><span class="p">(</span><span class="s">&quot;天気情報をログ出力する&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">context</span><span class="p">(</span><span class="s">&quot;晴れの場合&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 天気が晴れの場合のテスト</span>
</span><span class='line'>          <span class="n">it</span><span class="p">(</span><span class="s">&quot;print out &#39;sunny&#39;&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">let</span> <span class="n">weather</span> <span class="o">=</span> <span class="n">Weather</span><span class="p">().</span><span class="n">getWeather</span><span class="p">()</span>
</span><span class='line'>              <span class="n">expect</span><span class="p">(</span><span class="n">weather</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">contain</span><span class="p">(</span><span class="s">&quot;sunny&quot;</span><span class="p">))</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>補足すると、</p>

<p>・戻り値と期待値が完全一致する場合：<code>to(equal(△△△))</code><br/>
・戻り値が期待値の一部を含む場合：<code>to(contain(△△△))</code></p>

<p>といったように使い分けましょう。</p>

<p>５．非同期処理のテストをする場合<br/>
これまで同期処理を見てきましたが、今度は非同期処理を見ていきましょう。</p>

<p><code>Weather.swift</code>クラスに非同期処理を追加します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// Weather.swift</span>
</span><span class='line'><span class="n">class</span> <span class="nl">Weather:</span><span class="n">NSObject</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">getAsyncWeather</span><span class="p">(</span><span class="nl">closure:</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Alamofire</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?APPID=&lt;自身のAPPIDを指定&gt;&quot;</span><span class="p">,</span> <span class="nl">parameters:</span>
</span><span class='line'>          <span class="p">[</span><span class="s">&quot;q&quot;</span><span class="o">:</span><span class="s">&quot;Tokyo,jp&quot;</span><span class="p">]).</span><span class="n">response</span> <span class="p">{</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">let</span> <span class="n">dataDict</span> <span class="o">=</span> <span class="n">try</span> <span class="n">NSJSONSerialization</span><span class="p">.</span><span class="n">JSONObjectWithData</span><span class="p">(</span><span class="n">data</span><span class="o">!</span><span class="p">,</span> <span class="nl">options:</span> <span class="n">NSJSONReadingOptions</span><span class="p">.</span><span class="n">AllowFragments</span><span class="p">)</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weatherArray:</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataDict</span><span class="p">[</span><span class="s">&quot;weather&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weather:</span><span class="n">AnyObject</span> <span class="o">=</span> <span class="n">weatherArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">description:</span><span class="n">String</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="n">String</span>
</span><span class='line'>                  <span class="n">closure</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">clouser</span><span class="p">(</span><span class="s">&quot;exception&quot;</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>XCTestでも説明しましたが、<br/>
Swiftではスタブの代わりに <strong>manual mocking</strong> という手法を採用しています。<br/>
なので、通信処理はテストコード内で継承したクラスを作成して、そちらで定数を返すようにしましょう。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// テストコード</span>
</span><span class='line'><span class="n">override</span> <span class="n">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// manual mockingのための用意</span>
</span><span class='line'>  <span class="n">class</span> <span class="nl">WeatherMock:</span><span class="n">Weather</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">override</span> <span class="n">func</span> <span class="n">getAsyncWeather</span><span class="p">(</span><span class="nl">closure:</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">closure</span><span class="p">(</span><span class="s">&quot;sunny&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span><span class="p">(</span><span class="s">&quot;天気情報を取得する&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">context</span><span class="p">(</span><span class="s">&quot;晴れの場合&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 天気が晴れの場合のテスト</span>
</span><span class='line'>          <span class="n">it</span><span class="p">(</span><span class="s">&quot;print out &#39;sunny&#39;&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">var</span> <span class="nl">result:</span><span class="n">String</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>              <span class="n">let</span> <span class="nl">wm:</span><span class="n">WeatherMock</span> <span class="o">=</span> <span class="n">WeatherMock</span><span class="p">()</span>
</span><span class='line'>              <span class="n">wm</span><span class="p">.</span><span class="n">getAsyncWeather</span><span class="p">{(</span><span class="n">weather</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>                  <span class="n">result</span> <span class="o">=</span> <span class="n">weather</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="n">expect</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="n">toEventually</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s">&quot;sunny&quot;</span><span class="p">))</span><span class="s">&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>因みに、非同期処理では、<code>to</code>ではなく<code>toEventually</code>を利用します。<br/>
<code>expect(result).toEventually(equal("sunny"), timeout: 10)</code>と書けば、<br/>
任意のタイムアウトを設定可能です。</p>

<p>その他のメソッドを探したい場合は、<br/>
<strong>Pods > Nimble > ObjCExpectation.swift > NMBExpectation</strong> を確認してみてください。<br/>
また、<a href="https://github.com/Quick/Nimble">GitHubのNimble</a>も参考になります。</p>

<h4>Quickでのテスト結果</h4>

<p>テストの実行方法はXCTestと同じです。<br/>
<strong>Xcodeメニュー > Product > Test</strong> を選択してテストを実行しましょう。</p>

<p>結果は同じく、Xcodeの左メニューに表示されます。</p>

<p><img src="http://grandbig.github.io/images/quick.png" alt="Xcodeのテスト結果" /></p>

<p>また、ログでも細かな結果が出力されますので、<br/>
(少し見づらいですが)なぜかテストが成功しないといったことがあれば、<br/>
積極的に確認してみましょう。</p>

<p>さて、いかがでしたでしょうか？<br/>
今のところは <strong>XCTest</strong> もしくは <strong>Quick</strong> によるUnit テストが主流になると思います。<br/>
開発者の使いやすさに合わせて選んでみてください。</p>

<p>と言ったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[東京Node学園付属小学校 1限目に参加してみた！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/15/node-elementary-school/"/>
    <updated>2016-01-15T19:27:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/15/node-elementary-school</id>
    <content type="html"><![CDATA[<h4>Node.jsを基礎から見直そう！</h4>

<p>以前、業務でNode.js v0.6.12だったり、v0.10.24だったりを触ってきました。<br/>
しかし個々最近は、ネイティブアプリ開発にかかりっきりになっていたので、Node.jsから遠ざかってしまっていました。<br/>
そんなこともあり、「これじゃいかん！」ということで今回、 <strong>東京Node学園付属小学校 1限目</strong> に参加してみることにしました。</p>

<p>通常のNode学園は行ったことがあったものの、非常にレベルが高いなと感じた経験があり、まずは思い出す足掛けということで&hellip;。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>勉強会の内容と感想</h4>

<p>さて、勉強会の内容と感想について書いていきます。</p>

<h5>オープニング</h5>

<p>teratailでは技術の壁をなくしたい。<br/>
何かサービスを開発するときには、いつも使っている言語を選びがちだけど、一番適した技術を使ったり、新しい技術を導入したりできると良いな〜という感じ。</p>

<p>工数やリソースの問題から、保守的になって実績のあるやり方で進めるパターン多いんだよな〜と思いながら聞いていました笑。</p>

<h5>ゲスト講演</h5>

<p>ゲスト講演はNode.js日本ユーザーグループ代表の古川陽介さんが担当されていました。<br/>
内容はあえてNode.jsではなく、Guillermo Rauch(socket.ioの作者)が提唱した  <strong>7 principles of rich web applications</strong> でした。<br/>
筆者は勉強不足のせいもあって、初めて知りました。</p>

<p>古川さん曰く、実際に7つの原則を満たしているWeb Applicationは存在しないんではないかと&hellip;。<br/>
詳しい内容は<a href="http://yosuke-furukawa.hatenablog.com/entry/2014/11/14/141415">【翻訳】リッチなWebアプリケーションのための7つの原則</a>に書かれています。</p>

<p>筆者個人としてはSPA(Single Page Application)が興味を惹いている理由を知れたり、<a href="https://developers.google.com/web/tools/chrome-devtools/profile/evaluate-performance/rail">RAIL</a>という重要な指標を知れたりと、かなり勉強になりました。</p>

<p>また特に印象的だったのは、 <strong>レイテンシの壁</strong> の話でした。<br/>
通信をする限り、レイテンシは必ず存在するのだと。<br/>
それを処理の仕方で早く見せることができないかと鎬を削る様がとても惹きつけられました。</p>

<p>最近ネイティブ開発ばかりやっていた自分としては、描画に対するレイテンシはあまり気にしていませんでした。<br/>
きちんと考えないとダメだなと。</p>

<p>JavaScriptは7つの原則をクリアできるのだ！！</p>

<h5>LT</h5>

<p>続いて、LTです。<br/>
<strong>東京Node学園付属小学校</strong> という名にふさわしく、知識・技術的についていけないといったことなく、落ち着いて聞くことができました。</p>

<p>以下、聞いたことを箇条書き</p>

<ul>
<li>お役立ちツール

<ul>
<li><a href="http://swagger.io/">SWAGGER</a>
Web APIドキュメント生成ツール</li>
<li><a href="http://nodered.org/">Node-RED</a>
Drug&amp;Dropで簡単にWebアプリを作れるツール</li>
<li><a href="http://loopback.io/">LoopBack</a>
Node.jsベースのBaaSを作れるオープンソース
　</li>
</ul>
</li>
<li>Node.jsが使われているサービス

<ul>
<li>Uber</li>
<li>PayPal(JavaからNode.jsに移行)</li>
<li>NETFLIX
　</li>
</ul>
</li>
<li>Node.jsの良いところ

<ul>
<li>非エンジニアでも簡単にWebアプリが作れる</li>
<li>クライアントとサーバサイド共にJavaScriptで書ける</li>
<li>リアルタイム通信でいろいろなWebアプリを作りたくなる</li>
<li>IoTでも使える</li>
<li>「同時に接続して、チームで協力してゴールを達成する」方向にも注目&hellip;</li>
</ul>
</li>
</ul>


<p>とりあえず、Node.js意欲が湧いてきたので、何か作りたい！！</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jazzyを使って、Swiftで書いたプロジェクトのリファレンスを自動生成しよう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/12/jazzy/"/>
    <updated>2016-01-12T23:18:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/12/jazzy</id>
    <content type="html"><![CDATA[<h4>jazzyとは</h4>

<p>さて、本日は<a href="https://github.com/Realm/jazzy">jazzy</a>について書こうと思います。<br/>
jazzyはSwiftで書いたプロジェクトのリファレンスを自動で生成できるツールです。<br/>
最近、熱いMobile DatabaseであるRealmと同じチームが開発しているようです。<br/>
今のところ、他に良さそうなツールはないんじゃないでしょうか？</p>

<p>兎にも角にも、早速使ってみることにします。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h5>jazzyのインストール</h5>

<p>jazzyのインストールは簡単です。<br/>
下記コマンドを実行してください。</p>

<p><code>sudo gem install jazzy</code></p>

<h5>jazzyのコマンド</h5>

<p><code>jazzy -h</code>を実行してコマンドを確認してみましょう。<br/>
下記のような結果が得られるはずです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="nl">Usage:</span> <span class="n">jazzy</span>
</span><span class='line'>
</span><span class='line'><span class="n">Options</span>
</span><span class='line'>  <span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">FOLDER</span>              <span class="n">Folder</span> <span class="n">to</span> <span class="n">output</span> <span class="n">the</span> <span class="n">HTML</span> <span class="n">docs</span> <span class="n">to</span>
</span><span class='line'>  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">clean</span>                 <span class="n">Delete</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">output</span> <span class="n">directory</span> <span class="n">before</span> <span class="n">running</span><span class="p">.</span>
</span><span class='line'>                                   <span class="nl">WARNING:</span> <span class="n">If</span> <span class="o">--</span><span class="n">output</span> <span class="n">is</span> <span class="n">set</span> <span class="n">to</span> <span class="o">~/</span><span class="n">Desktop</span><span class="p">,</span> <span class="n">this</span> <span class="n">will</span> <span class="n">delete</span> <span class="n">the</span> <span class="o">~/</span><span class="n">Desktop</span> <span class="n">directory</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">objc</span>                  <span class="n">Generate</span> <span class="n">docs</span> <span class="k">for</span> <span class="n">Objective</span><span class="o">-</span><span class="n">C</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="n">umbrella</span><span class="o">-</span><span class="n">header</span> <span class="n">PATH</span>       <span class="n">Umbrella</span> <span class="n">header</span> <span class="k">for</span> <span class="n">your</span> <span class="n">Objective</span><span class="o">-</span><span class="n">C</span> <span class="n">framework</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="n">framework</span><span class="o">-</span><span class="n">root</span> <span class="n">PATH</span>        <span class="n">The</span> <span class="n">root</span> <span class="n">path</span> <span class="n">to</span> <span class="n">your</span> <span class="n">Objective</span><span class="o">-</span><span class="n">C</span> <span class="n">framework</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="n">sdk</span> <span class="p">[</span><span class="n">iphone</span><span class="o">|</span><span class="n">watch</span><span class="o">|</span><span class="n">appletv</span><span class="p">][</span><span class="n">os</span><span class="o">|</span><span class="n">simulator</span><span class="p">]</span><span class="o">|</span><span class="n">macosx</span>
</span><span class='line'>                                   <span class="n">The</span> <span class="n">SDK</span> <span class="k">for</span> <span class="n">which</span> <span class="n">your</span> <span class="n">code</span> <span class="n">should</span> <span class="n">be</span> <span class="n">built</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="n">config</span> <span class="n">PATH</span>                <span class="n">Configuration</span> <span class="n">file</span> <span class="p">(.</span><span class="n">yaml</span> <span class="n">or</span> <span class="p">.</span><span class="n">json</span><span class="p">)</span>
</span><span class='line'>                                   <span class="nl">Default:</span> <span class="p">.</span><span class="n">jazzy</span><span class="p">.</span><span class="n">yaml</span> <span class="k">in</span> <span class="n">source</span> <span class="n">directory</span> <span class="n">or</span> <span class="n">ancestor</span>
</span><span class='line'>  <span class="o">-</span><span class="n">x</span> <span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="err">…</span><span class="n">argN</span><span class="p">,</span>              <span class="n">Arguments</span> <span class="n">to</span> <span class="n">forward</span> <span class="n">to</span> <span class="n">xcodebuild</span>
</span><span class='line'>      <span class="o">--</span><span class="n">xcodebuild</span><span class="o">-</span><span class="n">arguments</span>
</span><span class='line'>  <span class="o">-</span><span class="n">s</span> <span class="n">FILEPATH</span><span class="p">,</span>                     <span class="n">File</span> <span class="n">generated</span> <span class="n">from</span> <span class="n">sourcekitten</span> <span class="n">output</span> <span class="n">to</span> <span class="n">parse</span>
</span><span class='line'>      <span class="o">--</span><span class="n">sourcekitten</span><span class="o">-</span><span class="n">sourcefile</span>
</span><span class='line'>      <span class="o">--</span><span class="n">source</span><span class="o">-</span><span class="n">directory</span> <span class="n">DIRPATH</span>   <span class="n">The</span> <span class="n">directory</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">source</span> <span class="n">to</span> <span class="n">be</span> <span class="n">documented</span>
</span><span class='line'>  <span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="o">--</span><span class="n">exclude</span> <span class="n">file1</span><span class="p">,</span><span class="n">file2</span><span class="p">,</span><span class="err">…</span><span class="n">fileN</span> <span class="n">Files</span> <span class="n">to</span> <span class="n">be</span> <span class="n">excluded</span> <span class="n">from</span> <span class="n">documentation</span>
</span><span class='line'>      <span class="o">--</span><span class="n">swift</span><span class="o">-</span><span class="n">version</span> <span class="n">VERSION</span>
</span><span class='line'>  <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">--</span><span class="n">author</span> <span class="n">AUTHOR_NAME</span>         <span class="n">Name</span> <span class="n">of</span> <span class="n">author</span> <span class="n">to</span> <span class="n">attribute</span> <span class="k">in</span> <span class="n">docs</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">Realm</span><span class="p">)</span>
</span><span class='line'>  <span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">author_url</span> <span class="n">URL</span>             <span class="n">Author</span> <span class="n">URL</span> <span class="n">of</span> <span class="n">this</span> <span class="n">project</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="nl">http:</span><span class="c1">//realm.io)</span>
</span><span class='line'>  <span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">--</span><span class="n">module</span> <span class="n">MODULE_NAME</span>         <span class="n">Name</span> <span class="n">of</span> <span class="n">module</span> <span class="n">being</span> <span class="n">documented</span><span class="p">.</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">RealmSwift</span><span class="p">)</span>
</span><span class='line'>      <span class="o">--</span><span class="n">module</span><span class="o">-</span><span class="n">version</span> <span class="n">VERSION</span>     <span class="n">module</span> <span class="n">version</span><span class="p">.</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="n">when</span> <span class="n">generating</span> <span class="n">docset</span>
</span><span class='line'>      <span class="o">--</span><span class="n">copyright</span> <span class="n">COPYRIGHT_MARKDOWN</span>
</span><span class='line'>                                   <span class="n">copyright</span> <span class="n">markdown</span> <span class="n">rendered</span> <span class="n">at</span> <span class="n">the</span> <span class="n">bottom</span> <span class="n">of</span> <span class="n">the</span> <span class="n">docs</span> <span class="n">pages</span>
</span><span class='line'>      <span class="o">--</span><span class="n">readme</span> <span class="n">FILEPATH</span>            <span class="n">The</span> <span class="n">path</span> <span class="n">to</span> <span class="n">a</span> <span class="n">markdown</span> <span class="n">README</span> <span class="n">file</span>
</span><span class='line'>      <span class="o">--</span><span class="n">podspec</span> <span class="n">FILEPATH</span>
</span><span class='line'>      <span class="o">--</span><span class="n">docset</span><span class="o">-</span><span class="n">icon</span> <span class="n">FILEPATH</span>
</span><span class='line'>      <span class="o">--</span><span class="n">docset</span><span class="o">-</span><span class="n">path</span> <span class="n">DIRPATH</span>        <span class="n">The</span> <span class="n">relative</span> <span class="n">path</span> <span class="k">for</span> <span class="n">the</span> <span class="n">generated</span> <span class="n">docset</span>
</span><span class='line'>  <span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">root</span><span class="o">-</span><span class="n">url</span> <span class="n">URL</span>               <span class="n">Absolute</span> <span class="n">URL</span> <span class="n">root</span> <span class="n">where</span> <span class="n">these</span> <span class="n">docs</span> <span class="n">will</span> <span class="n">be</span> <span class="n">stored</span>
</span><span class='line'>  <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">--</span><span class="n">dash_url</span> <span class="n">URL</span>               <span class="n">Location</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dash</span> <span class="n">XML</span> <span class="n">feed</span> <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="nl">http:</span><span class="c1">//realm.io/docsets/realm.xml)</span>
</span><span class='line'>  <span class="o">-</span><span class="n">g</span><span class="p">,</span> <span class="o">--</span><span class="n">github_url</span> <span class="n">URL</span>             <span class="n">GitHub</span> <span class="n">URL</span> <span class="n">of</span> <span class="n">this</span> <span class="n">project</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="nl">https:</span><span class="c1">//github.com/realm/realm-cocoa)</span>
</span><span class='line'>      <span class="o">--</span><span class="n">github</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">prefix</span> <span class="n">PREFIX</span>  <span class="n">GitHub</span> <span class="n">URL</span> <span class="n">file</span> <span class="n">prefix</span> <span class="n">of</span> <span class="n">this</span> <span class="n">project</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="nl">https:</span><span class="c1">//github.com/realm/realm-cocoa/tree/v0.87.1)</span>
</span><span class='line'>      <span class="o">--</span><span class="n">min</span><span class="o">-</span><span class="n">acl</span> <span class="p">[</span><span class="n">private</span> <span class="o">|</span> <span class="n">internal</span> <span class="o">|</span> <span class="n">public</span><span class="p">]</span>
</span><span class='line'>                                   <span class="n">minimum</span> <span class="n">access</span> <span class="n">control</span> <span class="n">level</span> <span class="n">to</span> <span class="n">document</span>
</span><span class='line'>      <span class="o">--</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">skip</span><span class="o">-</span><span class="n">undocumented</span>     <span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">document</span> <span class="n">declarations</span> <span class="n">that</span> <span class="n">have</span> <span class="n">no</span> <span class="n">documentation</span> <span class="n">comments</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">hide</span><span class="o">-</span><span class="n">documentation</span><span class="o">-</span><span class="n">coverage</span>
</span><span class='line'>                                   <span class="n">Hide</span> <span class="s">&quot;(X% documented)&quot;</span> <span class="n">from</span> <span class="n">the</span> <span class="n">generated</span> <span class="n">documents</span>
</span><span class='line'>      <span class="o">--</span><span class="n">head</span> <span class="n">HTML</span>                  <span class="n">Custom</span> <span class="n">HTML</span> <span class="n">to</span> <span class="n">inject</span> <span class="n">into</span> <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;&lt;/</span><span class="n">head</span><span class="o">&gt;</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="n">theme</span> <span class="p">[</span><span class="n">apple</span> <span class="o">|</span> <span class="n">fullwidth</span> <span class="o">|</span> <span class="n">DIRPATH</span><span class="p">]</span>
</span><span class='line'>                                   <span class="n">Which</span> <span class="n">theme</span> <span class="n">to</span> <span class="n">use</span><span class="p">.</span> <span class="n">Specify</span> <span class="n">either</span> <span class="err">&#39;</span><span class="n">apple</span><span class="err">&#39;</span> <span class="p">(</span><span class="k">default</span><span class="p">),</span> <span class="err">&#39;</span><span class="n">fullwidth</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">the</span> <span class="n">path</span> <span class="n">to</span> <span class="n">your</span> <span class="n">mustache</span> <span class="n">templates</span> <span class="n">and</span> <span class="n">other</span> <span class="n">assets</span> <span class="k">for</span> <span class="n">a</span> <span class="n">custom</span> <span class="n">theme</span><span class="p">.</span>
</span><span class='line'>  <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">template</span><span class="o">-</span><span class="n">directory</span> <span class="n">DIRPATH</span> <span class="nl">DEPRECATED:</span> <span class="n">Use</span> <span class="o">--</span><span class="n">theme</span> <span class="n">instead</span><span class="p">.</span>
</span><span class='line'>      <span class="o">--</span><span class="n">assets</span><span class="o">-</span><span class="n">directory</span> <span class="n">DIRPATH</span>   <span class="nl">DEPRECATED:</span> <span class="n">Use</span> <span class="o">--</span><span class="n">theme</span> <span class="n">instead</span><span class="p">.</span>
</span><span class='line'>  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>                    <span class="n">Print</span> <span class="n">version</span> <span class="n">number</span>
</span><span class='line'>  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span> <span class="p">[</span><span class="n">TOPIC</span><span class="p">]</span>               <span class="n">Available</span> <span class="nl">topics:</span>
</span><span class='line'>                                      <span class="n">usage</span>   <span class="n">Command</span> <span class="n">line</span> <span class="n">options</span> <span class="p">(</span><span class="n">this</span> <span class="n">help</span> <span class="n">message</span><span class="p">)</span>
</span><span class='line'>                                      <span class="n">config</span>  <span class="n">Configuration</span> <span class="n">file</span> <span class="n">options</span>
</span><span class='line'>                                   <span class="p">...</span><span class="n">or</span> <span class="n">an</span> <span class="n">option</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="s">&quot;dash&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ヘルプを見て頂ければ、なんとなく概要をつかめると思いますが、特に重要なものを説明します。</p>

<ol>
<li><code>-o FOLDER</code><br/>
リファレンスの出力場所を指定するコマンドです</li>
<li><code>--min-acl [private | internal | public]</code><br/>
リファレンスに出力するプロパティおよびメソッドの最低アクセス権限<br/>
例えば、<code>--min-acl public</code>を指定した場合、<code>private</code>や<code>internal</code>指定されたプロパティやメソッドはリファレンスに出力されません。</li>
<li><code>--skip-undocumented</code><br/>
ドキュメントコメントが書かれていないプロパティやメソッドはリファレンスに出力しません。</li>
<li><code>--author AUTHOR_NAME</code><br/>
リファレンスに開発者を明記します。</li>
<li><code>--author_url URL</code><br/>
リファレンス上に表記される開発者名にURlリンクを付与します。</li>
</ol>


<h4>Swift2.0以降でのドキュメントコメントの書き方について</h4>

<p>Swift2.0以降でのドキュメントコメントの書き方を見ていきます。<br/>
<strong>jazzy</strong> を使うことを前提にした書き方のみ記述します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">import</span> <span class="n">UIKit</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'>
</span><span class='line'><span class="cm">UIViewControllerを継承したViewControllerクラス</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// MARK: Properties</span>
</span><span class='line'>  <span class="c1">/// 文字列を格納するためのサンプル変数</span>
</span><span class='line'>  <span class="n">var</span> <span class="nl">sampleParam1:</span><span class="n">String</span><span class="o">?</span>
</span><span class='line'>  <span class="c1">/// 数値を格納するためのサンプル定数</span>
</span><span class='line'>  <span class="n">let</span> <span class="nl">sampleParam2:</span><span class="n">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// MARK: Method</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> ログを出力するメソッド</span>
</span><span class='line'><span class="cm">         </span>
</span><span class='line'><span class="cm"> - parameter message: ログ出力したいメッセージ</span>
</span><span class='line'><span class="cm">                 </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>  <span class="n">func</span> <span class="n">sampleMethod</span><span class="p">(</span><span class="nl">message:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> trueフラグを返すメソッド</span>
</span><span class='line'><span class="cm">         </span>
</span><span class='line'><span class="cm"> - returns: trueフラグ</span>
</span><span class='line'><span class="cm">                 </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>  <span class="n">func</span> <span class="n">sampleMethod2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">true</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> メッセージを生成するメソッド</span>
</span><span class='line'><span class="cm">          </span>
</span><span class='line'><span class="cm"> - parameter message: 生成したいメッセージの一部分</span>
</span><span class='line'><span class="cm"> - returns: 生成したメッセージ</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>  <span class="n">func</span> <span class="n">sampleMethod3</span><span class="p">(</span><span class="nl">message:</span><span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="s">&quot;生成したメッセージ： \(message)&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ポイントは、</p>

<ul>
<li>クラス名にドキュメントコメントを必ずつけること</li>
<li>メソッドのDescriptionとParameterもしくはReturnとの間に1行をあけること</li>
<li><code>:param:</code>や<code>:returns:</code>といった古い書き方をしないこと</li>
</ul>


<p>です。</p>

<p>上記ポイントを踏まえた上で、<br/>
<code>jazzy --min-acl internal --skip-undocumented -o jazzy_doc --author Takahiro --author_url https://grandbig.github.io/</code><br/>
を実行してみましょう。<br/>
オプションは必要に応じてつけてください。</p>

<p>結果、下図のようなリファレンスが作成されます。</p>

<p><img src="http://grandbig.github.io/images/jazzy_1.png" alt="トップページ" /><br/>
こちらはトップページです。</p>

<p><img src="http://grandbig.github.io/images/jazzy_2.png" alt="クラスの説明" /><br/>
続いて、クラスを選択した際に表示されるクラスの説明ページ</p>

<p><img src="http://grandbig.github.io/images/jazzy_3.png" alt="クラスのプロパティの説明" /><br/>
各プロパティを選択すれば、その説明が表示されます。</p>

<p><img src="http://grandbig.github.io/images/jazzy_4.png" alt="クラスのメソッドの説明" /><br/>
各メソッドを選択すれば、その説明が表示されます。</p>

<p>いかがだったでしょうか？<br/>
リファレンスは第三者にソースコードを説明する上でも非常に重要なものです。<br/>
初めから書式ルールに沿ってコードを書いておけば、自動生成ツールで速攻リファレンスを作れますので、ぜひぜひ把握しておきましょう。</p>

<p>と言ったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SwiftでXCTestを使って単体テストとUIテストをしてみよう！]]></title>
    <link href="http://grandbig.github.io/blog/2016/01/11/xctest/"/>
    <updated>2016-01-11T19:17:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2016/01/11/xctest</id>
    <content type="html"><![CDATA[<h4>iOSアプリケーション開発でのテストとは</h4>

<p>さて、本日はiOSアプリケーションを開発する際のテストについて書きたいと思います。<br/>
元々、Objective-Cでは下記のテスト用のライブラリが使われてきました。</p>

<ul>
<li><a href="https://github.com/kiwi-bdd/Kiwi">Kiwi</a></li>
<li><a href="https://github.com/gh-unit/gh-unit">GHUnit</a></li>
<li><a href="https://github.com/specta/specta">Specta</a></li>
</ul>


<p>しかし、これらはあくまでもObjective-C時代にApple公式のテストフレームワークが充実する以前から活躍していたものです。今後、Swiftが普及するにつれて、これらのテストフレームワークもSwiftに最適化したものになっていくかもしれません。<br/>
とは言え、AppleもいつまでもOSSのテストフレームワークがなければならない状況は避け、Xcode内で完結することを目指していくかもしれません。<br/>
後ほど詳しく説明しますが、Xcode7からUIテストが新たに追加されたのも、その流れだと思っています。</p>

<p>本日は特に <strong>XCTest</strong> に焦点をあてた、iOSにおけるテストについて見ていきたいと思います。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>XCTestでUnit Test</h4>

<p>早速、XCTestの使い方について見ていきましょう。<br/>
Xcode7ではプロジェクトを新規作成する際にXCTest用のTargetを作成するか否かを選ぶことができます。<br/>
初めにチェックを入れていない場合は、途中で追加することが可能ですが、単体テストをすることは大切なので、チェックはつけておきましょう。</p>

<p><img src="http://grandbig.github.io/images/xctest_1.png" alt="プロジェクト作成時にXCTest用のTargetを作成" /></p>

<p>今回テストするソースコードは下記のようなシンプルなものにします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">import</span> <span class="n">UIKit</span>
</span><span class='line'><span class="n">import</span> <span class="n">Alamofire</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">didReceiveMemoryWarning</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">didReceiveMemoryWarning</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">showWeather</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">getWeather</span><span class="p">{(</span><span class="n">description</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="n">print</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">getWeather</span><span class="p">(</span><span class="nl">closure:</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Alamofire</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?APPID=&lt;自身のAPPIDを指定&gt;&quot;</span><span class="p">,</span> <span class="nl">parameters:</span>
</span><span class='line'>          <span class="p">[</span><span class="s">&quot;q&quot;</span><span class="o">:</span><span class="s">&quot;Tokyo&quot;</span><span class="p">]).</span><span class="n">response</span> <span class="p">{</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">let</span> <span class="n">dataDict</span> <span class="o">=</span> <span class="n">try</span> <span class="n">NSJSONSerialization</span><span class="p">.</span><span class="n">JSONObjectWithData</span><span class="p">(</span><span class="n">data</span><span class="o">!</span><span class="p">,</span> <span class="nl">options:</span> <span class="n">NSJSONReadingOptions</span><span class="p">.</span><span class="n">AllowFragments</span><span class="p">)</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weatherArray:</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataDict</span><span class="p">[</span><span class="s">&quot;weather&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weather:</span><span class="n">AnyObject</span> <span class="o">=</span> <span class="n">weatherArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">description:</span><span class="n">String</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="n">String</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c1">// アラートを表示</span>
</span><span class='line'>                  <span class="n">self</span><span class="p">.</span><span class="n">showAlert</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">print</span><span class="p">(</span><span class="s">&quot;例外が発生しました！&quot;</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>今回は <strong>showWeather</strong> メソッドのUnit Testを書いていきます。<br/>
上記コードを見て頂くと、 <strong>showWeather</strong> メソッドは <strong>Open Weather Map API</strong> を使って東京の天気を取得し、それをログとして出力していることがわかると思います。<br/>
前半の <strong>Alamofire</strong> を使った通信処理はOSSライブラリを使っているわけで、この通信処理のテストがしたいわけではありません。<br/>
筆者が実施したいテストは後半の <strong>Open Weather Map API</strong> を使って <strong>取得した天気情報をログに出力する</strong> 部分です。<br/>
(本来はテストするまでもないのですが、テストの手法や考え方をメインに説明したいので、ソースは超簡単にしています。)</p>

<p>それを踏まえた上で、実際にテストコードを書いてみましょう。<br/>
&lt;Project名>Tests.swiftファイルを選択します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">import</span> <span class="n">XCTest</span>
</span><span class='line'><span class="err">@</span><span class="n">testable</span> <span class="n">import</span> <span class="n">SimpleApplication</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">SimpleApplicationTests:</span> <span class="n">XCTestCase</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">setUp</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">setUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">tearDown</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">tearDown</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">func</span> <span class="n">testShowWeather</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">class</span> <span class="nl">VCMock:</span><span class="n">ViewController</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">override</span> <span class="n">func</span> <span class="n">getWeather</span><span class="p">(</span><span class="nl">closure:</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">closure</span><span class="p">(</span><span class="s">&quot;test weather&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">let</span> <span class="nl">vcm:</span><span class="n">VCMock</span> <span class="o">=</span> <span class="n">VCMock</span><span class="p">()</span>
</span><span class='line'>      <span class="n">vcm</span><span class="p">.</span><span class="n">showWeather</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ポイントは</p>

<ol>
<li>テストメソッドの定義<br/>
テストメソッドは、 <strong>test + &lt;任意の文字列></strong> で命名しましょう。</li>
<li>スタブの定義<br/>
Swiftは <strong>manual mocking</strong> という手法を取ります。<br/>
これはテスト対象クラスを継承したクラスを定義し、テストしたいメソッドをオーバーライドします。<br/>
返却値等を固定文字列とすることで、スタブの作成となります。</li>
</ol>


<p>の2点です。</p>

<p>では、このテストを実行してみます。</p>

<p>まず、実行Targetに <strong>&lt;Project名>Tests</strong> を選択できるようにSchemeを編集します。</p>

<p><img src="http://grandbig.github.io/images/xctest_2.png" alt="Manage Schemes..." /></p>

<p><img src="http://grandbig.github.io/images/xctest_3.png" alt="Add Scheme" /></p>

<p><img src="http://grandbig.github.io/images/xctest_4.png" alt="Choose Testsファイル" /></p>

<p><img src="http://grandbig.github.io/images/xctest_5.png" alt="Set Scheme" /><br/>
実行するSchemeを <strong>&lt;Project名>Tests</strong> に設定し、実行デバイスをシミュレータにします。<br/>
(実機ではテスト実行できないからです。)</p>

<p><img src="http://grandbig.github.io/images/xctest_6.png" alt="Testを実行" /><br/>
Xcodeメニュー > Product > Test を選択してテストを実行します。</p>

<p><img src="http://grandbig.github.io/images/xctest_7.png" alt="テスト結果の確認" /><br/>
左メニューおよびコード上からテスト結果を確認できます。</p>

<p>メソッドが増えるごとにテストメソッドを増やしていきましょう。<br/>
テストファイルはクラス別に作成しておくと、第三者から見ても見やすいと思います。</p>

<h4>XCTestでUI Test</h4>

<p>続いて、Xcode7から追加されたUI Testの方法を見ていきたいと思います。<br/>
冒頭で説明した通り、プロジェクト作成時に <strong>include UI Tests</strong> を選択しておくことで、 <strong>&lt;Project名>UITests.swift</strong> ファイルが作成されます。</p>

<p>では、UI Test用に少しコードを修正してみます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">import</span> <span class="n">UIKit</span>
</span><span class='line'><span class="n">import</span> <span class="n">Alamofire</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">didReceiveMemoryWarning</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">didReceiveMemoryWarning</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="err">@</span><span class="kt">IBAction</span> <span class="n">func</span> <span class="n">getWeatherAction</span><span class="p">(</span><span class="nl">sender:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">getWeather</span> <span class="p">{</span> <span class="p">(</span><span class="n">description</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">showAlert</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">getWeather</span><span class="p">(</span><span class="nl">closure:</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Alamofire</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://api.openweathermap.org/data/2.5/weather?APPID=&lt;自身のAPPIDを指定&gt;&quot;</span><span class="p">,</span> <span class="nl">parameters:</span>
</span><span class='line'>          <span class="p">[</span><span class="s">&quot;q&quot;</span><span class="o">:</span><span class="s">&quot;Tokyo&quot;</span><span class="p">]).</span><span class="n">response</span> <span class="p">{</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">let</span> <span class="n">dataDict</span> <span class="o">=</span> <span class="n">try</span> <span class="n">NSJSONSerialization</span><span class="p">.</span><span class="n">JSONObjectWithData</span><span class="p">(</span><span class="n">data</span><span class="o">!</span><span class="p">,</span> <span class="nl">options:</span> <span class="n">NSJSONReadingOptions</span><span class="p">.</span><span class="n">AllowFragments</span><span class="p">)</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weatherArray:</span><span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataDict</span><span class="p">[</span><span class="s">&quot;weather&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="p">[</span><span class="n">AnyObject</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">weather:</span><span class="n">AnyObject</span> <span class="o">=</span> <span class="n">weatherArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>                  <span class="n">let</span> <span class="nl">description:</span><span class="n">String</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span> <span class="n">as</span><span class="o">!</span> <span class="n">String</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c1">// アラートを表示</span>
</span><span class='line'>                  <span class="n">self</span><span class="p">.</span><span class="n">showAlert</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">print</span><span class="p">(</span><span class="s">&quot;例外が発生しました！&quot;</span><span class="p">)</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">showAlert</span><span class="p">(</span><span class="nl">message:</span><span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">let</span> <span class="nl">alertController:</span><span class="n">UIAlertController</span> <span class="o">=</span> <span class="n">UIAlertController</span><span class="p">(</span><span class="nl">title:</span> <span class="s">&quot;確認&quot;</span><span class="p">,</span> <span class="nl">message:</span> <span class="n">message</span><span class="p">,</span> <span class="nl">preferredStyle:</span> <span class="p">.</span><span class="n">Alert</span><span class="p">)</span>
</span><span class='line'>      <span class="n">let</span> <span class="nl">okAction:</span><span class="n">UIAlertAction</span> <span class="o">=</span> <span class="n">UIAlertAction</span><span class="p">(</span><span class="nl">title:</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="nl">style:</span> <span class="p">.</span><span class="n">Default</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">alert</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>          <span class="c1">// OKを選択したときに実行される処理</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">alertController</span><span class="p">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">okAction</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">presentViewController</span><span class="p">(</span><span class="n">alertController</span><span class="p">,</span> <span class="nl">animated:</span> <span class="n">true</span><span class="p">,</span> <span class="nl">completion:</span> <span class="nb">nil</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これに伴い、画面にボタンを配置しました。<br/>
このボタンをタップすると、天気情報をアラートで表示してくれます。</p>

<p><img src="http://grandbig.github.io/images/xctest_8.png" alt="ボタンを配置" /></p>

<p><img src="http://grandbig.github.io/images/xctest_9.png" alt="アラートを表示" /></p>

<p>では、UI Testのテストコードを作成します。<br/>
UI Testの場合は、Xcodeの <strong>UI recording</strong> 機能を使って、手作業でコードを修正していきます。</p>

<p><img src="http://grandbig.github.io/images/xctest_10.png" alt="UI recording 開始ボタンをタップ" /></p>

<p><img src="http://grandbig.github.io/images/xctest_11.png" alt="UI recording 終了ボタンをタップ" /></p>

<p>すると、下記のようなコードが生成されました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">func</span> <span class="nf">testShowWeatherAlert</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">let</span> <span class="n">app</span> <span class="o">=</span> <span class="n">XCUIApplication</span><span class="p">()</span>
</span><span class='line'>  <span class="n">app</span><span class="p">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">&quot;GET Weather&quot;</span><span class="p">].</span><span class="n">tap</span><span class="p">()</span>
</span><span class='line'>  <span class="n">app</span><span class="p">.</span><span class="n">alerts</span><span class="p">[</span><span class="s">&quot;\U78ba\U8a8d&quot;</span><span class="p">].</span><span class="n">collectionViews</span><span class="p">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">&quot;OK&quot;</span><span class="p">].</span><span class="n">tap</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>しかし、このままではエラーが表示されるはずです。<br/>
理由はアラートのタイトルを日本語にしていたため、ASCIIコードで表示されてしまっているからです。<br/>
もし、指し示しているASCIIコードが理解できないようであれば、<a href="http://web-apps.nbookmark.com/ascii-converter/">ASCIIコード変換機</a>を使ってください。</p>

<p>ASCIIコード部分を修正した結果が下記となります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">func</span> <span class="nf">testShowWeatherAlert</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">let</span> <span class="n">app</span> <span class="o">=</span> <span class="n">XCUIApplication</span><span class="p">()</span>
</span><span class='line'>  <span class="n">app</span><span class="p">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">&quot;GET Weather&quot;</span><span class="p">].</span><span class="n">tap</span><span class="p">()</span>
</span><span class='line'>  <span class="n">app</span><span class="p">.</span><span class="n">alerts</span><span class="p">[</span><span class="s">&quot;確認&quot;</span><span class="p">].</span><span class="n">collectionViews</span><span class="p">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">&quot;OK&quot;</span><span class="p">].</span><span class="n">tap</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>テストコードが作成できましたので、実行Targetに &lt;Project名>UITests を選択できるようにSchemeを編集します。</p>

<p><img src="http://grandbig.github.io/images/xctest_12.png" alt="Manage Schemes..." /></p>

<p><img src="http://grandbig.github.io/images/xctest_13.png" alt="Add Scheme" /></p>

<p><img src="http://grandbig.github.io/images/xctest_14.png" alt="Choose Testsファイル" /></p>

<p><img src="http://grandbig.github.io/images/xctest_15.png" alt="Set Scheme" /><br/>
実行するSchemeを &lt;Project名>UITests に設定し、実行デバイスをシミュレータにします。<br/>
(実機ではテスト実行できないからです。)</p>

<p><img src="http://grandbig.github.io/images/xctest_6.png" alt="Testを実行" /><br/>
Xcodeメニュー > Product > Test を選択してテストを実行します。</p>

<p><img src="http://grandbig.github.io/images/xctest_16.png" alt="テスト結果の確認" /><br/>
左メニューおよびコード上からテスト結果を確認できます。</p>

<p>Unit Testと同様にメソッドが増えるごとにテストメソッドを増やしていきましょう。<br/>
テストファイルはクラス別に作成しておくと、第三者から見ても見やすいと思います。</p>

<p>いかがだったでしょうか？<br/>
今回は超簡単なサンプルコードで基本的なことについて説明しましたが、今後深く使っていくことで躓くこともあるかもしれません。<br/>
その際にはまたブログにて説明したいと思います。<br/>
ぜひ、単体テストとUIテストを駆使して、バグの少ないアプリを作っていきたいものです。</p>

<p>と言ったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[今一度確かめようiOSにおけるHTML5 APIでの位置情報の取得]]></title>
    <link href="http://grandbig.github.io/blog/2015/12/23/geolocation/"/>
    <updated>2015-12-23T00:00:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/12/23/geolocation</id>
    <content type="html"><![CDATA[<h4>はじめに</h4>

<p>こちらはiOS Second Stage Advent Calendar 23日目の記事です。</p>

<p>筆者はこれまで2年と少し技術ブログを投稿してきましたが、Advent Calendarへの投稿はこれが初めてとなります。<br/>
どうぞよろしくお願いします。</p>

<p>今回お話させて頂く内容はiOSアプリでの位置情報の取得に関することです。<br/>
ほとんどの開発者の方は<code>CoreLocation.framework</code>を用いて位置情報の取得をされると思いますが、HTML5の<code>Geolocation API</code>を使っても位置情報の取得をすることができます。<br/>
とは言え、なぜわざわざiOSのパートで <strong>HTML5</strong> による位置情報取得の話をするかと言うと1つ理由があるんです。<br/>
その理由を紹介しつつ、現代のiOSによるHTML5の<code>Geolocation API</code>での位置情報取得について話したいと思います。</p>

<!-- more -->


<h4>2012年当時のGeolocation APIでの問題について</h4>

<p>実は筆者は3年ほど前に、iOSアプリに <strong>『HTML5 Geolocation APIによる位置情報取得機能』</strong> を実装する機会がありました。<br/>
そのアプリは2011年途中から開発が始まり、その間にiOSのバージョンも4.x→5.x→6.xと移り変わってきました。<br/>
iOS 4.x〜5.xの際は順調に進んでいたのですが、2012/09/19にiOS6.0が公開されるやいなや状況が一変しました。<br/>
というのもiOS6.0ではHTML5の<code>Geolocation API</code>による位置情報の取得に問題があったからなのです。</p>

<p>そもそも、HTML5の<code>Geolocation API</code>は下記のように使います。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 位置情報の取得に成功した場合</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">lat</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">lng</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">acc</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">accuracy</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 位置情報の取得に失敗した場合</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;位置情報が許可されていません。&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;デバイスの位置がわかりません。&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;アイムアウトしました。&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">},</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// オプションの設定</span>
</span><span class='line'>  <span class="nx">enableHighAccuracy</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">6000</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">maximumAge</span><span class="o">:</span> <span class="mi">60000</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>特に見て欲しいのが、オプションの設定の <strong>maximumAge</strong> です。<br/>
<strong>maximumAge</strong> は位置情報の有効期限を示す設定なのですが、iOS6.xでは <strong>maximumAge</strong> を0で設定しないと、継続的な位置情報の取得ができませんでした。<br/>
これはあくまでも一例なのですが、iOS6.0が出てきた当初は、下記のように悲痛な叫びが散見していました。</p>

<ul>
<li><a href="https://discussionsjapan.apple.com/thread/10126475?tstart=0">iOS6でGeolocation APIが動かない？</a></li>
<li><a href="https://discussions.apple.com/thread/4313850?start=30&amp;tstart=0">Geolocation doesn&rsquo;t work with iOS6 web apps!</a></li>
</ul>


<p>当時はGeolocation APIでの位置情報は利用に耐えないということで見送りましたが、現在のiOS9におけるGeolocation APIでの動作はどうなっているのでしょうか？</p>

<h4>現代のiOSでのGeolocation APIはどうなっている？</h4>

<p>さて、iOS9.xでは果たして<code>Geolocation API</code>の挙動はどうなっているのでしょうか？<br/>
今回はこの挙動を確かめるために下記機能を持ったアプリを開発し、実験を試みました。</p>

<p>【アプリの機能】</p>

<ul>
<li><code>Geolocation API</code>による位置情報取得機能を実装</li>
<li><code>CoreLocation.framework</code>による位置情報取得機能を実装</li>
<li>上記2つの位置情報をローカルストレージに保存(<code>RealmSwift</code>を利用)</li>
</ul>


<p>WEBフロントのソースコードは<a href="https://github.com/grandbig/GeoLocationSample">GitHubのGeoLocationSample</a>に公開しました。<br/>
iOSアプリのソースコードは<a href="https://github.com/grandbig/GeoLocation_iOS">GitHubのGeoLocation_iOS</a>に公開しました。</p>

<p>【実験したい内容】</p>

<ul>
<li>開発アプリを用いて幾つか位置情報を取得する</li>
<li><code>Geolocation API</code>で取得した位置情報の評価(キャッシュの有無を調査)</li>
<li><code>Geolocation API</code>と<code>CoreLocation.framework</code>で取得した値を比較</li>
</ul>


<p>【結果】</p>

<p>実験結果を一部抽出してGoogleマップにプロットしてみました。<br/>
<img src="http://grandbig.github.io/images/geolocation_plot.png" alt="結果のプロット" /></p>

<ul>
<li><code>Geolocation API</code>と<code>CoreLocation.framework</code>では精度のに大きな違いが出ないことがほとんど</li>
<li>地下鉄の駅に到着した際に取得するとWi-Fiのアクセスポイントをひろうため、精度に違いが出ないことが多い

<ul>
<li>精度が65 [m] の場合、Wi-Fiのアクセスポイントをひろっています。</li>
</ul>
</li>
<li><code>Geolocation API</code>はiOS9ではキャッシュの有効・無効が機能していた</li>
</ul>


<p>因みに、AppleがiOS9からATS設定を組み込んだように、世の中ではHTTPSを使うことが当たり前になってきています。<br/>
(というよりも商用サービスでHTTPを使わないことが当たり前になってきていると言いますか&hellip;)</p>

<p>実は、<code>Geolocation API</code>でも下記のような警告が出ました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">getCurrentPosition</span><span class="p">()</span> <span class="nx">and</span> <span class="nx">watchPosition</span><span class="p">()</span> <span class="nx">are</span> <span class="nx">deprecated</span> <span class="nx">on</span> <span class="nx">insecure</span> <span class="nx">origins</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">support</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">removed</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">future</span><span class="p">.</span> <span class="nx">You</span> <span class="nx">should</span> <span class="nx">consider</span> <span class="nx">switching</span> <span class="nx">your</span> <span class="nx">application</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">secure</span> <span class="nx">origin</span><span class="p">,</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">HTTPS</span><span class="p">.</span> <span class="nx">See</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//goo.gl/rStTGz for more details.</span>
</span></code></pre></td></tr></table></div></figure>


<h4>それぞれの使いどころは！？</h4>

<p>iOS9での実験を経て、精度として問題がないことがわかりました。<br/>
ではどんなときに<code>Geolocation API</code>を使って、どんなときに<code>CoreLocation.framework</code>を使えば良いのでしょうか？<br/>
筆者はざっくりと下記のパターン分けを考えています。</p>

<p>【<code>Geolocation API</code>を使う場合】</p>

<ul>
<li>ネイティブでの実装よりもWEBでの実装に慣れている場合</li>
<li>位置情報の利用シーンがアプリのフォアグラウンド起動時のみの場合</li>
<li>現在地の位置情報を1回取得すれば良い場合(取得までの時間がかからない)</li>
</ul>


<p>【<code>CoreLocation.framework</code>を使う場合】</p>

<ul>
<li>位置情報の利用シーンがアプリのバックグラウンド起動時も含む場合</li>
<li>位置情報の連続的な取得が必要な場合</li>
<li>現在地の位置情報を1回取得する際に多少時間がかかっても良い場合(<code>requestLocation</code>では約10秒かかる)</li>
</ul>


<p>もちろん、iOSに限った話ですし、Androidでの挙動も確かめる必要があります。<br/>
旧Androidの場合、WebViewがAndroid OSに依存しているため、<code>Geolocation API</code>の対応具合にバラつきがある可能性もあります。(それこそ、バグを含んでしまっている場合、ユーザがOSバージョンアップしないと解決できないことにも成りかねません。)<br/>
とは言え、AndroidもWebViewがOSから分離されましたし、旧Androidであっても、CROSSWALKを使う方法もあるので、やりようはありますし、HTML5 APIの実用性もどんどん上がっていくことでしょう。<br/>
もしかしたら、これから益々、ネイティブとハイブリッドの使い分けを考える時代になるかもしれません。</p>

<h4>まとめ</h4>

<p>久々に見てみるといろいろ変わってるな&hellip;。<br/>
といったところでiOS Second Stage Advent Calendar 23日目の記事は終了となります。<br/>
ありがとうございました！<br/>
(また来年、帰ってくるかも!?)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[超簡単Windows AzureでのWebサイト構築]]></title>
    <link href="http://grandbig.github.io/blog/2015/12/13/use-windows-azure/"/>
    <updated>2015-12-13T02:07:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/12/13/use-windows-azure</id>
    <content type="html"><![CDATA[<h4>Windows AzureでWebサイトを構築しよう</h4>

<p>さて、本日はWinsows Azureを使って簡単にWebサイトを構築したいと思います。<br/>
筆者は数年ぶりにWindows Azureを触ったため、UI・UXが結構変わっているなという印象を受けました。</p>

<p>Webアプリケーションを開発するとき、ページビューのみであれば、ローカル環境で十分でしょう。<br/>
しかし、位置情報やBeaconなどのIoT関連のアプリケーションを開発する場合、ローカル環境のWebページを閲覧できないこともあるでしょう。<br/>
そんなときはどうしてもサーバが欲しくなりますね。<br/>
筆者はWindows Azureをオススメしたいと思います。(AWSは使ったことないけど&hellip;)</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>それでは早速、簡単にWebサイトを構築する方法について説明しましょう。</p>

<p>１. ポータルサイトからサーバを新規作成</p>

<p><img src="http://grandbig.github.io/images/windows-azure-1.png" alt="サーバを新規作成" /></p>

<p>２. Web+モバイル > Web Appを選択</p>

<p><img src="http://grandbig.github.io/images/windows-azure-2.png" alt="サーバを新規作成２" /></p>

<p>３. Webアプリ名を決めて作成</p>

<p><img src="http://grandbig.github.io/images/windows-azure-3.png" alt="サーバを新規作成３" /></p>

<p>４. デプロイを待つ</p>

<p><img src="http://grandbig.github.io/images/windows-azure-4.png" alt="サーバを新規作成４" /></p>

<p>５. サーバ詳細画面に遷移</p>

<p><img src="http://grandbig.github.io/images/windows-azure-5.png" alt="サーバの新規作成が完了" /></p>

<p>６. サーバのデプロイ完了通知を受け取る</p>

<p><img src="http://grandbig.github.io/images/windows-azure-6.png" alt="サーバのデプロイ完了通知" /></p>

<p>７. リソースの設定</p>

<p><img src="http://grandbig.github.io/images/windows-azure-7.png" alt="サーバにリソースを設定" /></p>

<p>※筆者の場合はGitHubのリポジトリと同期させます。</p>

<p>８. リポジトリの同期</p>

<p><img src="http://grandbig.github.io/images/windows-azure-8.png" alt="リポジトリの同期" /></p>

<p>９. サーバ環境の完成</p>

<p><img src="http://grandbig.github.io/images/windows-azure-9.png" alt="サーバ環境が完成しました" /></p>

<p>本当にたったのこれだけでWebサイトを構築できるのです。<br/>
Node.jsなどをインストールしてAPサーバを構築する場合は少々手間がかかりますが、Webサーバを構築するだけなら簡単です。<br/>
ぜひ機会があれば使ってみて欲しいものです。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[なぜか全然表示できないiOS9でのWebView(凡ミス)]]></title>
    <link href="http://grandbig.github.io/blog/2015/12/13/ios9-wkwebview/"/>
    <updated>2015-12-13T01:32:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/12/13/ios9-wkwebview</id>
    <content type="html"><![CDATA[<h4>超絶凡ミスによる小１時間苦しんだiOS9でのWebView表示</h4>

<p>今日は、久々に苦しんだ凡ミスについてメモを残しておきます。<br/>
iOS9でハイブリットアプリを開発しようとしてハマりました。</p>

<p>なぜかきちんと書いているつもりが、どうしてもWebViewが表示されない&hellip;なんてことありませんか？<br/>
答えはiOS9だからこそハマった凡ミスでした。</p>

<p>メモ程度に書いておきます。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">import</span> <span class="n">UIKit</span>
</span><span class='line'><span class="n">import</span> <span class="n">WebKit</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span> <span class="n">UIViewController</span><span class="p">,</span> <span class="n">WKNavigationDelegate</span><span class="p">,</span> <span class="n">WKUIDelegate</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">var</span> <span class="nl">webView:</span><span class="n">WKWebView</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">webView</span> <span class="o">=</span> <span class="n">WKWebView</span><span class="p">(</span><span class="nl">frame:</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">)</span>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">webview</span><span class="o">?</span><span class="p">.</span><span class="n">UIDelegate</span> <span class="o">=</span> <span class="n">self</span>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">webview</span><span class="o">?</span><span class="p">.</span><span class="n">navigationDelegate</span> <span class="o">=</span> <span class="n">self</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">NSURL</span><span class="p">(</span><span class="nl">string:</span> <span class="s">&quot;http://www.google.co.jp&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">let</span> <span class="n">req</span> <span class="o">=</span> <span class="n">NSURLRequest</span><span class="p">(</span><span class="nl">URL:</span> <span class="n">url</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">webView</span><span class="o">?</span><span class="p">.</span><span class="n">loadRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">webView</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>さて、このままだと真っ白ページが表示されます。<br/>
何がダメなのでしょうか？</p>

<p>答えは <strong>ATS</strong> の設定がなかったからでした。<br/>
URLが <strong>http</strong> で指定されていたため、表示がされなかったのです。<br/>
iOS9が対象端末に入った時点で、 <strong>SSL</strong> は意識しておくべきですね。</p>

<p>すいません。本日はホントにメモです笑</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Atomエディタを使ってReact.jsを試してみた]]></title>
    <link href="http://grandbig.github.io/blog/2015/11/29/react-tutorial-by-using-atom/"/>
    <updated>2015-11-29T01:34:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/11/29/react-tutorial-by-using-atom</id>
    <content type="html"><![CDATA[<h4>Atomエディタとは</h4>

<p>筆者はこれまでWeb系のファイルは全てvimで書いてきました。<br/>
このまま、vimを使い続けても良いのですが、最近やっと一般的に認知され始めた <a href="https://atom.io/">Atom</a> を使ってみようかなと思いつきで始めてみます笑<br/>
(Atomが招待制だった頃に少々触ってはいたのですが、改めて触ってみると、便利ですね&hellip;。)</p>

<p>因みにAtomとはGitHub製のオープンソースエディタです。<br/>
2015年6月にバージョン1.0が公開され、本記事の執筆時点でバージョン1.2.4が最新版となっています。<br/>
基本的な使いやすいと思った機能を下記にあげておきます。</p>

<ul>
<li>HTML, CSS, JavaScriptにおける予測変換機能</li>
<li>HTML, CSS, JavaScriptにおける対応する括弧の表示</li>
<li>HTML, CSS, JavaScriptにおける属性の色彩表示</li>
</ul>


<p>本日はAtomエディタを使って、基本的なReact.jsの使い方を勉強したいと思います。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>React.jsとは</h4>

<p>さて、続いて、React.jsについて簡単に説明します。<br/>
<a href="https://facebook.github.io/react/index.html">React.js</a>とはFacebook製のUI構築ライブラリです。MVCで言うところの <strong>View</strong> のみをサポートします。MVC全てをサポートするわけではないため、<a href="https://angularjs.org/">AngularJS</a>や<a href="http://backbonejs.org/">Backbone.js</a>との併用が可能です。</p>

<p>React.jsはその仕組から大規模設計の際にも管理が可能であるとのことなので、メリット/デメリットを見極めつつ、ケースバイケースで使うのが良いのでしょう。<br/>
今回は勉強の意味を兼ねて、触ってみたいと思います。</p>

<h4>React.jsを使って、基本的なことを書いてみる</h4>

<p>本記事では <strong>v0.14.0</strong> のReact.jsを利用しています。<br/>
〜v0.13.xまでと変更点もあるかと思うので、<a href="http://facebook.github.io/react/blog/2015/10/07/react-v0.14.html">Release Note</a>は常に追うと良いでしょう。</p>

<p>では、早速書いていきます。基本的には本家のチュートリアルに沿って学んでいきました。<br/>
サンプルとして、クーポン一覧サイトを作ってみたいと思います。(実際のクーポンではありませんので、注意してください。)</p>

<p>まず、HTMLファイルに関しては本家のGitHub上のソースをそのまま流用すると楽だと思います。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>      <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;title&gt;</span>React Tutorial<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>      <span class="c">&lt;!-- Not present in the tutorial. Just for basic styling. --&gt;</span>
</span><span class='line'>      <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;css/base.css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/babel&quot;</span> <span class="na">src=</span><span class="s">&quot;js/coupon.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/babel&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="c1">// To get started with this tutorial running your own code, simply remove</span>
</span><span class='line'>          <span class="c1">// the script tag loading scripts/example.js and start writing code here.</span>
</span><span class='line'>      <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>次に、サイトのレイアウトは下記とします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>#content
</span><span class='line'>┗━━ .couponBox
</span><span class='line'>       ┗━━ .couponList
</span><span class='line'>              ┗━━ .coupon
</span><span class='line'>                     ┣━━ .couponImg
</span><span class='line'>                     ┣━━ .couponName
</span><span class='line'>                     ┗━━ .shopName
</span></code></pre></td></tr></table></div></figure>


<p>これに伴い、CSSファイルを簡単に下記としました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nf">#content</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">96</span><span class="o">%</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.couponBox</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">overflow</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.couponList</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">overflow</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.coupon</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">overflow</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.couponImg</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">width</span><span class="o">:</span><span class="m">200px</span><span class="p">;</span>
</span><span class='line'>      <span class="k">float</span><span class="o">:</span><span class="k">left</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.couponInfo</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>そして、最も重要なJSファイルは下記です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// テストデータ</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">couponName</span><span class="o">:</span> <span class="s2">&quot;ダブルチーズバーガー20円引き&quot;</span><span class="p">,</span> <span class="nx">shopName</span><span class="o">:</span> <span class="s2">&quot;マ◯ドナルド新宿店&quot;</span><span class="p">,</span> <span class="nx">img</span><span class="o">:</span> <span class="s2">&quot;http://urx.blue/pxQ3&quot;</span><span class="p">},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">couponName</span><span class="o">:</span> <span class="s2">&quot;ビッグマック100円引き&quot;</span><span class="p">,</span> <span class="nx">shopName</span><span class="o">:</span> <span class="s2">&quot;マ◯ドナルド新宿店&quot;</span><span class="p">,</span> <span class="nx">img</span><span class="o">:</span> <span class="s2">&quot;http://urx.blue/pxQg&quot;</span><span class="p">},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">couponName</span><span class="o">:</span> <span class="s2">&quot;フィレオフィッシュ30円引き&quot;</span><span class="p">,</span> <span class="nx">shopName</span><span class="o">:</span> <span class="s2">&quot;マ◯ドナルド新宿店&quot;</span><span class="p">,</span> <span class="nx">img</span><span class="o">:</span> <span class="s2">&quot;http://urx.blue/pxQl&quot;</span><span class="p">}</span>
</span><span class='line'><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// クーポン一覧をラップするDivタグの作成</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">CouponBox</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span><span class="nx">displayName</span><span class="o">:</span> <span class="s1">&#39;CouponBox&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;couponBox&quot;</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="nx">CouponList</span> <span class="nx">data</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// クーポン一覧Divタグの作成</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">CouponList</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">couponNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">coupon</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="nx">Coupon</span> <span class="nx">couponName</span><span class="o">=</span><span class="p">{</span><span class="nx">coupon</span><span class="p">.</span><span class="nx">couponName</span><span class="p">}</span> <span class="nx">shopName</span><span class="o">=</span><span class="p">{</span><span class="nx">coupon</span><span class="p">.</span><span class="nx">shopName</span><span class="p">}</span> <span class="nx">img</span><span class="o">=</span><span class="p">{</span><span class="nx">coupon</span><span class="p">.</span><span class="nx">img</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="err">/Coupon&gt;</span>
</span><span class='line'>          <span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;couponList&quot;</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="p">{</span><span class="nx">couponNodes</span><span class="p">}</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// クーポンDivタグの作成</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Coupon</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;coupon&quot;</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;couponImg&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">img</span><span class="p">}</span> <span class="o">/&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;couponInfo&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;couponName&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">couponName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;shopName&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">shopName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// レンダリング</span>
</span><span class='line'><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">CouponBox</span> <span class="nx">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
</span><span class='line'>  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>上記のソースコードより、下記の画面を作成しました。<br/>
<img src="http://grandbig.github.io/images/atom_react_1.png" alt="サンプルのクーポンサイト" /></p>

<p>React.jsを使うことで、</p>

<ul>
<li>レイアウトの要素をオブジェクト単位で捉えやすい</li>
<li>レイアウトをツリー構造で捉えやすい</li>
</ul>


<p>と感じました。<br/>
まだチュートリアルの範囲でしか触れていないので、これから徐々に利用範囲を拡大していくことで学んでいきたいと思います。<br/>
といったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSで検知可能なiBeaconの数について(別UUIDの場合)]]></title>
    <link href="http://grandbig.github.io/blog/2015/11/16/multi-ibeacon-region-2/"/>
    <updated>2015-11-16T00:15:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/11/16/multi-ibeacon-region-2</id>
    <content type="html"><![CDATA[<h4>iOSで検知可能なCLBeaconRegionの数について</h4>

<p>さて、今日は久しぶりにiBeaconについて書きます。<br/>
以前、<a href="http://grandbig.github.io/blog/2015/06/14/multi-ibeacon-region/">複数のiBeaconを検知しよう！(別UUIDの場合)</a>で別UUIDの複数のiBeaconを検知する方法について書きました。<br/>
今回は、その限界数について見ていきたいと思います。</p>

<p><a href="https://developer.apple.com/jp/documentation/LocationAwarenessPG.pdf">位置情報とマッププログラミングガイド</a>を読むと、地理的領域の観測は最大20個まで可能とされています。<br/>
しかし、iBeacon領域の観測について最大数が書かれていませんでした。<br/>
Googleで調べてもなかなか出てこなかったので、自分で調べることにしました。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>結果から言うと、iBeacon領域の観測は <strong>最大20個</strong> まで可能でした。<br/>
(地理的領域の観測と同じでした。)</p>

<p>因みに、下記ソースで確認しています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">import</span> <span class="n">UIKit</span>
</span><span class='line'><span class="n">import</span> <span class="n">CoreLocation</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="nl">ViewController:</span> <span class="n">UIViewController</span><span class="p">,</span> <span class="n">CLLocationManagerDelegate</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">var</span> <span class="nl">lm:</span><span class="n">CLLocationManager</span><span class="o">?</span>
</span><span class='line'>  <span class="n">var</span> <span class="nl">uuids:</span><span class="p">[</span><span class="n">String</span><span class="p">]</span><span class="o">?</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">lm</span> <span class="o">=</span> <span class="n">CLLocationManager</span><span class="p">()</span>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">lm</span><span class="o">?</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">uuids</span> <span class="o">=</span> <span class="p">[</span> <span class="err">ここに</span><span class="n">UUID</span><span class="err">の文字列を</span><span class="mi">20</span><span class="err">個以上用意</span> <span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">self</span><span class="p">.</span><span class="n">lm</span><span class="o">?</span><span class="p">.</span><span class="n">requestAlwaysAuthorization</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">override</span> <span class="n">func</span> <span class="n">didReceiveMemoryWarning</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">super</span><span class="p">.</span><span class="n">didReceiveMemoryWarning</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="p">,</span> <span class="n">didChangeAuthorizationStatus</span> <span class="nl">status:</span> <span class="n">CLAuthorizationStatus</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// 位置情報サービスの許可状態が変更した場合に呼び出される処理</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="p">.</span><span class="n">AuthorizedAlways</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">for</span><span class="p">(</span><span class="n">var</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">uuids</span><span class="p">.</span><span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">let</span> <span class="n">uuidString</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">uuids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span class='line'>              <span class="n">let</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">NSUUID</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="nl">UUIDString:</span> <span class="n">uuidString</span><span class="p">)</span>
</span><span class='line'>              <span class="n">let</span> <span class="n">beaconRegion</span> <span class="o">=</span> <span class="n">CLBeaconRegion</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="nl">proximityUUID:</span> <span class="n">uuid</span><span class="o">!</span><span class="p">,</span> <span class="nl">identifier:</span> <span class="p">(</span><span class="s">&quot;beaconRegion&quot;</span><span class="o">+</span><span class="n">String</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</span><span class='line'>              <span class="n">self</span><span class="p">.</span><span class="n">lm</span><span class="o">?</span><span class="p">.</span><span class="n">startMonitoringForRegion</span><span class="p">(</span><span class="n">beaconRegion</span><span class="p">)</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="p">,</span> <span class="n">didStartMonitoringForRegion</span> <span class="nl">region:</span> <span class="n">CLRegion</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Regionのモニタリングが開始したときに呼び出される処理</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s">&quot;\(region)&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">locationManager</span><span class="p">(</span><span class="nl">manager:</span> <span class="n">CLLocationManager</span><span class="p">,</span> <span class="n">didDetermineState</span> <span class="nl">state:</span> <span class="n">CLRegionState</span><span class="p">,</span> <span class="n">forRegion</span> <span class="nl">region:</span> <span class="n">CLRegion</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Regionに対する状態が変化したときに呼び出される処理</span>
</span><span class='line'>      <span class="k">switch</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="p">.</span><span class="nl">Inside:</span>
</span><span class='line'>          <span class="n">print</span><span class="p">(</span><span class="s">&quot;Inside: \(region)&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="k">break</span>
</span><span class='line'>      <span class="k">case</span> <span class="p">.</span><span class="nl">Outside:</span>
</span><span class='line'>          <span class="n">print</span><span class="p">(</span><span class="s">&quot;Outside: \(region)&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="k">break</span>
</span><span class='line'>      <span class="k">case</span> <span class="p">.</span><span class="nl">Unknown:</span>
</span><span class='line'>          <span class="n">print</span><span class="p">(</span><span class="s">&quot;Unknown: \(region)&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="k">break</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>viewDidLoad</code>内でuuidsの初期化を行っていますが、ここで20個UUIDを設定すると、<code>didDetermineState</code>内でログが20回出力されました。<br/>
しかし、21個以上UUIDを設定した場合は、先ほどと同じく20回のログ出力となり、21個目以降に設定したUUIDに関してはログ出力されませんでした。<br/>
つまり、先に設定したUUIDが有効で、21個目以降のUUIDは無効ということになります。</p>

<p>複数のUUIDを大量に使う際には気をつけましょう。<br/>
と言ったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kotlinを使ってみよう！(1)]]></title>
    <link href="http://grandbig.github.io/blog/2015/11/08/kotlin-android-2/"/>
    <updated>2015-11-08T23:54:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/11/08/kotlin-android-2</id>
    <content type="html"><![CDATA[<h3>Kotlinを勉強しよう</h3>

<p>さて、本日はKotlinを勉強してみたいと思います。<br/>
勉強の題材としては、<a href="http://grandbig.github.io/blog/2015/11/08/google-sign-in-android/">Google Sign-In SDK for Androidを使ってみよう！</a>で取り上げた <strong>Google Sign-In SDKによるOAuth2.0認証</strong> にしたいと思います。<br/>
その中で筆者が抑えておくべきと思ったところを基礎からメモっていきます。</p>

<p>(KotlinをAndroid Studioに導入する方法は以前書いた<a href="http://grandbig.github.io/blog/2015/10/25/kotlin-android/">Android StudioにKotlinを導入しよう！</a>を参照ください。)</p>

<p>では、早速、見ていきましょう。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>Kotlinで変数/定数の書き方</h4>

<p>最も基本的なことですが、変数/定数の書き方から異なります。</p>

<p>Javaの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span><span class="o">;</span>  <span class="c1">// 定数</span>
</span><span class='line'><span class="kd">private</span> <span class="n">GoogleApiClient</span> <span class="n">mGoogleApiClient</span><span class="o">;</span>    <span class="c1">// 変数</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">val</span> <span class="nl">TAG:</span><span class="n">Int</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span>                   <span class="c1">// 定数</span>
</span><span class='line'><span class="kd">private</span> <span class="n">var</span> <span class="nl">mGoogleApiClient:</span><span class="n">GoogleApiClient</span><span class="o">?</span> <span class="o">=</span> <span class="kc">null</span>  <span class="c1">// 変数</span>
</span></code></pre></td></tr></table></div></figure>


<p>ポイントは下記です。</p>

<ul>
<li>定数は<code>val</code>で変数は<code>var</code>を使う</li>
<li>定数は、val 定数名:型名 = 値</li>
<li>変数は、var 変数名:型名 = 値</li>
<li>初期値未定の変数は型名の後ろに<code>?</code>をつけて、<code>null</code>を代入<br/>
これをしないと『Property must be initialized or be abstract』エラーが発生する</li>
</ul>


<h4>Kotlinでのstatic定数の書き方</h4>

<p>Kotlinでは<code>static</code>は使いません。</p>

<p>Javaの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span><span class="o">;</span>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">RC_SIGN_IN</span> <span class="o">=</span> <span class="mi">9001</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">companion</span> <span class="n">object</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">val</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span>
</span><span class='line'>  <span class="n">val</span> <span class="n">RC_SIGN_IN</span> <span class="o">=</span> <span class="mi">9001</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Kotlinでimplementの書き方</h4>

<p>Google Sign-In SDKでOAuth2.0認証をする際に、<code>GoogleApiClient.OnConnectionFailedListener</code>と<code>View.OnClickListener</code>のインターフェースを継承していました。</p>

<p>Javaの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">GoogleApiClient</span><span class="o">.</span><span class="na">OnConnectionFailedListener</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="o">:</span> <span class="n">AppCompatActivity</span><span class="o">(),</span> <span class="n">GoogleApiClient</span><span class="o">.</span><span class="na">OnConnectionFailedListener</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlionでは<code>implements</code>ワードは書かずに<code>extends</code>したクラスの後ろに<code>,</code>区切りで書きます。</p>

<h4>Kotlinでキャストの書き方</h4>

<p>Google Sign-Inを実行するために置いていたボタンをソース上で取り出すときに<code>SignInButton</code>でキャストしていました。</p>

<p>Javaの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">SignInButton</span> <span class="n">signInButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">SignInButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">var</span> <span class="nl">signInButton:</span><span class="n">SignInButton</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">)</span> <span class="n">as</span> <span class="n">SignInButton</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinでは<code>as</code>を使ってキャストします。</p>

<h4>KotlinでOverrideの書き方</h4>

<p>Javaの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">override</span> <span class="n">fun</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nl">savedInstanceState:</span> <span class="n">Bundle</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinでは、<code>@</code>は不要で<code>fun</code>の前に書きます。<br/>
(Swiftと違って、<code>func</code>とは書かないんです。)</p>

<h4>Kotlinでメソッドの戻り値の書き方</h4>

<p>Javaの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">override</span> <span class="n">fun</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="nl">menu:</span> <span class="n">Menu</span><span class="o">):</span> <span class="n">Boolean</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>『fun メソッド名(引数名: 引数の型): 戻り値の型』 と書きます。</p>

<h4>Kotlinでswitch文の書き方</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">:</span>
</span><span class='line'>          <span class="n">signIn</span><span class="o">();</span>
</span><span class='line'>          <span class="k">break</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinの場合</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">override</span> <span class="n">fun</span> <span class="nf">onClick</span><span class="o">(</span><span class="nl">view:</span><span class="n">View</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">when</span><span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">id</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">signIn</span><span class="o">()</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Kotlinでは<code>switch</code>ワードを使いません。<code>when</code>を使います。<br/>
<code>case 条件:</code>という書き方が<code>条件 -&gt;</code>になります。</p>

<p>さて、今回気になったのはこんなところです。<br/>
これからもどんどんKotlinでの書き方に慣れていきたいと思います。</p>

<p>因みに、今回のソースは、<a href="https://github.com/grandbig/KotlinGoogleSignInSample">GitHub</a>に上げてあります。<br/>
ご自由にお使いください。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google Sign-In SDK for Androidを使ってみよう！]]></title>
    <link href="http://grandbig.github.io/blog/2015/11/08/google-sign-in-android/"/>
    <updated>2015-11-08T12:20:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/11/08/google-sign-in-android</id>
    <content type="html"><![CDATA[<h4>Google Sign-in SDKを使ったOAuth認証をやってみよう！</h4>

<p>さて、本日はGoogle Sign-in SDKのAndroidでの使い方について見ていきたいと思います。<br/>
Androidの場合、Google製のため、親和性は元々高いのですが、推奨されているGoogle Sign-in SDKを使うことでより快適なコーディングやUXを提供できるのではと期待しています。</p>

<p>因みに、本書執筆時の環境は下記です。<br/>
* 端末: Nexus6<br/>
* OS: Android6.0<br/>
* IDE: Android Studio 1.5 preview2</p>

<p>では、早速、使い方を見ていきましょう。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h4>Google Developers ConsoleでOAuth認証に必要な項目を登録しよう！</h4>

<p>さて、実際にGoogle Sign-Inを始める前に、やらなければならないことがあります。<br/>
それは<a href="https://console.developers.google.com">Google Developers Console</a>での登録作業です。(iOSと同じです。)</p>

<p>まず、OAuth2.0の同意画面を作成しましょう。<br/>
因みに、筆者は既に登録済みのOAuth2.0クライアントIDがあったため、下図のように表示されます。<br/>
<strong>OAuth同意画面</strong> というボタンをクリックして、OAuth同意画面の作成ページに移りましょう。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-0.png" alt="認証情報の確認ページ" /></p>

<p>OAuth同意画面では <strong>メールアドレス</strong> と <strong>サービス名</strong> を入力しましょう。(他は必要に応じて入力してください。)<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-1.png" alt="OAuth2.0の同意画面を作成" /></p>

<p>OAuth同意画面が作成できたら、認証情報を追加しましょう。<br/>
下図のように <strong>OAuth2.0クライアントID</strong> を選択してください。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-2.png" alt="OAuth2.0クライアントIDを作成" /></p>

<p>今回はAndroid用なので、下図の手順でクライアントIDを作成しましょう。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-3.png" alt="OAuth2.0クライアントISを作成2" /></p>

<p>これでクライアントIDが作成されたと思います。<br/>
作成したクライアントIDを選択すれば、下図のような情報が得られるはずです。<br/>
 <img src="http://grandbig.github.io/images/google-sign-in-android-6.png" alt="Google Developer ConsoleのOAuth2.0 for iOS" /></p>

<h4>Google Sign-in SDK for Androidを実装しよう</h4>

<p><a href="https://developers.google.com/identity/sign-in/android/?hl=ja">Googleの公式サイト</a>に書かれていますが、英語が苦手な方向け(+自分のメモ書き)として説明していきたいと思います。</p>

<p>まずは、<a href="https://developers.google.com/identity/sign-in/android/start?hl=ja">Google Sign-In for Androidのガイドページ</a>にアクセスしましょう。<br/>
そうすると、順番に説明されていることがわかります。<br/>
①はテストコードを手に入れるだけなので、自分のプロジェクトに組み込むなら②からはじめましょう。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-4.png" alt="GET A CONFIGURATION FILE" /></p>

<p>そうすると、下図のようなページに遷移します。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-5.png" alt="Enable Google services for your app" /></p>

<p>ここで、 <strong>App name</strong> にGoogle Developers Consoleのプロジェクト名を <strong>『選択』</strong> します。<br/>
注意点として、App nameに記載されているデフォルト名を削除すると、選択可能なプロジェクト名が表示されます。<br/>
App nameが入力した後に、 <strong>Android package name</strong> を入力しましょう。</p>

<p>必要項目の入力が終わったら、Choose and configure servicesボタンを押しましょう。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-7.png" alt="Choose and configure servicesボタンを押す" /></p>

<p>結果、画面が遷移します。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-8.png" alt="Configuration Fileを作成しよう" /></p>

<p>画面下の方に <strong>SHA1</strong> を入力する項目があるので、これを入力して、 <strong>ENABLE GOOGLE SIGN-IN</strong> ボタンを選択しましょう。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-9.png" alt="Configuration Fileを作成しよう" /></p>

<p>因みにSHA1の調べ方は下記の通りです。</p>

<ol>
<li>ターミナルで/Users/{ユーザ名}/.androidの階層に移動</li>
<li><code>keytool -list -v -keystore "/Users/{ユーザ名}/.android/debug.keystore" -alias androiddebugkey -storepass android -keypass android</code>コマンドを入力</li>
<li>出力結果の証明書のフィンガプリント > SHA1の値を取得</li>
</ol>


<p>画面下の <strong>Generate configuration files</strong> ボタンが押せるようになるので、押しましょう。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-10.png" alt="Configuration Fileを作成しよう" /></p>

<p>jsonファイルのダウンロード画面が表示されるので、ダウンロードしましょう。<br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-11.png" alt="jsonファイルをダウンロード" /></p>

<p>必要なファイルが揃ったので、自身のプロジェクトのappフォルダ配下にダウンロードした<code>google-services.json</code>を配置しましょう。</p>

<p>続いて、<code>build.gradle</code>ファイルの設定にGoogle Play Services Pluginを追加しましょう。<br/>
まずは、<code>build.gradle(Project)</code>の<code>dependencies</code>内に<code>classpath 'com.google.gms:google-services:1.5.0-beta2'</code>を追加<br/>
次に、<code>build.gradle(app)</code>の最上部に<code>apply plugin: 'com.google.gms.google-services'</code>を追加<br/>
そして、<code>build.gradle(app)</code>の<code>dependencies</code>内に<code>compile 'com.google.android.gms:play-services-auth:8.3.0'</code>を追加</p>

<p>これで用意が整いましたので、ソースを書いていきます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// MainActivity.java</span>
</span><span class='line'><span class="kn">package</span> <span class="o">...</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.support.design.widget.FloatingActionButton</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.support.design.widget.Snackbar</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.support.v7.widget.Toolbar</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.Menu</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.MenuItem</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.Auth</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.signin.GoogleSignInAccount</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.signin.GoogleSignInOptions</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.auth.api.signin.GoogleSignInResult</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.common.ConnectionResult</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.common.SignInButton</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.android.gms.common.api.GoogleApiClient</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span>
</span><span class='line'>        <span class="n">GoogleApiClient</span><span class="o">.</span><span class="na">OnConnectionFailedListener</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">RC_SIGN_IN</span> <span class="o">=</span> <span class="mi">9001</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">GoogleApiClient</span> <span class="n">mGoogleApiClient</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Button listenersの設定</span>
</span><span class='line'>      <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Google Sign-Inの設定</span>
</span><span class='line'>      <span class="n">GoogleSignInOptions</span> <span class="n">gso</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GoogleSignInOptions</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">GoogleSignInOptions</span><span class="o">.</span><span class="na">DEFAULT_SIGN_IN</span><span class="o">).</span><span class="na">requestEmail</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mGoogleApiClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GoogleApiClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
</span><span class='line'>              <span class="o">.</span><span class="na">enableAutoManage</span><span class="o">(</span><span class="k">this</span> <span class="cm">/* FragmentActivity */</span><span class="o">,</span> <span class="k">this</span> <span class="cm">/* OnConnectionFailedListener */</span><span class="o">)</span>
</span><span class='line'>              <span class="o">.</span><span class="na">addApi</span><span class="o">(</span><span class="n">Auth</span><span class="o">.</span><span class="na">GOOGLE_SIGN_IN_API</span><span class="o">,</span> <span class="n">gso</span><span class="o">)</span>
</span><span class='line'>              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Google Sign-Inボタンの設定</span>
</span><span class='line'>      <span class="n">SignInButton</span> <span class="n">signInButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">SignInButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">);</span>
</span><span class='line'>      <span class="n">signInButton</span><span class="o">.</span><span class="na">setSize</span><span class="o">(</span><span class="n">SignInButton</span><span class="o">.</span><span class="na">SIZE_STANDARD</span><span class="o">);</span>
</span><span class='line'>      <span class="n">signInButton</span><span class="o">.</span><span class="na">setScopes</span><span class="o">(</span><span class="n">gso</span><span class="o">.</span><span class="na">getScopeArray</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">省略</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Sign-Inした結果を受け取る処理</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Result returned from launching the Intent from GoogleSignInApi.getSignInIntent(...);</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="n">RC_SIGN_IN</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">GoogleSignInResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Auth</span><span class="o">.</span><span class="na">GoogleSignInApi</span><span class="o">.</span><span class="na">getSignInResultFromIntent</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>          <span class="n">handleSignInResult</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Sign-Inした結果を扱う処理</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleSignInResult</span><span class="o">(</span><span class="n">GoogleSignInResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;handleSignInResult:&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">());</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>          <span class="c1">// Signed in successfully, show authenticated UI.</span>
</span><span class='line'>          <span class="n">GoogleSignInAccount</span> <span class="n">acct</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getSignInAccount</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>          <span class="c1">// Signed out, show unauthenticated UI.</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Sign-In処理</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">signIn</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Intent</span> <span class="n">signInIntent</span> <span class="o">=</span> <span class="n">Auth</span><span class="o">.</span><span class="na">GoogleSignInApi</span><span class="o">.</span><span class="na">getSignInIntent</span><span class="o">(</span><span class="n">mGoogleApiClient</span><span class="o">);</span>
</span><span class='line'>      <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">signInIntent</span><span class="o">,</span> <span class="n">RC_SIGN_IN</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_sign_in</span><span class="o">:</span>
</span><span class='line'>              <span class="n">signIn</span><span class="o">();</span>
</span><span class='line'>              <span class="k">break</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>続いてレイアウトの作成</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// content_main.xml</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">gms</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">SignInButton</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/button_sign_in&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_below</span><span class="o">=</span><span class="s">&quot;@+id/textView&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_alignParentStart</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">layout_marginTop</span><span class="o">=</span><span class="s">&quot;100dp&quot;</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>これを実装すると下記のような画面遷移ができます。</p>

<p><img src="http://grandbig.github.io/images/google-sign-in-android-12.png" alt="アプリ起動後の画面" /><br/>
<img src="http://grandbig.github.io/images/google-sign-in-android-13.png" alt="アカウントの選択" /></p>

<p>Google Sign-In SDK for Androidを使うことで、UI/UXをiOS側と合わせることもできるので、非常に良いと思います。<br/>
ぜひ使ってみてはいかがでしょうか。</p>

<p>といったところで本日はここまで。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google Sign-In SDK for iOSがアップデートされました！]]></title>
    <link href="http://grandbig.github.io/blog/2015/11/08/google-sign-in-update/"/>
    <updated>2015-11-08T01:31:00+09:00</updated>
    <id>http://grandbig.github.io/blog/2015/11/08/google-sign-in-update</id>
    <content type="html"><![CDATA[<h3>Google Sign-In SDK for iOSを利用する理由</h3>

<p>本日は再び、Google Sign-In SDK for iOSについてお話したいと思います。<br/>
筆者は業務でも積極的にGoogle Sign-In SDK for iOSを使っています。<br/>
理由は、</p>

<ul>
<li><a href="https://itunes.apple.com/jp/app/google/id284815942?mt=8">Google</a>, <a href="https://itunes.apple.com/jp/app/google+/id447119634?mt=8">Google+</a>アプリを入れているユーザはアカウントを入力しなくてもOAuth認証が可能</li>
<li>クライアント側で手軽にOAuth認証を実装できる</li>
</ul>


<p>といった2つがあります。</p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<p>前者は特にユーザの手間を省けるので、非常に有用だと考えています。<br/>
例え、1つの端末内で複数のアカウントを使っていても、ユーザが選択できる形でOAuth認証をすることができます。</p>

<p><img src="http://grandbig.github.io/images/google-sign-in-update-1.png" alt="OAuth認証" /></p>

<p>もちろんGoogle, Google+共にインストールされていない端末であったとしても、メールアドレスとパスワードを入力する従来の方法で問題なくOAuth認証を通すことができます。</p>

<p>後者は以前紹介した手順(<a href="http://grandbig.github.io/blog/2015/09/13/google-sign-in/">Google Sign-In SDK for iOSを使ってみよう！</a>を参照のこと)を踏むだけで、簡単に実装することができます。<br/>
OAuth認証で得られるトークン(アクセストークンやIDトークン)は端末ローカルで保存することも多いため、サーバサイドよりもクライアントサイドでOAuth認証を通す方が良い場合もあります。<br/>
あとは、サーバを自身で持てない場合もクライアントサイドで処理が済むので、非常に良いですね。</p>

<h3>Google Sign-In SDK for iOSがアップデートされて、さらに使いやすくなりました！</h3>

<p>上記で説明した通り、非常に実装が簡単でユーザにとっても利益のあるSDKではあるものの、微妙に使いにくい側面も持っていました。<br/>
それは、IDトークンを取得するタイミングが<code>[[GoogleSinIn sharedInstance] signIn];</code>と<code>[[GoogleSignIn sharedInstance] signInSilently];</code>の2つのみだったからです。<br/>
IDトークンはアクセストークンと同じく、有効期限が <strong>発行されてから1時間</strong> と定義されているため、IDトークンを利用する場合は割りと頻繁に更新情報を取得する必要があります。<br/>
しかし、先ほど2つのメソッドはアプリ起動後に <strong>ユーザがログイン済みか否かを判断した上で実行するメソッド</strong> であるため、頻繁に利用するシーンには不向きと言えます。(アプリ初回起動後とそれ以外との判断を自身で定義したフラグなどで管理する必要があるため)</p>

<p>それが先日公開されたv2.4.0から(<a href="https://developers.google.com/identity/sign-in/ios/release">Release Notes</a>を参照のこと)変更が加わりました。<br/>
具体的には、</p>

<ul>
<li><code>- (void) getAccessTokenWithHandler:</code>がdeprecatedとなり、<code>- (void) getTokensWithHandler:</code>が代わりに追加</li>
<li><code>- (void) refreshAccessTokenWithHandler:</code>がdeprecatedとなり、<code>- (void) refreshTokensWithHandler:</code>が代わりに追加</li>
</ul>


<p>の2点です。</p>

<p>これまでアクセストークンを取得するために利用していた<code>getAccessTokenWithHandler</code>ではアクセストークンのみを返却していましたが、<code>getTokenWithHandler</code>では<code>GIDAuthentication</code>オブジェクトごと返却してくれるようになったため、アクセストークンだけでなく、IDトークンも取得することができるようになりました。</p>

<p>また、<code>refreshAccessTokenWithHandler</code>ではアクセストークンのみをリフレッシュするものでしたが、<code>refreshTokenWithHandler</code>ではアクセストークンとIDトークンをリフレッシュしてくれるようになりました。</p>

<p>IDトークンはアクセストークンと同じ1時間だけ有効なトークンなので、自然と更新タイミングはアクセストークンと同じになります。<br/>
アクセストークンのみを使うのであれば、<code>getAccessTokenWithHandler</code>と<code>refreshAccessTokenWithHandler</code>で良かったのですが、IDトークンも使うとなると<code>getTokensWithHandler</code>および<code>refreshTokensWithHandler</code>でないと成り立ちません。</p>

<h3>OAuth認証を通して取得する各種トークンについて</h3>

<p>Google OAuth認証では様々なトークンが飛び交います。ここではそれぞれのトークンの利用用途について少し触れておきたいと思います。</p>

<ul>
<li>one-time code<br/>
これはアクセストークンを取得するための一時的なトークンです。<br/>
今回のSDKとは直接からみませんが、<a href="https://developers.google.com/identity/sign-in/web/server-side-flow?hl=ja">
Google Sign-In for server-side apps</a>に書かれている通りで、サーバサイドでアクセストークンを取得するために利用します。</li>
<li>access-token<br/>
これは各種APIを利用するために必要なトークンです。<br/>
API実行時にヘッダーにこのトークンを渡すことで、認証されたことを伝えることができます。(ヘッダーに入れていない場合はunauthorized errorが発生します。)</li>
<li>refresh-token<br/>
これはアクセストークンをリフレッシュするために利用するトークンです。<br/>
アクセストークンは有効期限が1時間なので、継続的にAPIを実行するためには、きちんとアクセストークンをリフレッシュする必要があります。</li>
<li>id-token<br/>
JWT(Json Web Token)と呼ばれるデータ形式で、ユーザのユニークな識別子が入っています。<br/>
各種サービス間でのID連携するときに利用します。<br/>
例えば、GREEにログインするときにYahoo!アカウントを使ってログインした場合に、ユーザの基本情報(名前やメールアドレス)が自動で入力されていることがあると思います。<br/>
そういった連携を組み込みたい場合に使います。</li>
</ul>


<p>今回、id-tokenを調べる上で、OpenID Connectの考え方に触れました。これまで全く気にしてこなかった内容なのですが、かなり大事であることがわかりました。<br/>
これについてもどこかで記事を書ければ良いなと思います。</p>

<p>と言ったところで本日はここまで。</p>

<p>参考:<br/>
* <a href="http://webos-goodies.jp/archives/how_to_migrate_from_openid_to_openid_connect.html">Google アカウントの認証を OpenID から OpenID Connect に移行する方法</a><br/>
* <a href="http://www.slideshare.net/kura_lab/openid-connect-id">OpenID Connect 入門 〜コンシューマーにおけるID連携のトレンド〜</a><br/>
* <a href="http://oauth.jp/blog/2015/01/06/oauth2-multiple-response-type/">OAuth 2.0 の Response Type 全パターン</a></p>

<script async src="http://grandbig.github.io//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p><ins class="adsbygoogle"style="display:inline-block;width:320px;height:100px"data-ad-client="ca-pub-2881241309408290"data-ad-slot="6603059167"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

]]></content>
  </entry>
  
</feed>
